#!/home/y/bin/perl

	#
	# Do
	# egrep '^#|name.*=>' hcat.conf | egrep -v '^#!|egrep' | less
	# to get an outline of this test conf file
	#
	
  # Has a couple of Hive set directives:
  #   set hive.exec.dynamic.partition.mode=nonstrict;
  #   set hive.exec.dynamic.partition=true;


$cfg = {
        'driver' => 'HCat',
		'groups' => [
# This first group should be moved to deployer ?
		{
			'name' => 'HCat_CreateTable',
			'tests' => [

				{
				 'num' => 1
				,'hcat' => q\
drop table if exists hcat_createtable_1;
create table hcat_createtable_1(name string,
age int,
gpa double)
stored as textfile;
describe hcat_createtable_1;\
				,'rc'   => 0
                                ,'expected_out_regex' => 'name	string(\s)*age	int(\s)*gpa	double'
                                ,'expected_err_regex' => 'OK(.*)OK(.*)OK'
				}, 
				{
				 'num' => 2
                                ,'hcat' => q\
drop table if exists hcat_createtable_2;
create table hcat_createtable_2(name string,
age int,
gpa double) partitioned by (b string) stored as TEXTFILE;
describe extended hcat_createtable_2;
\,
				,'rc'   => 0
                                ,'expected_out_regex' => 'name	string(\s)*age	int(\s)*gpa	double'
				}, 
				{
				 'num' => 3
                                ,'hcat' => q\
drop table if exists hcat_create_table_3;
create table if not exists hcat_createtable_3(name string, age int, gpa double) stored as textfile;
create table if not exists hcat_createtable_3(name string, age int, gpa double) stored as textfile;
describe hcat_createtable_3;
\,
				,'rc'   => 0
                                ,'expected_out_regex' => 'name	string(\s)*age	int(\s)*gpa	double'
                                ,'expected_err_regex' => 'OK(.*)OK(.*)OK(.*)OK'
				}, 

			],
 		}, # end g
                {
                        'name' => 'HCat_DropTable',
                        'tests' => [

                                {
                                 'num' => 1
                                ,'hcat' => q\
create table if not exists hcat_droptable_1(name string,
age int,
gpa double)
stored as textfile;
drop table hcat_droptable_1;
describe hcat_droptable_1;\
                                ,'expected_out_regex' => 'does not exist'
                                },
                                {
                                 'num' => 2
                                ,'hcat' => q\
create table if not exists hcat_droptable_2(name string,
age int,
gpa double)
stored as textfile;
drop table if exists hcat_droptable_2;
describe hcat_droptable_2;\,
                                ,'rc'   => 0
                                ,'expected_out_regex' => 'does not exist'
                                },

                        ],
                }, # end g
                {
                        'name' => 'HCat_AlterTable',
                        'tests' => [

                                {
                                 'num' => 1
                                ,'hcat' => q\
drop table if exists hcat_altertable_1;
create table hcat_altertable_1(name string, age int, gpa double) partitioned by (b string) stored as textfile;
alter table hcat_altertable_1 add partition (b='2010-10-10');
show partitions hcat_altertable_1;\
                                ,'rc'   => 0
                                ,'expected_out_regex' => 'b=2010-10-10'
                                },
                                {
                                 'num' => 2
                                ,'hcat' => q\
alter table hcat_altertable_1 add partition (b='2010-10-11');
alter table hcat_altertable_1 drop partition (b='2010-10-10');
show partitions hcat_altertable_1;\,
                                ,'rc'   => 0
                                ,'expected_out_regex' => 'b=2010-10-11'
                                ,'not_expected_out_regex' => 'b=2010-10-10'
                                },
                        ],
                }, # end g
                {
                        'name' => 'HCat_Misc',
                        'tests' => [
                                {
                                 'num' => 1
                                ,'hcat' => q\
show databases;\
                                ,'rc'   => 0
                                ,'expected_out_regex' => 'default'
                                },
                                {
                                 'num' => 2
                                ,'hcat' => q\
show tables;\,
                                ,'rc'   => 0
                                ,'expected_out_regex' => 'studenttab10k'
                                },
                        ],
                }, # end g
         ]
}
