<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta content="Apache Forrest" name="Generator">
<meta name="Forrest-version" content="0.9">
<meta name="Forrest-skin-name" content="pelt">
<title>Load and Store Interfaces</title>
<link type="text/css" href="skin/basic.css" rel="stylesheet">
<link media="screen" type="text/css" href="skin/screen.css" rel="stylesheet">
<link media="print" type="text/css" href="skin/print.css" rel="stylesheet">
<link type="text/css" href="skin/profile.css" rel="stylesheet">
<script src="skin/getBlank.js" language="javascript" type="text/javascript"></script><script src="skin/getMenu.js" language="javascript" type="text/javascript"></script><script src="skin/fontsize.js" language="javascript" type="text/javascript"></script>
<link rel="shortcut icon" href="">
</head>
<body onload="init()">
<script type="text/javascript">ndeSetTextSize();</script>
<div id="top">
<!--+
    |breadtrail
    +-->
<div class="breadtrail">
<script src="skin/breadcrumbs.js" language="JavaScript" type="text/javascript"></script>
</div>
<!--+
    |header
    +-->
<div class="header">
<!--+
    |start group logo
    +-->
<div class="grouplogo">
<a href=""><img class="logoImage" alt="HCatalog" src="images/hcat.jpg" title=""></a>
</div>
<!--+
    |end group logo
    +-->
<!--+
    |start Project Logo
    +-->
<div class="projectlogoA1">
<a href=""><img class="logoImage" alt="HCatalog" src="images/hcat-box.jpg" title="A table abstraction on top of data for use with java MapReduce programs, Pig scripts and Hive queryies."></a>
</div>
<!--+
    |end Project Logo
    +-->
<!--+
    |start Tabs
    +-->
<ul id="tabs">
<li class="current">
<a class="selected" href="index.html">HCatalog 0.4.0 Documentation</a>
</li>
</ul>
<!--+
    |end Tabs
    +-->
</div>
</div>
<div id="main">
<div id="publishedStrip">
<!--+
    |start Subtabs
    +-->
<div id="level2tabs"></div>
<!--+
    |end Endtabs
    +-->
<script type="text/javascript"><!--
document.write("Last Published: " + document.lastModified);
//  --></script>
</div>
<!--+
    |breadtrail
    +-->
<div class="breadtrail">

             &nbsp;
           </div>
<!--+
    |start Menu, mainarea
    +-->
<!--+
    |start Menu
    +-->
<div id="menu">
<div onclick="SwitchMenu('menu_selected_1.1', 'skin/')" id="menu_selected_1.1Title" class="menutitle" style="background-image: url('skin/images/chapter_open.gif');">HCatalog</div>
<div id="menu_selected_1.1" class="selectedmenuitemgroup" style="display: block;">
<div class="menuitem">
<a href="index.html">Overview</a>
</div>
<div class="menuitem">
<a href="install.html">Installation From Tarball</a>
</div>
<div class="menupage">
<div class="menupagetitle">Load &amp; Store Interfaces</div>
</div>
<div class="menuitem">
<a href="inputoutput.html">Input &amp; Output Interfaces </a>
</div>
<div class="menuitem">
<a href="cli.html">Command Line Interface </a>
</div>
<div class="menuitem">
<a href="supportedformats.html">Storage Formats</a>
</div>
<div class="menuitem">
<a href="dynpartition.html">Dynamic Partitioning</a>
</div>
<div class="menuitem">
<a href="notification.html">Notification</a>
</div>
<div class="menuitem">
<a href="api/index.html">API Docs</a>
</div>
</div>
<div id="credit"></div>
<div id="roundbottom">
<img style="display: none" class="corner" height="15" width="15" alt="" src="skin/images/rc-b-l-15-1body-2menu-3menu.png"></div>
<!--+
  |alternative credits
  +-->
<div id="credit2"></div>
</div>
<!--+
    |end Menu
    +-->
<!--+
    |start content
    +-->
<div id="content">
<div title="Portable Document Format" class="pdflink">
<a class="dida" href="loadstore.pdf"><img alt="PDF -icon" src="skin/images/pdfdoc.gif" class="skin"><br>
        PDF</a>
</div>
<h1>Load and Store Interfaces</h1>
<div id="front-matter">
<div id="minitoc-area">
<ul class="minitoc">
<li>
<a href="#Set+Up">Set Up</a>
</li>
<li>
<a href="#HCatLoader">HCatLoader</a>
<ul class="minitoc">
<li>
<a href="#Usage">Usage</a>
</li>
<li>
<a href="#HCatalog+Data+Types">HCatalog Data Types</a>
</li>
<li>
<a href="#Running+Pig+with+HCatalog">Running Pig with HCatalog</a>
</li>
<li>
<a href="#Load+Examples">Load Examples</a>
</li>
</ul>
</li>
<li>
<a href="#HCatStorer">HCatStorer</a>
<ul class="minitoc">
<li>
<a href="#Usage-N1013D">Usage</a>
</li>
<li>
<a href="#Store+Examples">Store Examples</a>
</li>
<li>
<a href="#HCatalog+Data+Types-N1017D">HCatalog Data Types</a>
</li>
</ul>
</li>
</ul>
</div>
</div>
 
 <!-- ==================================================================== --> 
  
<a name="Set+Up"></a>
<h2 class="h3">Set Up</h2>
<div class="section">
<p>The HCatLoader and HCatStorer interfaces are used with Pig scripts to read and write data in HCatalog managed tables.</p>
</div>
  
      
<!-- ==================================================================== -->
     
<a name="HCatLoader"></a>
<h2 class="h3">HCatLoader</h2>
<div class="section">
<p>HCatLoader is used with Pig scripts to read data from HCatalog managed tables.</p>
<a name="Usage"></a>
<h3 class="h4">Usage</h3>
<p>HCatLoader is accessed via a Pig load statement.</p>
<pre class="code">
A = LOAD 'tablename' USING org.apache.hcatalog.pig.HCatLoader(); 
</pre>
<p>
<strong>Assumptions</strong>
</p>
<p>You must specify the table name in single quotes: LOAD 'tablename'. If you are using a non-default database you must specify your input as 'dbname.tablename'. If you are using Pig 0.9.2 or earlier, you must create your database and table prior to running the Pig script. Beginning with Pig 0.10 you can issue these create commands in Pig using the SQL command.</p>
<p>The Hive metastore lets you create tables without specifying a database; if you
    created tables this way, then the database name is 'default' and is not required when
    specifying the table for HCatLoader. </p>
<p>If the table is partitioned, you can indicate which partitions to scan by immediately following the load statement with a partition filter statement 
    (see <strong>Examples</strong>). </p>
<a name="HCatalog+Data+Types"></a>
<h3 class="h4">HCatalog Data Types</h3>
<p>Restrictions apply to the types of columns HCatLoader can read.</p>
<p>HCatLoader  can read <strong>only</strong> the data types listed in the table. 
The table shows how Pig will interpret the HCatalog data type.</p>
<table class="ForrestTable" cellspacing="1" cellpadding="4">
        
<tr>
            
<td colspan="1" rowspan="1">
               
<p>
<strong>HCatalog Data Type</strong>
</p>
            
</td>
            <td colspan="1" rowspan="1">
               
<p>
<strong>Pig Data Type</strong>
</p>
            
</td>
    
</tr>
    
<tr>
            
<td colspan="1" rowspan="1">
               
<p>primitives (int, long, float, double, string) </p>
            
</td>
            <td colspan="1" rowspan="1">
               
<p>int, long, float, double, string to chararray </p>
            
</td>
    
</tr>
    
<tr>
            
<td colspan="1" rowspan="1">
               
<p>map (key type should be string, valuetype must be string)</p>
            
</td>
            <td colspan="1" rowspan="1">
               
<p>map </p>
            
</td>
    
</tr>
    
<tr>
            
<td colspan="1" rowspan="1">
               
<p>List&lt;any type&gt; </p>
            
</td>
            <td colspan="1" rowspan="1">
               
<p>bag </p>
            
</td>
    
</tr>
    
<tr>
            
<td colspan="1" rowspan="1">
               
<p>struct&lt;any type fields&gt; </p>
            
</td>
            <td colspan="1" rowspan="1">
               
<p>tuple </p>
            
</td>
    
</tr>
 
</table>
<a name="Running+Pig+with+HCatalog"></a>
<h3 class="h4">Running Pig with HCatalog</h3>
<p>Pig does not automatically pick up HCatalog jars. You will need tell Pig where your HCatalog jars are.
These include the Hive jars used by the HCatalog client. To do this, you must define the environment
variable PIG_CLASSPATH with the appropriate jars. HCat can tell you the jars it needs. In order to do this it
needs to know where Hadoop is installed. Also, you need to tell Pig the URI for your metastore, in the PIG_OPTS
variable. In the case where you have installed Hadoop and HCatalog via tar, you can do:</p>
<pre class="code">
export HADOOP_HOME=&lt;path_to_hadoop_install&gt;
export HCAT_HOME=&lt;path_to_hcat_install&gt;
export PIG_CLASSPATH=$HCAT_HOME/share/hcatalog/hcatalog-0.4.0.jar:$HIVE_HOME/lib/hive-metastore-0.9.0.jar:
$HIVE_HOME/lib/libthrift-0.7.0.jar:$HIVE_HOME/lib/hive-exec-0.9.0.jar:$HIVE_HOME/lib/libfb303-0.7.0.jar:
$HIVE_HOME/lib/jdo2-api-2.3-ec.jar:$HIVE_HOME/conf:$HADOOP_HOME/conf:$HIVE_HOME/lib/slf4j-api-1.6.1.jar

export PIG_OPTS=-Dhive.metastore.uris=thrift://&lt;hostname&gt;:&lt;port&gt;

&lt;path_to_pig_install&gt;/bin/pig -Dpig.additional.jars=$HCAT_HOME/share/hcatalog/hcatalog-0.4.0.jar:
$HIVE_HOME/lib/hive-metastore-0.9.0.jar:$HIVE_HOME/lib/libthrift-0.7.0.jar:$HIVE_HOME/lib/hive-exec-0.9.0.jar:
$HIVE_HOME/lib/libfb303-0.7.0.jar:$HIVE_HOME/lib/jdo2-api-2.3-ec.jar:$HIVE_HOME/lib/slf4j-api-1.6.1.jar &lt;script.pig&gt;
</pre>
<p>
<strong>Authentication</strong>
</p>
<table class="ForrestTable" cellspacing="1" cellpadding="4">
	
<tr>
	
<td colspan="1" rowspan="1">
<p>If you are using a secure cluster and a failure results in a message like "2010-11-03 16:17:28,225 WARN hive.metastore ... - Unable to connect metastore with URI thrift://..." in /tmp/&lt;username&gt;/hive.log, then make sure you have run "kinit &lt;username&gt;@FOO.COM" to get a Kerberos ticket and to be able to authenticate to the HCatalog server. </p>
</td>
	
</tr>

</table>
<a name="Load+Examples"></a>
<h3 class="h4">Load Examples</h3>
<p>This load statement will load all partitions of the specified table.</p>
<pre class="code">
/* myscript.pig */
A = LOAD 'tablename' USING org.apache.hcatalog.pig.HCatLoader(); 
...
...
</pre>
<p>If only some partitions of the specified table are needed, include a partition filter statement <strong>immediately</strong> following the load statement in the data flow. (In the script, however, a filter statement might not immediately follow its load statement.) The filter statement can include conditions on partition as well as non-partition columns.</p>
<pre class="code">
/* myscript.pig */
A = LOAD 'tablename' USING  org.apache.hcatalog.pig.HCatLoader();

-- date is a partition column; age is not
B = filter A by date == '20100819' and age &lt; 30; 

-- both date and country are partition columns
C = filter A by date == '20100819' and country == 'US'; 
...
...
</pre>
<p>To scan a whole table, for example:</p>
<pre class="code">
a = load 'student_data' using org.apache.hcatalog.pig.HCatLoader();
b = foreach a generate name, age;
</pre>
<p>Notice that the schema is automatically provided to Pig, there's no need to declare name and age as fields, as if
you were loading from a file.</p>
<p>To scan a single partition of the table web_logs, for example, partitioned by the column datestamp:</p>
<pre class="code">
a = load 'web_logs' using org.apache.hcatalog.pig.HCatLoader();
b = filter a by datestamp == '20110924';
</pre>
<p>Pig will push the datestamp filter shown here to HCatalog, so that HCatalog knows to just scan the partition where
datestamp = '20110924'. You can combine this filter with others via 'and':</p>
<pre class="code">
a = load 'web_logs' using org.apache.hcatalog.pig.HCatLoader();
b = filter a by datestamp == '20110924' and user is not null;
</pre>
<p>Pig will split the above filter, pushing the datestamp portion to HCatalog and retaining the <span class="codefrag">user is not null</span> part
to apply itself. You can also give a more complex filter to retrieve a set of partitions.</p>
<p>
<strong>Filter Operators</strong>
</p>
<p>A filter can contain the operators 'and', 'or', '()', '==', '!=', '&lt;', '&gt;', '&lt;='
and '&gt;='.</p>
<p>For example:</p>
<pre class="code">
a = load 'web_logs' using org.apache.hcatalog.pig.HCatLoader();
b = filter a by datestamp &gt; '20110924';
</pre>
<p>A complex filter can have various combinations of operators, such as:</p>
<pre class="code">
a = load 'web_logs' using org.apache.hcatalog.pig.HCatLoader();
b = filter a by datestamp == '20110924' or datestamp == '20110925';
</pre>
<p>These two examples have the same effect:</p>
<pre class="code">
a = load 'web_logs' using org.apache.hcatalog.pig.HCatLoader();
b = filter a by datestamp &gt;= '20110924' and datestamp &lt;= '20110925';
</pre>
<pre class="code">
a = load 'web_logs' using org.apache.hcatalog.pig.HCatLoader();
b = filter a by datestamp &lt;= '20110925' and datestamp &gt;= '20110924';
</pre>
</div> 
	
<!-- ==================================================================== -->	
	
<a name="HCatStorer"></a>
<h2 class="h3">HCatStorer</h2>
<div class="section">
<p>HCatStorer is used with Pig scripts to write data to HCatalog managed tables.</p>
<a name="Usage-N1013D"></a>
<h3 class="h4">Usage</h3>
<p>HCatStorer is accessed via a Pig store statement.</p>
<pre class="code">
A = LOAD ...
B = FOREACH A ...
...
...
my_processed_data = ...

STORE my_processed_data INTO 'tablename' USING
 org.apache.hcatalog.pig.HCatStorer();
</pre>
<p>
<strong>Assumptions</strong>
</p>
<p>You must specify the table name in single quotes: LOAD 'tablename'. Both the database and table must be created prior to running your Pig script. If you are using a non-default database you must specify your input as 'dbname.tablename'. If you are using Pig 0.9.2 or earlier, you must create your database and table prior to running the Pig script. Beginning with Pig 0.10 you can issue these create commands in Pig using the SQL command. </p>
<p>The Hive metastore lets you create tables without specifying a database; if you created
tables this way, then the database name is 'default' and you do not need to specify the
database name in the store statement. </p>
<p>For the USING clause, you can have a string argument that represents key/value pairs
for partition. This is a mandatory argument when you are writing to a partitioned table
and the partition column is not in the output column.  The values for partition keys
should NOT be quoted.</p>
<p>If partition columns are present in data they need not be specified as a STORE argument. Instead HCatalog will use these values to place records in the appropriate partition(s). It is valid to specify some partition keys in the STORE statement and have other partition keys in the data.</p>
<p></p>
<p></p>
<a name="Store+Examples"></a>
<h3 class="h4">Store Examples</h3>
<p>You can write to non-partitioned table simply by using HCatStorer.  The contents of the table will be overwritten:</p>
<pre class="code">store z into 'student_data' using org.apache.hcatalog.pig.HCatStorer();</pre>
<p>To add one new partition to a partitioned table, specify the partition value in store function.  Pay careful
attention to the quoting, as the whole string must be single quoted and separated with an equals sign:</p>
<pre class="code">store z into 'web_data' using org.apache.hcatalog.pig.HCatStorer('datestamp=20110924');</pre>
<p>To write into multiple partitions at one, make sure that the partition column is present in your data, then call
HCatStorer with no argument:</p>
<pre class="code">store z into 'web_data' using org.apache.hcatalog.pig.HCatStorer(); 
  -- datestamp must be a field in the relation z</pre>
<a name="HCatalog+Data+Types-N1017D"></a>
<h3 class="h4">HCatalog Data Types</h3>
<p>Restrictions apply to the types of columns HCatStorer can write.</p>
<p>HCatStorer can write <strong>only</strong> the data types listed in the table. 
The table shows how Pig will interpret the HCatalog data type.</p>
<table class="ForrestTable" cellspacing="1" cellpadding="4">
        
<tr>
            
<td colspan="1" rowspan="1">
               
<p>
<strong>HCatalog Data Type</strong>
</p>
            
</td>
            <td colspan="1" rowspan="1">
               
<p>
<strong>Pig Data Type</strong>
</p>
            
</td>
    
</tr>
    
<tr>
            
<td colspan="1" rowspan="1">
               
<p>primitives (int, long, float, double, string) </p>
            
</td>
            <td colspan="1" rowspan="1">
               
<p>int, long, float, double, string to chararray </p>
            
</td>
    
</tr>
    
<tr>
            
<td colspan="1" rowspan="1">
               
<p>map (key type should be string, valuetype must be string)</p>
            
</td>
            <td colspan="1" rowspan="1">
               
<p>map </p>
            
</td>
    
</tr>
    
<tr>
            
<td colspan="1" rowspan="1">
               
<p>List&lt;any type&gt; </p>
            
</td>
            <td colspan="1" rowspan="1">
               
<p>bag </p>
            
</td>
    
</tr>
    
<tr>
            
<td colspan="1" rowspan="1">
               
<p>struct&lt;any type fields&gt; </p>
            
</td>
            <td colspan="1" rowspan="1">
               
<p>tuple </p>
            
</td>
    
</tr>
 
</table>
</div>
	
  
</div>
<!--+
    |end content
    +-->
<div class="clearboth">&nbsp;</div>
</div>
<div id="footer">
<!--+
    |start bottomstrip
    +-->
<div class="lastmodified">
<script type="text/javascript"><!--
document.write("Last Published: " + document.lastModified);
//  --></script>
</div>
<div class="copyright">
        Copyright &copy;
         2011-2012 <a href="http://www.apache.org/licenses/">The Apache Software Foundation</a>
</div>
<!--+
    |end bottomstrip
    +-->
</div>
</body>
</html>
