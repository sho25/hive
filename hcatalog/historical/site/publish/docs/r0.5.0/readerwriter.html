<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta content="Apache Forrest" name="Generator">
<meta name="Forrest-version" content="0.9">
<meta name="Forrest-skin-name" content="pelt">
<title>Reader and Writer Interfaces</title>
<link type="text/css" href="skin/basic.css" rel="stylesheet">
<link media="screen" type="text/css" href="skin/screen.css" rel="stylesheet">
<link media="print" type="text/css" href="skin/print.css" rel="stylesheet">
<link type="text/css" href="skin/profile.css" rel="stylesheet">
<script src="skin/getBlank.js" language="javascript" type="text/javascript"></script><script src="skin/getMenu.js" language="javascript" type="text/javascript"></script><script src="skin/fontsize.js" language="javascript" type="text/javascript"></script>
<link rel="shortcut icon" href="">
</head>
<body onload="init()">
<script type="text/javascript">ndeSetTextSize();</script>
<div id="top">
<!--+
    |breadtrail
    +-->
<div class="breadtrail">
<script src="skin/breadcrumbs.js" language="JavaScript" type="text/javascript"></script>
</div>
<!--+
    |header
    +-->
<div class="header">
<!--+
    |start group logo
    +-->
<div class="grouplogo">
<a href=""><img class="logoImage" alt="HCatalog" src="images/hcat.jpg" title=""></a>
</div>
<!--+
    |end group logo
    +-->
<!--+
    |start Project Logo
    +-->
<div class="projectlogoA1">
<a href=""><img class="logoImage" alt="HCatalog" src="images/hcat-box.jpg" title="A table abstraction on top of data for use with java MapReduce programs, Pig scripts and Hive queryies."></a>
</div>
<!--+
    |end Project Logo
    +-->
<!--+
    |start Tabs
    +-->
<ul id="tabs">
<li class="current">
<a class="selected" href="index.html">HCatalog 0.5.0 Documentation</a>
</li>
</ul>
<!--+
    |end Tabs
    +-->
</div>
</div>
<div id="main">
<div id="publishedStrip">
<!--+
    |start Subtabs
    +-->
<div id="level2tabs"></div>
<!--+
    |end Endtabs
    +-->
<script type="text/javascript"><!--
document.write("Last Published: " + document.lastModified);
//  --></script>
</div>
<!--+
    |breadtrail
    +-->
<div class="breadtrail">

             &nbsp;
           </div>
<!--+
    |start Menu, mainarea
    +-->
<!--+
    |start Menu
    +-->
<div id="menu">
<div onclick="SwitchMenu('menu_selected_1.1', 'skin/')" id="menu_selected_1.1Title" class="menutitle" style="background-image: url('skin/images/chapter_open.gif');">HCatalog</div>
<div id="menu_selected_1.1" class="selectedmenuitemgroup" style="display: block;">
<div class="menuitem">
<a href="index.html">Overview</a>
</div>
<div class="menuitem">
<a href="install.html">Installation From Tarball</a>
</div>
<div class="menuitem">
<a href="loadstore.html">Load &amp; Store Interfaces</a>
</div>
<div class="menuitem">
<a href="inputoutput.html">Input &amp; Output Interfaces</a>
</div>
<div class="menupage">
<div class="menupagetitle">Reader &amp; Writer Interfaces</div>
</div>
<div class="menuitem">
<a href="cli.html">Command Line Interface</a>
</div>
<div class="menuitem">
<a href="supportedformats.html">Storage Formats</a>
</div>
<div class="menuitem">
<a href="dynpartition.html">Dynamic Partitioning</a>
</div>
<div class="menuitem">
<a href="notification.html">Notification</a>
</div>
<div class="menuitem">
<a href="authorization.html">Authorization</a>
</div>
<div onclick="SwitchMenu('menu_1.1.11', 'skin/')" id="menu_1.1.11Title" class="menutitle">WebHCat</div>
<div id="menu_1.1.11" class="menuitemgroup">
<div class="menuitem">
<a href="rest.html">Overview</a>
</div>
<div class="menuitem">
<a href="rest_server_install.html">Installation</a>
</div>
<div class="menuitem">
<a href="configuration.html">Configuration</a>
</div>
<div onclick="SwitchMenu('menu_1.1.11.4', 'skin/')" id="menu_1.1.11.4Title" class="menutitle">Reference</div>
<div id="menu_1.1.11.4" class="menuitemgroup">
<div class="menuitem">
<a href="resources.html">Resource List</a>
</div>
<div class="menuitem">
<a href="responsetypes.html">:version</a>
</div>
<div class="menuitem">
<a href="status.html">status</a>
</div>
<div class="menuitem">
<a href="versions.html">version</a>
</div>
<div onclick="SwitchMenu('menu_1.1.11.4.5', 'skin/')" id="menu_1.1.11.4.5Title" class="menutitle">ddl</div>
<div id="menu_1.1.11.4.5" class="menuitemgroup">
<div class="menuitem">
<a href="ddlsummary.html">ddl (summary)</a>
</div>
<div class="menuitem">
<a href="ddl.html">ddl</a>
</div>
<div class="menuitem">
<a href="listdbs.html">database</a>
</div>
<div class="menuitem">
<a href="descdb.html">:db (GET)</a>
</div>
<div class="menuitem">
<a href="createdb.html">:db (PUT)</a>
</div>
<div class="menuitem">
<a href="deletedb.html">:db (DELETE)</a>
</div>
<div class="menuitem">
<a href="listtables.html">table</a>
</div>
<div class="menuitem">
<a href="desctable.html">:table (GET)</a>
</div>
<div class="menuitem">
<a href="createtable.html">:table (PUT)</a>
</div>
<div class="menuitem">
<a href="renametable.html">:table (POST)</a>
</div>
<div class="menuitem">
<a href="deletetable.html">:table (DELETE)</a>
</div>
<div class="menuitem">
<a href="createtablelike.html">like/:table (PUT)</a>
</div>
<div class="menuitem">
<a href="listpartitions.html">partition</a>
</div>
<div class="menuitem">
<a href="descpartition.html">:partition (GET)</a>
</div>
<div class="menuitem">
<a href="createpartition.html">:partition (PUT)</a>
</div>
<div class="menuitem">
<a href="deletepartition.html">:partition (DELETE)</a>
</div>
<div class="menuitem">
<a href="listcolumns.html">column</a>
</div>
<div class="menuitem">
<a href="desccolumn.html">:column (GET)</a>
</div>
<div class="menuitem">
<a href="createcolumn.html">:column (PUT)</a>
</div>
<div class="menuitem">
<a href="listproperties.html">property</a>
</div>
<div class="menuitem">
<a href="descproperty.html">:property (GET)</a>
</div>
<div class="menuitem">
<a href="addproperty.html">:property (PUT)</a>
</div>
</div>
<div class="menuitem">
<a href="mapreducestreaming.html">mapreduce/streaming</a>
</div>
<div class="menuitem">
<a href="mapreducejar.html">mapreduce/jar</a>
</div>
<div class="menuitem">
<a href="pig.html">pig</a>
</div>
<div class="menuitem">
<a href="hive.html">hive</a>
</div>
<div class="menuitem">
<a href="queuelist.html">queue</a>
</div>
<div class="menuitem">
<a href="queue.html">:jobid (GET)</a>
</div>
<div class="menuitem">
<a href="queuedelete.html">:jobid (DELETE)</a>
</div>
</div>
</div>
<div class="menuitem">
<a href="api/index.html">API Docs</a>
</div>
</div>
<div id="credit"></div>
<div id="roundbottom">
<img style="display: none" class="corner" height="15" width="15" alt="" src="skin/images/rc-b-l-15-1body-2menu-3menu.png"></div>
<!--+
  |alternative credits
  +-->
<div id="credit2"></div>
</div>
<!--+
    |end Menu
    +-->
<!--+
    |start content
    +-->
<div id="content">
<div title="Portable Document Format" class="pdflink">
<a class="dida" href="readerwriter.pdf"><img alt="PDF -icon" src="skin/images/pdfdoc.gif" class="skin"><br>
        PDF</a>
</div>
<h1>Reader and Writer Interfaces</h1>
<div id="front-matter">
<div id="minitoc-area">
<ul class="minitoc">
<li>
<a href="#HCatReader">HCatReader</a>
</li>
<li>
<a href="#HCatWriter">HCatWriter</a>
</li>
<li>
<a href="#Complete+Example+Program">Complete Example Program</a>
</li>
</ul>
</div>
</div>
  

<p>HCatalog provides a data transfer API for parallel input and output
without using MapReduce. This API provides a way to read data from a
Hadoop cluster or write data into a Hadoop cluster, using a basic storage
abstraction of tables and rows.</p>

<p>The data transfer API has three essential classes:</p>

<ul>
    
<li>HCatReader &ndash; reads data from a Hadoop cluster</li>
    
<li>HCatWriter &ndash; writes data into a Hadoop cluster</li>
    
<li>DataTransferFactory &ndash; generates reader and writer instances</li>

</ul>

<p>Auxiliary classes in the data transfer API include:</p>

<ul>
    
<li>ReadEntity</li>
    
<li>ReaderContext</li>
    
<li>WriteEntity</li>
    
<li>WriterContext</li>

</ul>

<p>The HCatalog data transfer API is designed to facilitate integration
of external systems with Hadoop.</p>

<!-- ==================================================================== -->

<a name="HCatReader"></a>
<h2 class="h3">HCatReader</h2>
<div class="section">
<p>Reading is a two-step process in which the first step occurs on
the master node of an external system. The second step is done in
parallel on multiple slave nodes.</p>
<p>Reads are done on a &ldquo;ReadEntity&rdquo;. Before you start to read, you need to define
a ReadEntity from which to read. This can be done through ReadEntity.Builder. You
can specify a database name, table name, partition, and filter string.
For example:</p>
<pre class="code">
ReadEntity.Builder builder = new ReadEntity.Builder();
ReadEntity entity = builder.withDatabase(&ldquo;mydb&rdquo;).withTable("mytbl").build();
</pre>
<p>The code snippet above defines a ReadEntity object ("<span class="codefrag">entity</span>"),
comprising a table named &ldquo;mytbl&rdquo; in a database named &ldquo;mydb&rdquo;, which can be used
to read all the rows of this table.
Note that this table must exist in HCatalog prior to the start of this
operation.</p>
<p>After defining a ReadEntity, you obtain an instance of HCatReader
using the ReadEntity and cluster configuration:</p>
<pre class="code">
HCatReader reader = DataTransferFactory.getHCatReader(entity, config);
</pre>
<p>The next step is to obtain a ReaderContext from <span class="codefrag">reader</span>
as follows:</p>
<pre class="code">
ReaderContext cntxt = reader.prepareRead();
</pre>
<p>All of the above steps occur on the master node. The master node then
serializes this ReaderContext object and sends it to all the slave nodes.
Slave nodes then use this reader context to read data.</p>
<pre class="code">
for(InputSplit split : readCntxt.getSplits()){
HCatReader reader = DataTransferFactory.getHCatReader(split,
readerCntxt.getConf());
       Iterator&lt;HCatRecord&gt; itr = reader.read();
       while(itr.hasNext()){
              HCatRecord read = itr.next();
          }
}
</pre>
</div>

<!-- ==================================================================== -->

<a name="HCatWriter"></a>
<h2 class="h3">HCatWriter</h2>
<div class="section">
<p>Similar to reading, writing is also a two-step process in which the first
step occurs on the master node. Subsequently, the second step occurs in
parallel on slave nodes.</p>
<p>Writes are done on a &ldquo;WriteEntity&rdquo; which can be constructed in a fashion
similar to reads:</p>
<pre class="code">
WriteEntity.Builder builder = new WriteEntity.Builder();
WriteEntity entity = builder.withDatabase(&ldquo;mydb&rdquo;).withTable("mytbl").build();
</pre>
<p>The code above creates a WriteEntity object ("entity") which can be used
to write into a table named &ldquo;mytbl&rdquo; in the database &ldquo;mydb&rdquo;.</p>
<p>After creating a WriteEntity, the next step is to obtain a WriterContext:</p>
<pre class="code">
HCatWriter writer = DataTransferFactory.getHCatWriter(entity, config);
WriterContext info = writer.prepareWrite();
</pre>
<p>All of the above steps occur on the master node. The master node then
serializes the WriterContext object and makes it available to all the
slaves.</p>
<p>On slave nodes, you need to obtain an HCatWriter using WriterContext
as follows:</p>
<pre class="code">
HCatWriter writer = DataTransferFactory.getHCatWriter(context);
</pre>
<p>Then, <span class="codefrag">writer</span> takes an iterator as the argument for
the <span class="codefrag">write</span> method:</p>
<pre class="code">
writer.write(hCatRecordItr);
</pre>
<p>The <span class="codefrag">writer</span> then calls getNext() on this iterator in a loop
and writes out all the records attached to the iterator.</p>
</div>

<!-- ==================================================================== -->

<a name="Complete+Example+Program"></a>
<h2 class="h3">Complete Example Program</h2>
<div class="section">
<p>A complete java program for the reader and writer examples above can be found at: <a href="https://svn.apache.org/repos/asf/incubator/hcatalog/trunk/src/test/org/apache/hcatalog/data/TestReaderWriter.java">https://svn.apache.org/repos/asf/incubator/hcatalog/trunk/src/test/org/apache/hcatalog/data/TestReaderWriter.java</a>.</p>
</div>


    
  
</div>
<!--+
    |end content
    +-->
<div class="clearboth">&nbsp;</div>
</div>
<div id="footer">
<!--+
    |start bottomstrip
    +-->
<div class="lastmodified">
<script type="text/javascript"><!--
document.write("Last Published: " + document.lastModified);
//  --></script>
</div>
<div class="copyright">
        Copyright &copy;
         2012-2013 <a href="http://www.apache.org/licenses/">The Apache Software Foundation</a>
</div>
<!--+
    |end bottomstrip
    +-->
</div>
</body>
</html>
