begin_unit|revision:0.9.5;language:Java;cregit-version:0.0.1
begin_comment
comment|/**  * Licensed to the Apache Software Foundation (ASF) under one  * or more contributor license agreements.  See the NOTICE file  * distributed with this work for additional information  * regarding copyright ownership.  The ASF licenses this file  * to you under the Apache License, Version 2.0 (the  * "License"); you may not use this file except in compliance  * with the License.  You may obtain a copy of the License at  *  *     http://www.apache.org/licenses/LICENSE-2.0  *  * Unless required by applicable law or agreed to in writing,  * software distributed under the License is distributed on an  * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY  * KIND, either express or implied.  See the License for the  * specific language governing permissions and limitations  * under the License.  */
end_comment

begin_package
package|package
name|org
operator|.
name|apache
operator|.
name|hive
operator|.
name|hcatalog
operator|.
name|templeton
package|;
end_package

begin_import
import|import
name|java
operator|.
name|io
operator|.
name|IOException
import|;
end_import

begin_import
import|import
name|java
operator|.
name|net
operator|.
name|InetAddress
import|;
end_import

begin_import
import|import
name|java
operator|.
name|net
operator|.
name|UnknownHostException
import|;
end_import

begin_import
import|import
name|java
operator|.
name|text
operator|.
name|MessageFormat
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|ArrayList
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|Collections
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|HashMap
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|List
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|Map
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|regex
operator|.
name|Matcher
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|regex
operator|.
name|Pattern
import|;
end_import

begin_import
import|import
name|javax
operator|.
name|servlet
operator|.
name|http
operator|.
name|HttpServletRequest
import|;
end_import

begin_import
import|import
name|javax
operator|.
name|ws
operator|.
name|rs
operator|.
name|DELETE
import|;
end_import

begin_import
import|import
name|javax
operator|.
name|ws
operator|.
name|rs
operator|.
name|FormParam
import|;
end_import

begin_import
import|import
name|javax
operator|.
name|ws
operator|.
name|rs
operator|.
name|GET
import|;
end_import

begin_import
import|import
name|javax
operator|.
name|ws
operator|.
name|rs
operator|.
name|POST
import|;
end_import

begin_import
import|import
name|javax
operator|.
name|ws
operator|.
name|rs
operator|.
name|PUT
import|;
end_import

begin_import
import|import
name|javax
operator|.
name|ws
operator|.
name|rs
operator|.
name|Path
import|;
end_import

begin_import
import|import
name|javax
operator|.
name|ws
operator|.
name|rs
operator|.
name|PathParam
import|;
end_import

begin_import
import|import
name|javax
operator|.
name|ws
operator|.
name|rs
operator|.
name|Produces
import|;
end_import

begin_import
import|import
name|javax
operator|.
name|ws
operator|.
name|rs
operator|.
name|QueryParam
import|;
end_import

begin_import
import|import
name|javax
operator|.
name|ws
operator|.
name|rs
operator|.
name|core
operator|.
name|Context
import|;
end_import

begin_import
import|import
name|javax
operator|.
name|ws
operator|.
name|rs
operator|.
name|core
operator|.
name|MediaType
import|;
end_import

begin_import
import|import
name|javax
operator|.
name|ws
operator|.
name|rs
operator|.
name|core
operator|.
name|Response
import|;
end_import

begin_import
import|import
name|javax
operator|.
name|ws
operator|.
name|rs
operator|.
name|core
operator|.
name|SecurityContext
import|;
end_import

begin_import
import|import
name|javax
operator|.
name|ws
operator|.
name|rs
operator|.
name|core
operator|.
name|UriInfo
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|commons
operator|.
name|exec
operator|.
name|ExecuteException
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|commons
operator|.
name|logging
operator|.
name|Log
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|commons
operator|.
name|logging
operator|.
name|LogFactory
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hive
operator|.
name|shims
operator|.
name|ShimLoader
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|security
operator|.
name|UserGroupInformation
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|security
operator|.
name|authentication
operator|.
name|client
operator|.
name|PseudoAuthenticator
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hive
operator|.
name|hcatalog
operator|.
name|templeton
operator|.
name|LauncherDelegator
operator|.
name|JobType
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hive
operator|.
name|hcatalog
operator|.
name|templeton
operator|.
name|tool
operator|.
name|TempletonUtils
import|;
end_import

begin_comment
comment|/**  * The Templeton Web API server.  */
end_comment

begin_class
annotation|@
name|Path
argument_list|(
literal|"/v1"
argument_list|)
specifier|public
class|class
name|Server
block|{
specifier|public
specifier|static
specifier|final
name|String
name|VERSION
init|=
literal|"v1"
decl_stmt|;
specifier|public
specifier|static
specifier|final
name|String
name|DO_AS_PARAM
init|=
literal|"doAs"
decl_stmt|;
comment|/**    * The status message.  Always "ok"    */
specifier|public
specifier|static
specifier|final
name|Map
argument_list|<
name|String
argument_list|,
name|String
argument_list|>
name|STATUS_OK
init|=
name|createStatusMsg
argument_list|()
decl_stmt|;
comment|/**    * The list of supported api versions.    */
specifier|public
specifier|static
specifier|final
name|Map
argument_list|<
name|String
argument_list|,
name|Object
argument_list|>
name|SUPPORTED_VERSIONS
init|=
name|createVersions
argument_list|()
decl_stmt|;
comment|/**    * The list of supported return formats.  Always json.    */
specifier|public
specifier|static
specifier|final
name|Map
argument_list|<
name|String
argument_list|,
name|Object
argument_list|>
name|SUPPORTED_FORMATS
init|=
name|createFormats
argument_list|()
decl_stmt|;
comment|// Build the status message for the /status call.
specifier|private
specifier|static
name|Map
argument_list|<
name|String
argument_list|,
name|String
argument_list|>
name|createStatusMsg
parameter_list|()
block|{
name|HashMap
argument_list|<
name|String
argument_list|,
name|String
argument_list|>
name|res
init|=
operator|new
name|HashMap
argument_list|<
name|String
argument_list|,
name|String
argument_list|>
argument_list|()
decl_stmt|;
name|res
operator|.
name|put
argument_list|(
literal|"status"
argument_list|,
literal|"ok"
argument_list|)
expr_stmt|;
name|res
operator|.
name|put
argument_list|(
literal|"version"
argument_list|,
name|VERSION
argument_list|)
expr_stmt|;
return|return
name|Collections
operator|.
name|unmodifiableMap
argument_list|(
name|res
argument_list|)
return|;
block|}
comment|// Build the versions list.
specifier|private
specifier|static
name|Map
argument_list|<
name|String
argument_list|,
name|Object
argument_list|>
name|createVersions
parameter_list|()
block|{
name|ArrayList
argument_list|<
name|String
argument_list|>
name|versions
init|=
operator|new
name|ArrayList
argument_list|<
name|String
argument_list|>
argument_list|()
decl_stmt|;
name|versions
operator|.
name|add
argument_list|(
name|VERSION
argument_list|)
expr_stmt|;
name|HashMap
argument_list|<
name|String
argument_list|,
name|Object
argument_list|>
name|res
init|=
operator|new
name|HashMap
argument_list|<
name|String
argument_list|,
name|Object
argument_list|>
argument_list|()
decl_stmt|;
name|res
operator|.
name|put
argument_list|(
literal|"supportedVersions"
argument_list|,
name|versions
argument_list|)
expr_stmt|;
name|res
operator|.
name|put
argument_list|(
literal|"version"
argument_list|,
name|VERSION
argument_list|)
expr_stmt|;
return|return
name|Collections
operator|.
name|unmodifiableMap
argument_list|(
name|res
argument_list|)
return|;
block|}
comment|// Build the supported formats list
specifier|private
specifier|static
name|Map
argument_list|<
name|String
argument_list|,
name|Object
argument_list|>
name|createFormats
parameter_list|()
block|{
name|ArrayList
argument_list|<
name|String
argument_list|>
name|formats
init|=
operator|new
name|ArrayList
argument_list|<
name|String
argument_list|>
argument_list|()
decl_stmt|;
name|formats
operator|.
name|add
argument_list|(
name|MediaType
operator|.
name|APPLICATION_JSON
argument_list|)
expr_stmt|;
name|HashMap
argument_list|<
name|String
argument_list|,
name|Object
argument_list|>
name|res
init|=
operator|new
name|HashMap
argument_list|<
name|String
argument_list|,
name|Object
argument_list|>
argument_list|()
decl_stmt|;
name|res
operator|.
name|put
argument_list|(
literal|"responseTypes"
argument_list|,
name|formats
argument_list|)
expr_stmt|;
return|return
name|Collections
operator|.
name|unmodifiableMap
argument_list|(
name|res
argument_list|)
return|;
block|}
specifier|protected
specifier|static
name|ExecService
name|execService
init|=
name|ExecServiceImpl
operator|.
name|getInstance
argument_list|()
decl_stmt|;
specifier|private
specifier|static
name|AppConfig
name|appConf
init|=
name|Main
operator|.
name|getAppConfigInstance
argument_list|()
decl_stmt|;
comment|// The SecurityContext set by AuthFilter
specifier|private
annotation|@
name|Context
name|SecurityContext
name|theSecurityContext
decl_stmt|;
comment|// The uri requested
specifier|private
annotation|@
name|Context
name|UriInfo
name|theUriInfo
decl_stmt|;
specifier|private
annotation|@
name|QueryParam
argument_list|(
name|DO_AS_PARAM
argument_list|)
name|String
name|doAs
decl_stmt|;
specifier|private
annotation|@
name|Context
name|HttpServletRequest
name|request
decl_stmt|;
specifier|private
specifier|static
specifier|final
name|Log
name|LOG
init|=
name|LogFactory
operator|.
name|getLog
argument_list|(
name|Server
operator|.
name|class
argument_list|)
decl_stmt|;
comment|/**    * Check the status of this server.  Always OK.    */
annotation|@
name|GET
annotation|@
name|Path
argument_list|(
literal|"status"
argument_list|)
annotation|@
name|Produces
argument_list|(
block|{
name|MediaType
operator|.
name|APPLICATION_JSON
block|}
argument_list|)
specifier|public
name|Map
argument_list|<
name|String
argument_list|,
name|String
argument_list|>
name|status
parameter_list|()
block|{
return|return
name|STATUS_OK
return|;
block|}
comment|/**    * Check the supported request formats of this server.    */
annotation|@
name|GET
annotation|@
name|Produces
argument_list|(
block|{
name|MediaType
operator|.
name|APPLICATION_JSON
block|}
argument_list|)
specifier|public
name|Map
argument_list|<
name|String
argument_list|,
name|Object
argument_list|>
name|requestFormats
parameter_list|()
block|{
return|return
name|SUPPORTED_FORMATS
return|;
block|}
comment|/**    * Check the version(s) supported by this server.    */
annotation|@
name|GET
annotation|@
name|Path
argument_list|(
literal|"version"
argument_list|)
annotation|@
name|Produces
argument_list|(
block|{
name|MediaType
operator|.
name|APPLICATION_JSON
block|}
argument_list|)
specifier|public
name|Map
argument_list|<
name|String
argument_list|,
name|Object
argument_list|>
name|version
parameter_list|()
block|{
return|return
name|SUPPORTED_VERSIONS
return|;
block|}
comment|/**    * Get version of hadoop software being run by this WebHCat server    */
annotation|@
name|GET
annotation|@
name|Path
argument_list|(
literal|"version/hadoop"
argument_list|)
annotation|@
name|Produces
argument_list|(
name|MediaType
operator|.
name|APPLICATION_JSON
argument_list|)
specifier|public
name|Response
name|hadoopVersion
parameter_list|()
throws|throws
name|IOException
block|{
name|VersionDelegator
name|d
init|=
operator|new
name|VersionDelegator
argument_list|(
name|appConf
argument_list|)
decl_stmt|;
return|return
name|d
operator|.
name|getVersion
argument_list|(
literal|"hadoop"
argument_list|)
return|;
block|}
comment|/**    * Get version of hive software being run by this WebHCat server    */
annotation|@
name|GET
annotation|@
name|Path
argument_list|(
literal|"version/hive"
argument_list|)
annotation|@
name|Produces
argument_list|(
name|MediaType
operator|.
name|APPLICATION_JSON
argument_list|)
specifier|public
name|Response
name|hiveVersion
parameter_list|()
throws|throws
name|IOException
block|{
name|VersionDelegator
name|d
init|=
operator|new
name|VersionDelegator
argument_list|(
name|appConf
argument_list|)
decl_stmt|;
return|return
name|d
operator|.
name|getVersion
argument_list|(
literal|"hive"
argument_list|)
return|;
block|}
comment|/**    * Get version of sqoop software being run by this WebHCat server    */
annotation|@
name|GET
annotation|@
name|Path
argument_list|(
literal|"version/sqoop"
argument_list|)
annotation|@
name|Produces
argument_list|(
name|MediaType
operator|.
name|APPLICATION_JSON
argument_list|)
specifier|public
name|Response
name|sqoopVersion
parameter_list|()
throws|throws
name|IOException
block|{
name|VersionDelegator
name|d
init|=
operator|new
name|VersionDelegator
argument_list|(
name|appConf
argument_list|)
decl_stmt|;
return|return
name|d
operator|.
name|getVersion
argument_list|(
literal|"sqoop"
argument_list|)
return|;
block|}
comment|/**    * Get version of pig software being run by this WebHCat server    */
annotation|@
name|GET
annotation|@
name|Path
argument_list|(
literal|"version/pig"
argument_list|)
annotation|@
name|Produces
argument_list|(
name|MediaType
operator|.
name|APPLICATION_JSON
argument_list|)
specifier|public
name|Response
name|pigVersion
parameter_list|()
throws|throws
name|IOException
block|{
name|VersionDelegator
name|d
init|=
operator|new
name|VersionDelegator
argument_list|(
name|appConf
argument_list|)
decl_stmt|;
return|return
name|d
operator|.
name|getVersion
argument_list|(
literal|"pig"
argument_list|)
return|;
block|}
comment|/**    * Execute an hcat ddl expression on the local box.  It is run    * as the authenticated user and rate limited.    */
annotation|@
name|POST
annotation|@
name|Path
argument_list|(
literal|"ddl"
argument_list|)
annotation|@
name|Produces
argument_list|(
block|{
name|MediaType
operator|.
name|APPLICATION_JSON
block|}
argument_list|)
specifier|public
name|ExecBean
name|ddl
parameter_list|(
annotation|@
name|FormParam
argument_list|(
literal|"exec"
argument_list|)
name|String
name|exec
parameter_list|,
annotation|@
name|FormParam
argument_list|(
literal|"group"
argument_list|)
name|String
name|group
parameter_list|,
annotation|@
name|FormParam
argument_list|(
literal|"permissions"
argument_list|)
name|String
name|permissions
parameter_list|)
throws|throws
name|NotAuthorizedException
throws|,
name|BusyException
throws|,
name|BadParam
throws|,
name|ExecuteException
throws|,
name|IOException
block|{
name|verifyUser
argument_list|()
expr_stmt|;
name|verifyParam
argument_list|(
name|exec
argument_list|,
literal|"exec"
argument_list|)
expr_stmt|;
name|HcatDelegator
name|d
init|=
operator|new
name|HcatDelegator
argument_list|(
name|appConf
argument_list|,
name|execService
argument_list|)
decl_stmt|;
return|return
name|d
operator|.
name|run
argument_list|(
name|getDoAsUser
argument_list|()
argument_list|,
name|exec
argument_list|,
literal|false
argument_list|,
name|group
argument_list|,
name|permissions
argument_list|)
return|;
block|}
comment|/**    * List all the tables in an hcat database.    */
annotation|@
name|GET
annotation|@
name|Path
argument_list|(
literal|"ddl/database/{db}/table"
argument_list|)
annotation|@
name|Produces
argument_list|(
name|MediaType
operator|.
name|APPLICATION_JSON
argument_list|)
specifier|public
name|Response
name|listTables
parameter_list|(
annotation|@
name|PathParam
argument_list|(
literal|"db"
argument_list|)
name|String
name|db
parameter_list|,
annotation|@
name|QueryParam
argument_list|(
literal|"like"
argument_list|)
name|String
name|tablePattern
parameter_list|)
throws|throws
name|HcatException
throws|,
name|NotAuthorizedException
throws|,
name|BusyException
throws|,
name|BadParam
throws|,
name|ExecuteException
throws|,
name|IOException
block|{
name|verifyUser
argument_list|()
expr_stmt|;
name|verifyDdlParam
argument_list|(
name|db
argument_list|,
literal|":db"
argument_list|)
expr_stmt|;
name|HcatDelegator
name|d
init|=
operator|new
name|HcatDelegator
argument_list|(
name|appConf
argument_list|,
name|execService
argument_list|)
decl_stmt|;
if|if
condition|(
operator|!
name|TempletonUtils
operator|.
name|isset
argument_list|(
name|tablePattern
argument_list|)
condition|)
block|{
name|tablePattern
operator|=
literal|"*"
expr_stmt|;
block|}
return|return
name|d
operator|.
name|listTables
argument_list|(
name|getDoAsUser
argument_list|()
argument_list|,
name|db
argument_list|,
name|tablePattern
argument_list|)
return|;
block|}
comment|/**    * Create a new table.    */
annotation|@
name|PUT
annotation|@
name|Path
argument_list|(
literal|"ddl/database/{db}/table/{table}"
argument_list|)
annotation|@
name|Produces
argument_list|(
name|MediaType
operator|.
name|APPLICATION_JSON
argument_list|)
specifier|public
name|Response
name|createTable
parameter_list|(
annotation|@
name|PathParam
argument_list|(
literal|"db"
argument_list|)
name|String
name|db
parameter_list|,
annotation|@
name|PathParam
argument_list|(
literal|"table"
argument_list|)
name|String
name|table
parameter_list|,
name|TableDesc
name|desc
parameter_list|)
throws|throws
name|SimpleWebException
throws|,
name|NotAuthorizedException
throws|,
name|BusyException
throws|,
name|BadParam
throws|,
name|ExecuteException
throws|,
name|IOException
block|{
name|verifyUser
argument_list|()
expr_stmt|;
name|verifyDdlParam
argument_list|(
name|db
argument_list|,
literal|":db"
argument_list|)
expr_stmt|;
name|verifyDdlParam
argument_list|(
name|table
argument_list|,
literal|":table"
argument_list|)
expr_stmt|;
name|desc
operator|.
name|table
operator|=
name|table
expr_stmt|;
name|HcatDelegator
name|d
init|=
operator|new
name|HcatDelegator
argument_list|(
name|appConf
argument_list|,
name|execService
argument_list|)
decl_stmt|;
return|return
name|d
operator|.
name|createTable
argument_list|(
name|getDoAsUser
argument_list|()
argument_list|,
name|db
argument_list|,
name|desc
argument_list|)
return|;
block|}
comment|/**    * Create a new table like another table.    */
annotation|@
name|PUT
annotation|@
name|Path
argument_list|(
literal|"ddl/database/{db}/table/{existingTable}/like/{newTable}"
argument_list|)
annotation|@
name|Produces
argument_list|(
name|MediaType
operator|.
name|APPLICATION_JSON
argument_list|)
specifier|public
name|Response
name|createTableLike
parameter_list|(
annotation|@
name|PathParam
argument_list|(
literal|"db"
argument_list|)
name|String
name|db
parameter_list|,
annotation|@
name|PathParam
argument_list|(
literal|"existingTable"
argument_list|)
name|String
name|existingTable
parameter_list|,
annotation|@
name|PathParam
argument_list|(
literal|"newTable"
argument_list|)
name|String
name|newTable
parameter_list|,
name|TableLikeDesc
name|desc
parameter_list|)
throws|throws
name|SimpleWebException
throws|,
name|NotAuthorizedException
throws|,
name|BusyException
throws|,
name|BadParam
throws|,
name|ExecuteException
throws|,
name|IOException
block|{
name|verifyUser
argument_list|()
expr_stmt|;
name|verifyDdlParam
argument_list|(
name|db
argument_list|,
literal|":db"
argument_list|)
expr_stmt|;
name|verifyDdlParam
argument_list|(
name|existingTable
argument_list|,
literal|":existingTable"
argument_list|)
expr_stmt|;
name|verifyDdlParam
argument_list|(
name|newTable
argument_list|,
literal|":newTable"
argument_list|)
expr_stmt|;
name|desc
operator|.
name|existingTable
operator|=
name|existingTable
expr_stmt|;
name|desc
operator|.
name|newTable
operator|=
name|newTable
expr_stmt|;
name|HcatDelegator
name|d
init|=
operator|new
name|HcatDelegator
argument_list|(
name|appConf
argument_list|,
name|execService
argument_list|)
decl_stmt|;
return|return
name|d
operator|.
name|createTableLike
argument_list|(
name|getDoAsUser
argument_list|()
argument_list|,
name|db
argument_list|,
name|desc
argument_list|)
return|;
block|}
comment|/**    * Describe an hcat table.  This is normally a simple list of    * columns (using "desc table"), but the extended format will show    * more information (using "show table extended like").    */
annotation|@
name|GET
annotation|@
name|Path
argument_list|(
literal|"ddl/database/{db}/table/{table}"
argument_list|)
annotation|@
name|Produces
argument_list|(
name|MediaType
operator|.
name|APPLICATION_JSON
argument_list|)
specifier|public
name|Response
name|descTable
parameter_list|(
annotation|@
name|PathParam
argument_list|(
literal|"db"
argument_list|)
name|String
name|db
parameter_list|,
annotation|@
name|PathParam
argument_list|(
literal|"table"
argument_list|)
name|String
name|table
parameter_list|,
annotation|@
name|QueryParam
argument_list|(
literal|"format"
argument_list|)
name|String
name|format
parameter_list|)
throws|throws
name|HcatException
throws|,
name|NotAuthorizedException
throws|,
name|BusyException
throws|,
name|BadParam
throws|,
name|ExecuteException
throws|,
name|IOException
block|{
name|verifyUser
argument_list|()
expr_stmt|;
name|verifyDdlParam
argument_list|(
name|db
argument_list|,
literal|":db"
argument_list|)
expr_stmt|;
name|verifyDdlParam
argument_list|(
name|table
argument_list|,
literal|":table"
argument_list|)
expr_stmt|;
name|HcatDelegator
name|d
init|=
operator|new
name|HcatDelegator
argument_list|(
name|appConf
argument_list|,
name|execService
argument_list|)
decl_stmt|;
if|if
condition|(
literal|"extended"
operator|.
name|equals
argument_list|(
name|format
argument_list|)
condition|)
block|{
return|return
name|d
operator|.
name|descExtendedTable
argument_list|(
name|getDoAsUser
argument_list|()
argument_list|,
name|db
argument_list|,
name|table
argument_list|)
return|;
block|}
else|else
block|{
return|return
name|d
operator|.
name|descTable
argument_list|(
name|getDoAsUser
argument_list|()
argument_list|,
name|db
argument_list|,
name|table
argument_list|,
literal|false
argument_list|)
return|;
block|}
block|}
comment|/**    * Drop an hcat table.    */
annotation|@
name|DELETE
annotation|@
name|Path
argument_list|(
literal|"ddl/database/{db}/table/{table}"
argument_list|)
annotation|@
name|Produces
argument_list|(
name|MediaType
operator|.
name|APPLICATION_JSON
argument_list|)
specifier|public
name|Response
name|dropTable
parameter_list|(
annotation|@
name|PathParam
argument_list|(
literal|"db"
argument_list|)
name|String
name|db
parameter_list|,
annotation|@
name|PathParam
argument_list|(
literal|"table"
argument_list|)
name|String
name|table
parameter_list|,
annotation|@
name|QueryParam
argument_list|(
literal|"ifExists"
argument_list|)
name|boolean
name|ifExists
parameter_list|,
annotation|@
name|QueryParam
argument_list|(
literal|"group"
argument_list|)
name|String
name|group
parameter_list|,
annotation|@
name|QueryParam
argument_list|(
literal|"permissions"
argument_list|)
name|String
name|permissions
parameter_list|)
throws|throws
name|HcatException
throws|,
name|NotAuthorizedException
throws|,
name|BusyException
throws|,
name|BadParam
throws|,
name|ExecuteException
throws|,
name|IOException
block|{
name|verifyUser
argument_list|()
expr_stmt|;
name|verifyDdlParam
argument_list|(
name|db
argument_list|,
literal|":db"
argument_list|)
expr_stmt|;
name|verifyDdlParam
argument_list|(
name|table
argument_list|,
literal|":table"
argument_list|)
expr_stmt|;
name|HcatDelegator
name|d
init|=
operator|new
name|HcatDelegator
argument_list|(
name|appConf
argument_list|,
name|execService
argument_list|)
decl_stmt|;
return|return
name|d
operator|.
name|dropTable
argument_list|(
name|getDoAsUser
argument_list|()
argument_list|,
name|db
argument_list|,
name|table
argument_list|,
name|ifExists
argument_list|,
name|group
argument_list|,
name|permissions
argument_list|)
return|;
block|}
comment|/**    * Rename an hcat table.    */
annotation|@
name|POST
annotation|@
name|Path
argument_list|(
literal|"ddl/database/{db}/table/{table}"
argument_list|)
annotation|@
name|Produces
argument_list|(
name|MediaType
operator|.
name|APPLICATION_JSON
argument_list|)
specifier|public
name|Response
name|renameTable
parameter_list|(
annotation|@
name|PathParam
argument_list|(
literal|"db"
argument_list|)
name|String
name|db
parameter_list|,
annotation|@
name|PathParam
argument_list|(
literal|"table"
argument_list|)
name|String
name|oldTable
parameter_list|,
annotation|@
name|FormParam
argument_list|(
literal|"rename"
argument_list|)
name|String
name|newTable
parameter_list|,
annotation|@
name|FormParam
argument_list|(
literal|"group"
argument_list|)
name|String
name|group
parameter_list|,
annotation|@
name|FormParam
argument_list|(
literal|"permissions"
argument_list|)
name|String
name|permissions
parameter_list|)
throws|throws
name|HcatException
throws|,
name|NotAuthorizedException
throws|,
name|BusyException
throws|,
name|BadParam
throws|,
name|ExecuteException
throws|,
name|IOException
block|{
name|verifyUser
argument_list|()
expr_stmt|;
name|verifyDdlParam
argument_list|(
name|db
argument_list|,
literal|":db"
argument_list|)
expr_stmt|;
name|verifyDdlParam
argument_list|(
name|oldTable
argument_list|,
literal|":table"
argument_list|)
expr_stmt|;
name|verifyDdlParam
argument_list|(
name|newTable
argument_list|,
literal|"rename"
argument_list|)
expr_stmt|;
name|HcatDelegator
name|d
init|=
operator|new
name|HcatDelegator
argument_list|(
name|appConf
argument_list|,
name|execService
argument_list|)
decl_stmt|;
return|return
name|d
operator|.
name|renameTable
argument_list|(
name|getDoAsUser
argument_list|()
argument_list|,
name|db
argument_list|,
name|oldTable
argument_list|,
name|newTable
argument_list|,
name|group
argument_list|,
name|permissions
argument_list|)
return|;
block|}
comment|/**    * Describe a single property on an hcat table.    */
annotation|@
name|GET
annotation|@
name|Path
argument_list|(
literal|"ddl/database/{db}/table/{table}/property/{property}"
argument_list|)
annotation|@
name|Produces
argument_list|(
name|MediaType
operator|.
name|APPLICATION_JSON
argument_list|)
specifier|public
name|Response
name|descOneTableProperty
parameter_list|(
annotation|@
name|PathParam
argument_list|(
literal|"db"
argument_list|)
name|String
name|db
parameter_list|,
annotation|@
name|PathParam
argument_list|(
literal|"table"
argument_list|)
name|String
name|table
parameter_list|,
annotation|@
name|PathParam
argument_list|(
literal|"property"
argument_list|)
name|String
name|property
parameter_list|)
throws|throws
name|HcatException
throws|,
name|NotAuthorizedException
throws|,
name|BusyException
throws|,
name|BadParam
throws|,
name|ExecuteException
throws|,
name|IOException
block|{
name|verifyUser
argument_list|()
expr_stmt|;
name|verifyDdlParam
argument_list|(
name|db
argument_list|,
literal|":db"
argument_list|)
expr_stmt|;
name|verifyDdlParam
argument_list|(
name|table
argument_list|,
literal|":table"
argument_list|)
expr_stmt|;
name|verifyDdlParam
argument_list|(
name|property
argument_list|,
literal|":property"
argument_list|)
expr_stmt|;
name|HcatDelegator
name|d
init|=
operator|new
name|HcatDelegator
argument_list|(
name|appConf
argument_list|,
name|execService
argument_list|)
decl_stmt|;
return|return
name|d
operator|.
name|descTableProperty
argument_list|(
name|getDoAsUser
argument_list|()
argument_list|,
name|db
argument_list|,
name|table
argument_list|,
name|property
argument_list|)
return|;
block|}
comment|/**    * List all the properties on an hcat table.    */
annotation|@
name|GET
annotation|@
name|Path
argument_list|(
literal|"ddl/database/{db}/table/{table}/property"
argument_list|)
annotation|@
name|Produces
argument_list|(
name|MediaType
operator|.
name|APPLICATION_JSON
argument_list|)
specifier|public
name|Response
name|listTableProperties
parameter_list|(
annotation|@
name|PathParam
argument_list|(
literal|"db"
argument_list|)
name|String
name|db
parameter_list|,
annotation|@
name|PathParam
argument_list|(
literal|"table"
argument_list|)
name|String
name|table
parameter_list|)
throws|throws
name|HcatException
throws|,
name|NotAuthorizedException
throws|,
name|BusyException
throws|,
name|BadParam
throws|,
name|ExecuteException
throws|,
name|IOException
block|{
name|verifyUser
argument_list|()
expr_stmt|;
name|verifyDdlParam
argument_list|(
name|db
argument_list|,
literal|":db"
argument_list|)
expr_stmt|;
name|verifyDdlParam
argument_list|(
name|table
argument_list|,
literal|":table"
argument_list|)
expr_stmt|;
name|HcatDelegator
name|d
init|=
operator|new
name|HcatDelegator
argument_list|(
name|appConf
argument_list|,
name|execService
argument_list|)
decl_stmt|;
return|return
name|d
operator|.
name|listTableProperties
argument_list|(
name|getDoAsUser
argument_list|()
argument_list|,
name|db
argument_list|,
name|table
argument_list|)
return|;
block|}
comment|/**    * Add a single property on an hcat table.    */
annotation|@
name|PUT
annotation|@
name|Path
argument_list|(
literal|"ddl/database/{db}/table/{table}/property/{property}"
argument_list|)
annotation|@
name|Produces
argument_list|(
name|MediaType
operator|.
name|APPLICATION_JSON
argument_list|)
specifier|public
name|Response
name|addOneTableProperty
parameter_list|(
annotation|@
name|PathParam
argument_list|(
literal|"db"
argument_list|)
name|String
name|db
parameter_list|,
annotation|@
name|PathParam
argument_list|(
literal|"table"
argument_list|)
name|String
name|table
parameter_list|,
annotation|@
name|PathParam
argument_list|(
literal|"property"
argument_list|)
name|String
name|property
parameter_list|,
name|TablePropertyDesc
name|desc
parameter_list|)
throws|throws
name|HcatException
throws|,
name|NotAuthorizedException
throws|,
name|BusyException
throws|,
name|BadParam
throws|,
name|ExecuteException
throws|,
name|IOException
block|{
name|verifyUser
argument_list|()
expr_stmt|;
name|verifyDdlParam
argument_list|(
name|db
argument_list|,
literal|":db"
argument_list|)
expr_stmt|;
name|verifyDdlParam
argument_list|(
name|table
argument_list|,
literal|":table"
argument_list|)
expr_stmt|;
name|verifyDdlParam
argument_list|(
name|property
argument_list|,
literal|":property"
argument_list|)
expr_stmt|;
name|desc
operator|.
name|name
operator|=
name|property
expr_stmt|;
name|HcatDelegator
name|d
init|=
operator|new
name|HcatDelegator
argument_list|(
name|appConf
argument_list|,
name|execService
argument_list|)
decl_stmt|;
return|return
name|d
operator|.
name|addOneTableProperty
argument_list|(
name|getDoAsUser
argument_list|()
argument_list|,
name|db
argument_list|,
name|table
argument_list|,
name|desc
argument_list|)
return|;
block|}
comment|/**    * List all the partitions in an hcat table.    */
annotation|@
name|GET
annotation|@
name|Path
argument_list|(
literal|"ddl/database/{db}/table/{table}/partition"
argument_list|)
annotation|@
name|Produces
argument_list|(
name|MediaType
operator|.
name|APPLICATION_JSON
argument_list|)
specifier|public
name|Response
name|listPartitions
parameter_list|(
annotation|@
name|PathParam
argument_list|(
literal|"db"
argument_list|)
name|String
name|db
parameter_list|,
annotation|@
name|PathParam
argument_list|(
literal|"table"
argument_list|)
name|String
name|table
parameter_list|)
throws|throws
name|HcatException
throws|,
name|NotAuthorizedException
throws|,
name|BusyException
throws|,
name|BadParam
throws|,
name|ExecuteException
throws|,
name|IOException
block|{
name|verifyUser
argument_list|()
expr_stmt|;
name|verifyDdlParam
argument_list|(
name|db
argument_list|,
literal|":db"
argument_list|)
expr_stmt|;
name|verifyDdlParam
argument_list|(
name|table
argument_list|,
literal|":table"
argument_list|)
expr_stmt|;
name|HcatDelegator
name|d
init|=
operator|new
name|HcatDelegator
argument_list|(
name|appConf
argument_list|,
name|execService
argument_list|)
decl_stmt|;
return|return
name|d
operator|.
name|listPartitions
argument_list|(
name|getDoAsUser
argument_list|()
argument_list|,
name|db
argument_list|,
name|table
argument_list|)
return|;
block|}
comment|/**    * Describe a single partition in an hcat table.    */
annotation|@
name|GET
annotation|@
name|Path
argument_list|(
literal|"ddl/database/{db}/table/{table}/partition/{partition}"
argument_list|)
annotation|@
name|Produces
argument_list|(
name|MediaType
operator|.
name|APPLICATION_JSON
argument_list|)
specifier|public
name|Response
name|descPartition
parameter_list|(
annotation|@
name|PathParam
argument_list|(
literal|"db"
argument_list|)
name|String
name|db
parameter_list|,
annotation|@
name|PathParam
argument_list|(
literal|"table"
argument_list|)
name|String
name|table
parameter_list|,
annotation|@
name|PathParam
argument_list|(
literal|"partition"
argument_list|)
name|String
name|partition
parameter_list|)
throws|throws
name|HcatException
throws|,
name|NotAuthorizedException
throws|,
name|BusyException
throws|,
name|BadParam
throws|,
name|ExecuteException
throws|,
name|IOException
block|{
name|verifyUser
argument_list|()
expr_stmt|;
name|verifyDdlParam
argument_list|(
name|db
argument_list|,
literal|":db"
argument_list|)
expr_stmt|;
name|verifyDdlParam
argument_list|(
name|table
argument_list|,
literal|":table"
argument_list|)
expr_stmt|;
name|verifyParam
argument_list|(
name|partition
argument_list|,
literal|":partition"
argument_list|)
expr_stmt|;
name|HcatDelegator
name|d
init|=
operator|new
name|HcatDelegator
argument_list|(
name|appConf
argument_list|,
name|execService
argument_list|)
decl_stmt|;
return|return
name|d
operator|.
name|descOnePartition
argument_list|(
name|getDoAsUser
argument_list|()
argument_list|,
name|db
argument_list|,
name|table
argument_list|,
name|partition
argument_list|)
return|;
block|}
comment|/**    * Create a partition in an hcat table.    */
annotation|@
name|PUT
annotation|@
name|Path
argument_list|(
literal|"ddl/database/{db}/table/{table}/partition/{partition}"
argument_list|)
annotation|@
name|Produces
argument_list|(
name|MediaType
operator|.
name|APPLICATION_JSON
argument_list|)
specifier|public
name|Response
name|addOnePartition
parameter_list|(
annotation|@
name|PathParam
argument_list|(
literal|"db"
argument_list|)
name|String
name|db
parameter_list|,
annotation|@
name|PathParam
argument_list|(
literal|"table"
argument_list|)
name|String
name|table
parameter_list|,
annotation|@
name|PathParam
argument_list|(
literal|"partition"
argument_list|)
name|String
name|partition
parameter_list|,
name|PartitionDesc
name|desc
parameter_list|)
throws|throws
name|HcatException
throws|,
name|NotAuthorizedException
throws|,
name|BusyException
throws|,
name|BadParam
throws|,
name|ExecuteException
throws|,
name|IOException
block|{
name|verifyUser
argument_list|()
expr_stmt|;
name|verifyDdlParam
argument_list|(
name|db
argument_list|,
literal|":db"
argument_list|)
expr_stmt|;
name|verifyDdlParam
argument_list|(
name|table
argument_list|,
literal|":table"
argument_list|)
expr_stmt|;
name|verifyParam
argument_list|(
name|partition
argument_list|,
literal|":partition"
argument_list|)
expr_stmt|;
name|desc
operator|.
name|partition
operator|=
name|partition
expr_stmt|;
name|HcatDelegator
name|d
init|=
operator|new
name|HcatDelegator
argument_list|(
name|appConf
argument_list|,
name|execService
argument_list|)
decl_stmt|;
return|return
name|d
operator|.
name|addOnePartition
argument_list|(
name|getDoAsUser
argument_list|()
argument_list|,
name|db
argument_list|,
name|table
argument_list|,
name|desc
argument_list|)
return|;
block|}
comment|/**    * Drop a partition in an hcat table.    */
annotation|@
name|DELETE
annotation|@
name|Path
argument_list|(
literal|"ddl/database/{db}/table/{table}/partition/{partition}"
argument_list|)
annotation|@
name|Produces
argument_list|(
name|MediaType
operator|.
name|APPLICATION_JSON
argument_list|)
specifier|public
name|Response
name|dropPartition
parameter_list|(
annotation|@
name|PathParam
argument_list|(
literal|"db"
argument_list|)
name|String
name|db
parameter_list|,
annotation|@
name|PathParam
argument_list|(
literal|"table"
argument_list|)
name|String
name|table
parameter_list|,
annotation|@
name|PathParam
argument_list|(
literal|"partition"
argument_list|)
name|String
name|partition
parameter_list|,
annotation|@
name|QueryParam
argument_list|(
literal|"ifExists"
argument_list|)
name|boolean
name|ifExists
parameter_list|,
annotation|@
name|QueryParam
argument_list|(
literal|"group"
argument_list|)
name|String
name|group
parameter_list|,
annotation|@
name|QueryParam
argument_list|(
literal|"permissions"
argument_list|)
name|String
name|permissions
parameter_list|)
throws|throws
name|HcatException
throws|,
name|NotAuthorizedException
throws|,
name|BusyException
throws|,
name|BadParam
throws|,
name|ExecuteException
throws|,
name|IOException
block|{
name|verifyUser
argument_list|()
expr_stmt|;
name|verifyDdlParam
argument_list|(
name|db
argument_list|,
literal|":db"
argument_list|)
expr_stmt|;
name|verifyDdlParam
argument_list|(
name|table
argument_list|,
literal|":table"
argument_list|)
expr_stmt|;
name|verifyParam
argument_list|(
name|partition
argument_list|,
literal|":partition"
argument_list|)
expr_stmt|;
name|HcatDelegator
name|d
init|=
operator|new
name|HcatDelegator
argument_list|(
name|appConf
argument_list|,
name|execService
argument_list|)
decl_stmt|;
return|return
name|d
operator|.
name|dropPartition
argument_list|(
name|getDoAsUser
argument_list|()
argument_list|,
name|db
argument_list|,
name|table
argument_list|,
name|partition
argument_list|,
name|ifExists
argument_list|,
name|group
argument_list|,
name|permissions
argument_list|)
return|;
block|}
comment|/**    * List all databases, or those that match a pattern.    */
annotation|@
name|GET
annotation|@
name|Path
argument_list|(
literal|"ddl/database/"
argument_list|)
annotation|@
name|Produces
argument_list|(
name|MediaType
operator|.
name|APPLICATION_JSON
argument_list|)
specifier|public
name|Response
name|listDatabases
parameter_list|(
annotation|@
name|QueryParam
argument_list|(
literal|"like"
argument_list|)
name|String
name|dbPattern
parameter_list|)
throws|throws
name|HcatException
throws|,
name|NotAuthorizedException
throws|,
name|BusyException
throws|,
name|BadParam
throws|,
name|ExecuteException
throws|,
name|IOException
block|{
name|verifyUser
argument_list|()
expr_stmt|;
name|HcatDelegator
name|d
init|=
operator|new
name|HcatDelegator
argument_list|(
name|appConf
argument_list|,
name|execService
argument_list|)
decl_stmt|;
if|if
condition|(
operator|!
name|TempletonUtils
operator|.
name|isset
argument_list|(
name|dbPattern
argument_list|)
condition|)
block|{
name|dbPattern
operator|=
literal|"*"
expr_stmt|;
block|}
return|return
name|d
operator|.
name|listDatabases
argument_list|(
name|getDoAsUser
argument_list|()
argument_list|,
name|dbPattern
argument_list|)
return|;
block|}
comment|/**    * Describe a database    */
annotation|@
name|GET
annotation|@
name|Path
argument_list|(
literal|"ddl/database/{db}"
argument_list|)
annotation|@
name|Produces
argument_list|(
name|MediaType
operator|.
name|APPLICATION_JSON
argument_list|)
specifier|public
name|Response
name|descDatabase
parameter_list|(
annotation|@
name|PathParam
argument_list|(
literal|"db"
argument_list|)
name|String
name|db
parameter_list|,
annotation|@
name|QueryParam
argument_list|(
literal|"format"
argument_list|)
name|String
name|format
parameter_list|)
throws|throws
name|HcatException
throws|,
name|NotAuthorizedException
throws|,
name|BusyException
throws|,
name|BadParam
throws|,
name|ExecuteException
throws|,
name|IOException
block|{
name|verifyUser
argument_list|()
expr_stmt|;
name|verifyDdlParam
argument_list|(
name|db
argument_list|,
literal|":db"
argument_list|)
expr_stmt|;
name|HcatDelegator
name|d
init|=
operator|new
name|HcatDelegator
argument_list|(
name|appConf
argument_list|,
name|execService
argument_list|)
decl_stmt|;
return|return
name|d
operator|.
name|descDatabase
argument_list|(
name|getDoAsUser
argument_list|()
argument_list|,
name|db
argument_list|,
literal|"extended"
operator|.
name|equals
argument_list|(
name|format
argument_list|)
argument_list|)
return|;
block|}
comment|/**    * Create a database    */
annotation|@
name|PUT
annotation|@
name|Path
argument_list|(
literal|"ddl/database/{db}"
argument_list|)
annotation|@
name|Produces
argument_list|(
name|MediaType
operator|.
name|APPLICATION_JSON
argument_list|)
specifier|public
name|Response
name|createDatabase
parameter_list|(
annotation|@
name|PathParam
argument_list|(
literal|"db"
argument_list|)
name|String
name|db
parameter_list|,
name|DatabaseDesc
name|desc
parameter_list|)
throws|throws
name|HcatException
throws|,
name|NotAuthorizedException
throws|,
name|BusyException
throws|,
name|BadParam
throws|,
name|ExecuteException
throws|,
name|IOException
block|{
name|verifyUser
argument_list|()
expr_stmt|;
name|verifyDdlParam
argument_list|(
name|db
argument_list|,
literal|":db"
argument_list|)
expr_stmt|;
name|desc
operator|.
name|database
operator|=
name|db
expr_stmt|;
name|HcatDelegator
name|d
init|=
operator|new
name|HcatDelegator
argument_list|(
name|appConf
argument_list|,
name|execService
argument_list|)
decl_stmt|;
return|return
name|d
operator|.
name|createDatabase
argument_list|(
name|getDoAsUser
argument_list|()
argument_list|,
name|desc
argument_list|)
return|;
block|}
comment|/**    * Drop a database    */
annotation|@
name|DELETE
annotation|@
name|Path
argument_list|(
literal|"ddl/database/{db}"
argument_list|)
annotation|@
name|Produces
argument_list|(
name|MediaType
operator|.
name|APPLICATION_JSON
argument_list|)
specifier|public
name|Response
name|dropDatabase
parameter_list|(
annotation|@
name|PathParam
argument_list|(
literal|"db"
argument_list|)
name|String
name|db
parameter_list|,
annotation|@
name|QueryParam
argument_list|(
literal|"ifExists"
argument_list|)
name|boolean
name|ifExists
parameter_list|,
annotation|@
name|QueryParam
argument_list|(
literal|"option"
argument_list|)
name|String
name|option
parameter_list|,
annotation|@
name|QueryParam
argument_list|(
literal|"group"
argument_list|)
name|String
name|group
parameter_list|,
annotation|@
name|QueryParam
argument_list|(
literal|"permissions"
argument_list|)
name|String
name|permissions
parameter_list|)
throws|throws
name|HcatException
throws|,
name|NotAuthorizedException
throws|,
name|BusyException
throws|,
name|BadParam
throws|,
name|ExecuteException
throws|,
name|IOException
block|{
name|verifyUser
argument_list|()
expr_stmt|;
name|verifyDdlParam
argument_list|(
name|db
argument_list|,
literal|":db"
argument_list|)
expr_stmt|;
if|if
condition|(
name|TempletonUtils
operator|.
name|isset
argument_list|(
name|option
argument_list|)
condition|)
block|{
name|verifyDdlParam
argument_list|(
name|option
argument_list|,
literal|"option"
argument_list|)
expr_stmt|;
block|}
name|HcatDelegator
name|d
init|=
operator|new
name|HcatDelegator
argument_list|(
name|appConf
argument_list|,
name|execService
argument_list|)
decl_stmt|;
return|return
name|d
operator|.
name|dropDatabase
argument_list|(
name|getDoAsUser
argument_list|()
argument_list|,
name|db
argument_list|,
name|ifExists
argument_list|,
name|option
argument_list|,
name|group
argument_list|,
name|permissions
argument_list|)
return|;
block|}
comment|/**    * List the columns in an hcat table.  Currently the same as    * describe table.    */
annotation|@
name|GET
annotation|@
name|Path
argument_list|(
literal|"ddl/database/{db}/table/{table}/column"
argument_list|)
annotation|@
name|Produces
argument_list|(
name|MediaType
operator|.
name|APPLICATION_JSON
argument_list|)
specifier|public
name|Response
name|listColumns
parameter_list|(
annotation|@
name|PathParam
argument_list|(
literal|"db"
argument_list|)
name|String
name|db
parameter_list|,
annotation|@
name|PathParam
argument_list|(
literal|"table"
argument_list|)
name|String
name|table
parameter_list|)
throws|throws
name|HcatException
throws|,
name|NotAuthorizedException
throws|,
name|BusyException
throws|,
name|BadParam
throws|,
name|ExecuteException
throws|,
name|IOException
block|{
name|verifyUser
argument_list|()
expr_stmt|;
name|verifyDdlParam
argument_list|(
name|db
argument_list|,
literal|":db"
argument_list|)
expr_stmt|;
name|verifyDdlParam
argument_list|(
name|table
argument_list|,
literal|":table"
argument_list|)
expr_stmt|;
name|HcatDelegator
name|d
init|=
operator|new
name|HcatDelegator
argument_list|(
name|appConf
argument_list|,
name|execService
argument_list|)
decl_stmt|;
return|return
name|d
operator|.
name|listColumns
argument_list|(
name|getDoAsUser
argument_list|()
argument_list|,
name|db
argument_list|,
name|table
argument_list|)
return|;
block|}
comment|/**    * Describe a single column in an hcat table.    */
annotation|@
name|GET
annotation|@
name|Path
argument_list|(
literal|"ddl/database/{db}/table/{table}/column/{column}"
argument_list|)
annotation|@
name|Produces
argument_list|(
name|MediaType
operator|.
name|APPLICATION_JSON
argument_list|)
specifier|public
name|Response
name|descColumn
parameter_list|(
annotation|@
name|PathParam
argument_list|(
literal|"db"
argument_list|)
name|String
name|db
parameter_list|,
annotation|@
name|PathParam
argument_list|(
literal|"table"
argument_list|)
name|String
name|table
parameter_list|,
annotation|@
name|PathParam
argument_list|(
literal|"column"
argument_list|)
name|String
name|column
parameter_list|)
throws|throws
name|SimpleWebException
throws|,
name|NotAuthorizedException
throws|,
name|BusyException
throws|,
name|BadParam
throws|,
name|ExecuteException
throws|,
name|IOException
block|{
name|verifyUser
argument_list|()
expr_stmt|;
name|verifyDdlParam
argument_list|(
name|db
argument_list|,
literal|":db"
argument_list|)
expr_stmt|;
name|verifyDdlParam
argument_list|(
name|table
argument_list|,
literal|":table"
argument_list|)
expr_stmt|;
name|verifyParam
argument_list|(
name|column
argument_list|,
literal|":column"
argument_list|)
expr_stmt|;
name|HcatDelegator
name|d
init|=
operator|new
name|HcatDelegator
argument_list|(
name|appConf
argument_list|,
name|execService
argument_list|)
decl_stmt|;
return|return
name|d
operator|.
name|descOneColumn
argument_list|(
name|getDoAsUser
argument_list|()
argument_list|,
name|db
argument_list|,
name|table
argument_list|,
name|column
argument_list|)
return|;
block|}
comment|/**    * Create a column in an hcat table.    */
annotation|@
name|PUT
annotation|@
name|Path
argument_list|(
literal|"ddl/database/{db}/table/{table}/column/{column}"
argument_list|)
annotation|@
name|Produces
argument_list|(
name|MediaType
operator|.
name|APPLICATION_JSON
argument_list|)
specifier|public
name|Response
name|addOneColumn
parameter_list|(
annotation|@
name|PathParam
argument_list|(
literal|"db"
argument_list|)
name|String
name|db
parameter_list|,
annotation|@
name|PathParam
argument_list|(
literal|"table"
argument_list|)
name|String
name|table
parameter_list|,
annotation|@
name|PathParam
argument_list|(
literal|"column"
argument_list|)
name|String
name|column
parameter_list|,
name|ColumnDesc
name|desc
parameter_list|)
throws|throws
name|HcatException
throws|,
name|NotAuthorizedException
throws|,
name|BusyException
throws|,
name|BadParam
throws|,
name|ExecuteException
throws|,
name|IOException
block|{
name|verifyUser
argument_list|()
expr_stmt|;
name|verifyDdlParam
argument_list|(
name|db
argument_list|,
literal|":db"
argument_list|)
expr_stmt|;
name|verifyDdlParam
argument_list|(
name|table
argument_list|,
literal|":table"
argument_list|)
expr_stmt|;
name|verifyParam
argument_list|(
name|column
argument_list|,
literal|":column"
argument_list|)
expr_stmt|;
name|verifyParam
argument_list|(
name|desc
operator|.
name|type
argument_list|,
literal|"type"
argument_list|)
expr_stmt|;
name|desc
operator|.
name|name
operator|=
name|column
expr_stmt|;
name|HcatDelegator
name|d
init|=
operator|new
name|HcatDelegator
argument_list|(
name|appConf
argument_list|,
name|execService
argument_list|)
decl_stmt|;
return|return
name|d
operator|.
name|addOneColumn
argument_list|(
name|getDoAsUser
argument_list|()
argument_list|,
name|db
argument_list|,
name|table
argument_list|,
name|desc
argument_list|)
return|;
block|}
comment|/**    * Run a MapReduce Streaming job.    * @param callback URL which WebHCat will call when the hive job finishes    */
annotation|@
name|POST
annotation|@
name|Path
argument_list|(
literal|"mapreduce/streaming"
argument_list|)
annotation|@
name|Produces
argument_list|(
block|{
name|MediaType
operator|.
name|APPLICATION_JSON
block|}
argument_list|)
specifier|public
name|EnqueueBean
name|mapReduceStreaming
parameter_list|(
annotation|@
name|FormParam
argument_list|(
literal|"input"
argument_list|)
name|List
argument_list|<
name|String
argument_list|>
name|inputs
parameter_list|,
annotation|@
name|FormParam
argument_list|(
literal|"output"
argument_list|)
name|String
name|output
parameter_list|,
annotation|@
name|FormParam
argument_list|(
literal|"mapper"
argument_list|)
name|String
name|mapper
parameter_list|,
annotation|@
name|FormParam
argument_list|(
literal|"reducer"
argument_list|)
name|String
name|reducer
parameter_list|,
annotation|@
name|FormParam
argument_list|(
literal|"combiner"
argument_list|)
name|String
name|combiner
parameter_list|,
annotation|@
name|FormParam
argument_list|(
literal|"file"
argument_list|)
name|List
argument_list|<
name|String
argument_list|>
name|fileList
parameter_list|,
annotation|@
name|FormParam
argument_list|(
literal|"files"
argument_list|)
name|String
name|files
parameter_list|,
annotation|@
name|FormParam
argument_list|(
literal|"define"
argument_list|)
name|List
argument_list|<
name|String
argument_list|>
name|defines
parameter_list|,
annotation|@
name|FormParam
argument_list|(
literal|"cmdenv"
argument_list|)
name|List
argument_list|<
name|String
argument_list|>
name|cmdenvs
parameter_list|,
annotation|@
name|FormParam
argument_list|(
literal|"arg"
argument_list|)
name|List
argument_list|<
name|String
argument_list|>
name|args
parameter_list|,
annotation|@
name|FormParam
argument_list|(
literal|"statusdir"
argument_list|)
name|String
name|statusdir
parameter_list|,
annotation|@
name|FormParam
argument_list|(
literal|"callback"
argument_list|)
name|String
name|callback
parameter_list|,
annotation|@
name|FormParam
argument_list|(
literal|"enablelog"
argument_list|)
name|boolean
name|enablelog
parameter_list|)
throws|throws
name|NotAuthorizedException
throws|,
name|BusyException
throws|,
name|BadParam
throws|,
name|QueueException
throws|,
name|ExecuteException
throws|,
name|IOException
throws|,
name|InterruptedException
block|{
name|verifyUser
argument_list|()
expr_stmt|;
name|verifyParam
argument_list|(
name|inputs
argument_list|,
literal|"input"
argument_list|)
expr_stmt|;
name|verifyParam
argument_list|(
name|mapper
argument_list|,
literal|"mapper"
argument_list|)
expr_stmt|;
name|verifyParam
argument_list|(
name|reducer
argument_list|,
literal|"reducer"
argument_list|)
expr_stmt|;
name|Map
argument_list|<
name|String
argument_list|,
name|Object
argument_list|>
name|userArgs
init|=
operator|new
name|HashMap
argument_list|<
name|String
argument_list|,
name|Object
argument_list|>
argument_list|()
decl_stmt|;
name|userArgs
operator|.
name|put
argument_list|(
literal|"user.name"
argument_list|,
name|getDoAsUser
argument_list|()
argument_list|)
expr_stmt|;
name|userArgs
operator|.
name|put
argument_list|(
literal|"input"
argument_list|,
name|inputs
argument_list|)
expr_stmt|;
name|userArgs
operator|.
name|put
argument_list|(
literal|"output"
argument_list|,
name|output
argument_list|)
expr_stmt|;
name|userArgs
operator|.
name|put
argument_list|(
literal|"mapper"
argument_list|,
name|mapper
argument_list|)
expr_stmt|;
name|userArgs
operator|.
name|put
argument_list|(
literal|"reducer"
argument_list|,
name|reducer
argument_list|)
expr_stmt|;
name|userArgs
operator|.
name|put
argument_list|(
literal|"combiner"
argument_list|,
name|combiner
argument_list|)
expr_stmt|;
name|userArgs
operator|.
name|put
argument_list|(
literal|"file"
argument_list|,
name|fileList
argument_list|)
expr_stmt|;
name|userArgs
operator|.
name|put
argument_list|(
literal|"files"
argument_list|,
name|files
argument_list|)
expr_stmt|;
name|userArgs
operator|.
name|put
argument_list|(
literal|"define"
argument_list|,
name|defines
argument_list|)
expr_stmt|;
name|userArgs
operator|.
name|put
argument_list|(
literal|"cmdenv"
argument_list|,
name|cmdenvs
argument_list|)
expr_stmt|;
name|userArgs
operator|.
name|put
argument_list|(
literal|"arg"
argument_list|,
name|args
argument_list|)
expr_stmt|;
name|userArgs
operator|.
name|put
argument_list|(
literal|"statusdir"
argument_list|,
name|statusdir
argument_list|)
expr_stmt|;
name|userArgs
operator|.
name|put
argument_list|(
literal|"callback"
argument_list|,
name|callback
argument_list|)
expr_stmt|;
name|userArgs
operator|.
name|put
argument_list|(
literal|"enablelog"
argument_list|,
name|Boolean
operator|.
name|toString
argument_list|(
name|enablelog
argument_list|)
argument_list|)
expr_stmt|;
name|checkEnableLogPrerequisite
argument_list|(
name|enablelog
argument_list|,
name|statusdir
argument_list|)
expr_stmt|;
name|StreamingDelegator
name|d
init|=
operator|new
name|StreamingDelegator
argument_list|(
name|appConf
argument_list|)
decl_stmt|;
return|return
name|d
operator|.
name|run
argument_list|(
name|getDoAsUser
argument_list|()
argument_list|,
name|userArgs
argument_list|,
name|inputs
argument_list|,
name|output
argument_list|,
name|mapper
argument_list|,
name|reducer
argument_list|,
name|combiner
argument_list|,
name|fileList
argument_list|,
name|files
argument_list|,
name|defines
argument_list|,
name|cmdenvs
argument_list|,
name|args
argument_list|,
name|statusdir
argument_list|,
name|callback
argument_list|,
name|getCompletedUrl
argument_list|()
argument_list|,
name|enablelog
argument_list|,
name|JobType
operator|.
name|STREAMING
argument_list|)
return|;
block|}
comment|/**    * Run a MapReduce Jar job.    * Params correspond to the REST api params    * @param  usesHcatalog if {@code true}, means the Jar uses HCat and thus needs to access    *    metastore, which requires additional steps for WebHCat to perform in a secure cluster.    * @param callback URL which WebHCat will call when the hive job finishes    * @see org.apache.hive.hcatalog.templeton.tool.TempletonControllerJob    */
annotation|@
name|POST
annotation|@
name|Path
argument_list|(
literal|"mapreduce/jar"
argument_list|)
annotation|@
name|Produces
argument_list|(
block|{
name|MediaType
operator|.
name|APPLICATION_JSON
block|}
argument_list|)
specifier|public
name|EnqueueBean
name|mapReduceJar
parameter_list|(
annotation|@
name|FormParam
argument_list|(
literal|"jar"
argument_list|)
name|String
name|jar
parameter_list|,
annotation|@
name|FormParam
argument_list|(
literal|"class"
argument_list|)
name|String
name|mainClass
parameter_list|,
annotation|@
name|FormParam
argument_list|(
literal|"libjars"
argument_list|)
name|String
name|libjars
parameter_list|,
annotation|@
name|FormParam
argument_list|(
literal|"files"
argument_list|)
name|String
name|files
parameter_list|,
annotation|@
name|FormParam
argument_list|(
literal|"arg"
argument_list|)
name|List
argument_list|<
name|String
argument_list|>
name|args
parameter_list|,
annotation|@
name|FormParam
argument_list|(
literal|"define"
argument_list|)
name|List
argument_list|<
name|String
argument_list|>
name|defines
parameter_list|,
annotation|@
name|FormParam
argument_list|(
literal|"statusdir"
argument_list|)
name|String
name|statusdir
parameter_list|,
annotation|@
name|FormParam
argument_list|(
literal|"callback"
argument_list|)
name|String
name|callback
parameter_list|,
annotation|@
name|FormParam
argument_list|(
literal|"usehcatalog"
argument_list|)
name|boolean
name|usesHcatalog
parameter_list|,
annotation|@
name|FormParam
argument_list|(
literal|"enablelog"
argument_list|)
name|boolean
name|enablelog
parameter_list|)
throws|throws
name|NotAuthorizedException
throws|,
name|BusyException
throws|,
name|BadParam
throws|,
name|QueueException
throws|,
name|ExecuteException
throws|,
name|IOException
throws|,
name|InterruptedException
block|{
name|verifyUser
argument_list|()
expr_stmt|;
name|verifyParam
argument_list|(
name|jar
argument_list|,
literal|"jar"
argument_list|)
expr_stmt|;
name|verifyParam
argument_list|(
name|mainClass
argument_list|,
literal|"class"
argument_list|)
expr_stmt|;
name|Map
argument_list|<
name|String
argument_list|,
name|Object
argument_list|>
name|userArgs
init|=
operator|new
name|HashMap
argument_list|<
name|String
argument_list|,
name|Object
argument_list|>
argument_list|()
decl_stmt|;
name|userArgs
operator|.
name|put
argument_list|(
literal|"user.name"
argument_list|,
name|getDoAsUser
argument_list|()
argument_list|)
expr_stmt|;
name|userArgs
operator|.
name|put
argument_list|(
literal|"jar"
argument_list|,
name|jar
argument_list|)
expr_stmt|;
name|userArgs
operator|.
name|put
argument_list|(
literal|"class"
argument_list|,
name|mainClass
argument_list|)
expr_stmt|;
name|userArgs
operator|.
name|put
argument_list|(
literal|"libjars"
argument_list|,
name|libjars
argument_list|)
expr_stmt|;
name|userArgs
operator|.
name|put
argument_list|(
literal|"files"
argument_list|,
name|files
argument_list|)
expr_stmt|;
name|userArgs
operator|.
name|put
argument_list|(
literal|"arg"
argument_list|,
name|args
argument_list|)
expr_stmt|;
name|userArgs
operator|.
name|put
argument_list|(
literal|"define"
argument_list|,
name|defines
argument_list|)
expr_stmt|;
name|userArgs
operator|.
name|put
argument_list|(
literal|"statusdir"
argument_list|,
name|statusdir
argument_list|)
expr_stmt|;
name|userArgs
operator|.
name|put
argument_list|(
literal|"callback"
argument_list|,
name|callback
argument_list|)
expr_stmt|;
name|userArgs
operator|.
name|put
argument_list|(
literal|"enablelog"
argument_list|,
name|Boolean
operator|.
name|toString
argument_list|(
name|enablelog
argument_list|)
argument_list|)
expr_stmt|;
name|checkEnableLogPrerequisite
argument_list|(
name|enablelog
argument_list|,
name|statusdir
argument_list|)
expr_stmt|;
name|JarDelegator
name|d
init|=
operator|new
name|JarDelegator
argument_list|(
name|appConf
argument_list|)
decl_stmt|;
return|return
name|d
operator|.
name|run
argument_list|(
name|getDoAsUser
argument_list|()
argument_list|,
name|userArgs
argument_list|,
name|jar
argument_list|,
name|mainClass
argument_list|,
name|libjars
argument_list|,
name|files
argument_list|,
name|args
argument_list|,
name|defines
argument_list|,
name|statusdir
argument_list|,
name|callback
argument_list|,
name|usesHcatalog
argument_list|,
name|getCompletedUrl
argument_list|()
argument_list|,
name|enablelog
argument_list|,
name|JobType
operator|.
name|JAR
argument_list|)
return|;
block|}
comment|/**    * Run a Pig job.    * Params correspond to the REST api params.  If '-useHCatalog' is in the {@code pigArgs, usesHcatalog},    * is interpreted as true.    * @param  usesHcatalog if {@code true}, means the Pig script uses HCat and thus needs to access    *    metastore, which requires additional steps for WebHCat to perform in a secure cluster.    *    This does nothing to ensure that Pig is installed on target node in the cluster.    * @param callback URL which WebHCat will call when the hive job finishes    * @see org.apache.hive.hcatalog.templeton.tool.TempletonControllerJob    */
annotation|@
name|POST
annotation|@
name|Path
argument_list|(
literal|"pig"
argument_list|)
annotation|@
name|Produces
argument_list|(
block|{
name|MediaType
operator|.
name|APPLICATION_JSON
block|}
argument_list|)
specifier|public
name|EnqueueBean
name|pig
parameter_list|(
annotation|@
name|FormParam
argument_list|(
literal|"execute"
argument_list|)
name|String
name|execute
parameter_list|,
annotation|@
name|FormParam
argument_list|(
literal|"file"
argument_list|)
name|String
name|srcFile
parameter_list|,
annotation|@
name|FormParam
argument_list|(
literal|"arg"
argument_list|)
name|List
argument_list|<
name|String
argument_list|>
name|pigArgs
parameter_list|,
annotation|@
name|FormParam
argument_list|(
literal|"files"
argument_list|)
name|String
name|otherFiles
parameter_list|,
annotation|@
name|FormParam
argument_list|(
literal|"statusdir"
argument_list|)
name|String
name|statusdir
parameter_list|,
annotation|@
name|FormParam
argument_list|(
literal|"callback"
argument_list|)
name|String
name|callback
parameter_list|,
annotation|@
name|FormParam
argument_list|(
literal|"usehcatalog"
argument_list|)
name|boolean
name|usesHcatalog
parameter_list|,
annotation|@
name|FormParam
argument_list|(
literal|"enablelog"
argument_list|)
name|boolean
name|enablelog
parameter_list|)
throws|throws
name|NotAuthorizedException
throws|,
name|BusyException
throws|,
name|BadParam
throws|,
name|QueueException
throws|,
name|ExecuteException
throws|,
name|IOException
throws|,
name|InterruptedException
block|{
name|verifyUser
argument_list|()
expr_stmt|;
if|if
condition|(
name|execute
operator|==
literal|null
operator|&&
name|srcFile
operator|==
literal|null
condition|)
block|{
throw|throw
operator|new
name|BadParam
argument_list|(
literal|"Either execute or file parameter required"
argument_list|)
throw|;
block|}
comment|//add all function arguments to a map
name|Map
argument_list|<
name|String
argument_list|,
name|Object
argument_list|>
name|userArgs
init|=
operator|new
name|HashMap
argument_list|<
name|String
argument_list|,
name|Object
argument_list|>
argument_list|()
decl_stmt|;
name|userArgs
operator|.
name|put
argument_list|(
literal|"user.name"
argument_list|,
name|getDoAsUser
argument_list|()
argument_list|)
expr_stmt|;
name|userArgs
operator|.
name|put
argument_list|(
literal|"execute"
argument_list|,
name|execute
argument_list|)
expr_stmt|;
name|userArgs
operator|.
name|put
argument_list|(
literal|"file"
argument_list|,
name|srcFile
argument_list|)
expr_stmt|;
name|userArgs
operator|.
name|put
argument_list|(
literal|"arg"
argument_list|,
name|pigArgs
argument_list|)
expr_stmt|;
name|userArgs
operator|.
name|put
argument_list|(
literal|"files"
argument_list|,
name|otherFiles
argument_list|)
expr_stmt|;
name|userArgs
operator|.
name|put
argument_list|(
literal|"statusdir"
argument_list|,
name|statusdir
argument_list|)
expr_stmt|;
name|userArgs
operator|.
name|put
argument_list|(
literal|"callback"
argument_list|,
name|callback
argument_list|)
expr_stmt|;
name|userArgs
operator|.
name|put
argument_list|(
literal|"enablelog"
argument_list|,
name|Boolean
operator|.
name|toString
argument_list|(
name|enablelog
argument_list|)
argument_list|)
expr_stmt|;
name|checkEnableLogPrerequisite
argument_list|(
name|enablelog
argument_list|,
name|statusdir
argument_list|)
expr_stmt|;
name|PigDelegator
name|d
init|=
operator|new
name|PigDelegator
argument_list|(
name|appConf
argument_list|)
decl_stmt|;
return|return
name|d
operator|.
name|run
argument_list|(
name|getDoAsUser
argument_list|()
argument_list|,
name|userArgs
argument_list|,
name|execute
argument_list|,
name|srcFile
argument_list|,
name|pigArgs
argument_list|,
name|otherFiles
argument_list|,
name|statusdir
argument_list|,
name|callback
argument_list|,
name|usesHcatalog
argument_list|,
name|getCompletedUrl
argument_list|()
argument_list|,
name|enablelog
argument_list|)
return|;
block|}
comment|/**    * Run a Sqoop job.    * @param optionsFile  name of option file which contains Sqoop command to run    * @param otherFiles   additional files to be shipped to the launcher, such as option                          files which contain part of the Sqoop command    * @param statusdir    where the stderr/stdout of templeton controller job goes    * @param callback     URL which WebHCat will call when the sqoop job finishes    * @param enablelog    whether to collect mapreduce log into statusdir/logs    */
annotation|@
name|POST
annotation|@
name|Path
argument_list|(
literal|"sqoop"
argument_list|)
annotation|@
name|Produces
argument_list|(
block|{
name|MediaType
operator|.
name|APPLICATION_JSON
block|}
argument_list|)
specifier|public
name|EnqueueBean
name|sqoop
parameter_list|(
annotation|@
name|FormParam
argument_list|(
literal|"command"
argument_list|)
name|String
name|command
parameter_list|,
annotation|@
name|FormParam
argument_list|(
literal|"optionsfile"
argument_list|)
name|String
name|optionsFile
parameter_list|,
annotation|@
name|FormParam
argument_list|(
literal|"files"
argument_list|)
name|String
name|otherFiles
parameter_list|,
annotation|@
name|FormParam
argument_list|(
literal|"statusdir"
argument_list|)
name|String
name|statusdir
parameter_list|,
annotation|@
name|FormParam
argument_list|(
literal|"callback"
argument_list|)
name|String
name|callback
parameter_list|,
annotation|@
name|FormParam
argument_list|(
literal|"enablelog"
argument_list|)
name|boolean
name|enablelog
parameter_list|)
throws|throws
name|NotAuthorizedException
throws|,
name|BusyException
throws|,
name|BadParam
throws|,
name|QueueException
throws|,
name|ExecuteException
throws|,
name|IOException
throws|,
name|InterruptedException
block|{
name|verifyUser
argument_list|()
expr_stmt|;
if|if
condition|(
name|command
operator|==
literal|null
operator|&&
name|optionsFile
operator|==
literal|null
condition|)
throw|throw
operator|new
name|BadParam
argument_list|(
literal|"Must define Sqoop command or a optionsfile contains Sqoop command to run Sqoop job."
argument_list|)
throw|;
if|if
condition|(
name|command
operator|!=
literal|null
operator|&&
name|optionsFile
operator|!=
literal|null
condition|)
throw|throw
operator|new
name|BadParam
argument_list|(
literal|"Cannot set command and optionsfile at the same time."
argument_list|)
throw|;
name|checkEnableLogPrerequisite
argument_list|(
name|enablelog
argument_list|,
name|statusdir
argument_list|)
expr_stmt|;
comment|//add all function arguments to a map
name|Map
argument_list|<
name|String
argument_list|,
name|Object
argument_list|>
name|userArgs
init|=
operator|new
name|HashMap
argument_list|<
name|String
argument_list|,
name|Object
argument_list|>
argument_list|()
decl_stmt|;
name|userArgs
operator|.
name|put
argument_list|(
literal|"user.name"
argument_list|,
name|getDoAsUser
argument_list|()
argument_list|)
expr_stmt|;
name|userArgs
operator|.
name|put
argument_list|(
literal|"command"
argument_list|,
name|command
argument_list|)
expr_stmt|;
name|userArgs
operator|.
name|put
argument_list|(
literal|"optionsfile"
argument_list|,
name|optionsFile
argument_list|)
expr_stmt|;
name|userArgs
operator|.
name|put
argument_list|(
literal|"files"
argument_list|,
name|otherFiles
argument_list|)
expr_stmt|;
name|userArgs
operator|.
name|put
argument_list|(
literal|"statusdir"
argument_list|,
name|statusdir
argument_list|)
expr_stmt|;
name|userArgs
operator|.
name|put
argument_list|(
literal|"callback"
argument_list|,
name|callback
argument_list|)
expr_stmt|;
name|userArgs
operator|.
name|put
argument_list|(
literal|"enablelog"
argument_list|,
name|Boolean
operator|.
name|toString
argument_list|(
name|enablelog
argument_list|)
argument_list|)
expr_stmt|;
name|SqoopDelegator
name|d
init|=
operator|new
name|SqoopDelegator
argument_list|(
name|appConf
argument_list|)
decl_stmt|;
return|return
name|d
operator|.
name|run
argument_list|(
name|getDoAsUser
argument_list|()
argument_list|,
name|userArgs
argument_list|,
name|command
argument_list|,
name|optionsFile
argument_list|,
name|otherFiles
argument_list|,
name|statusdir
argument_list|,
name|callback
argument_list|,
name|getCompletedUrl
argument_list|()
argument_list|,
name|enablelog
argument_list|)
return|;
block|}
comment|/**    * Run a Hive job.    * @param execute    SQL statement to run, equivalent to "-e" from hive command line    * @param srcFile    name of hive script file to run, equivalent to "-f" from hive    *                   command line    * @param hiveArgs   additional command line argument passed to the hive command line.    *                   Please check https://cwiki.apache.org/Hive/languagemanual-cli.html    *                   for detailed explanation of command line arguments    * @param otherFiles additional files to be shipped to the launcher, such as the jars    *                   used in "add jar" statement in hive script    * @param defines    shortcut for command line arguments "--define"    * @param statusdir  where the stderr/stdout of templeton controller job goes    * @param callback   URL which WebHCat will call when the hive job finishes    * @param enablelog  whether to collect mapreduce log into statusdir/logs    */
annotation|@
name|POST
annotation|@
name|Path
argument_list|(
literal|"hive"
argument_list|)
annotation|@
name|Produces
argument_list|(
block|{
name|MediaType
operator|.
name|APPLICATION_JSON
block|}
argument_list|)
specifier|public
name|EnqueueBean
name|hive
parameter_list|(
annotation|@
name|FormParam
argument_list|(
literal|"execute"
argument_list|)
name|String
name|execute
parameter_list|,
annotation|@
name|FormParam
argument_list|(
literal|"file"
argument_list|)
name|String
name|srcFile
parameter_list|,
annotation|@
name|FormParam
argument_list|(
literal|"arg"
argument_list|)
name|List
argument_list|<
name|String
argument_list|>
name|hiveArgs
parameter_list|,
annotation|@
name|FormParam
argument_list|(
literal|"files"
argument_list|)
name|String
name|otherFiles
parameter_list|,
annotation|@
name|FormParam
argument_list|(
literal|"define"
argument_list|)
name|List
argument_list|<
name|String
argument_list|>
name|defines
parameter_list|,
annotation|@
name|FormParam
argument_list|(
literal|"statusdir"
argument_list|)
name|String
name|statusdir
parameter_list|,
annotation|@
name|FormParam
argument_list|(
literal|"callback"
argument_list|)
name|String
name|callback
parameter_list|,
annotation|@
name|FormParam
argument_list|(
literal|"enablelog"
argument_list|)
name|boolean
name|enablelog
parameter_list|)
throws|throws
name|NotAuthorizedException
throws|,
name|BusyException
throws|,
name|BadParam
throws|,
name|QueueException
throws|,
name|ExecuteException
throws|,
name|IOException
throws|,
name|InterruptedException
block|{
name|verifyUser
argument_list|()
expr_stmt|;
if|if
condition|(
name|execute
operator|==
literal|null
operator|&&
name|srcFile
operator|==
literal|null
condition|)
block|{
throw|throw
operator|new
name|BadParam
argument_list|(
literal|"Either execute or file parameter required"
argument_list|)
throw|;
block|}
comment|//add all function arguments to a map
name|Map
argument_list|<
name|String
argument_list|,
name|Object
argument_list|>
name|userArgs
init|=
operator|new
name|HashMap
argument_list|<
name|String
argument_list|,
name|Object
argument_list|>
argument_list|()
decl_stmt|;
name|userArgs
operator|.
name|put
argument_list|(
literal|"user.name"
argument_list|,
name|getDoAsUser
argument_list|()
argument_list|)
expr_stmt|;
name|userArgs
operator|.
name|put
argument_list|(
literal|"execute"
argument_list|,
name|execute
argument_list|)
expr_stmt|;
name|userArgs
operator|.
name|put
argument_list|(
literal|"file"
argument_list|,
name|srcFile
argument_list|)
expr_stmt|;
name|userArgs
operator|.
name|put
argument_list|(
literal|"define"
argument_list|,
name|defines
argument_list|)
expr_stmt|;
name|userArgs
operator|.
name|put
argument_list|(
literal|"files"
argument_list|,
name|otherFiles
argument_list|)
expr_stmt|;
name|userArgs
operator|.
name|put
argument_list|(
literal|"statusdir"
argument_list|,
name|statusdir
argument_list|)
expr_stmt|;
name|userArgs
operator|.
name|put
argument_list|(
literal|"callback"
argument_list|,
name|callback
argument_list|)
expr_stmt|;
name|userArgs
operator|.
name|put
argument_list|(
literal|"enablelog"
argument_list|,
name|Boolean
operator|.
name|toString
argument_list|(
name|enablelog
argument_list|)
argument_list|)
expr_stmt|;
name|checkEnableLogPrerequisite
argument_list|(
name|enablelog
argument_list|,
name|statusdir
argument_list|)
expr_stmt|;
name|HiveDelegator
name|d
init|=
operator|new
name|HiveDelegator
argument_list|(
name|appConf
argument_list|)
decl_stmt|;
return|return
name|d
operator|.
name|run
argument_list|(
name|getDoAsUser
argument_list|()
argument_list|,
name|userArgs
argument_list|,
name|execute
argument_list|,
name|srcFile
argument_list|,
name|defines
argument_list|,
name|hiveArgs
argument_list|,
name|otherFiles
argument_list|,
name|statusdir
argument_list|,
name|callback
argument_list|,
name|getCompletedUrl
argument_list|()
argument_list|,
name|enablelog
argument_list|)
return|;
block|}
comment|/**    * Return the status of the jobid.    */
annotation|@
name|GET
annotation|@
name|Path
argument_list|(
literal|"jobs/{jobid}"
argument_list|)
annotation|@
name|Produces
argument_list|(
block|{
name|MediaType
operator|.
name|APPLICATION_JSON
block|}
argument_list|)
specifier|public
name|QueueStatusBean
name|showJobId
parameter_list|(
annotation|@
name|PathParam
argument_list|(
literal|"jobid"
argument_list|)
name|String
name|jobid
parameter_list|)
throws|throws
name|NotAuthorizedException
throws|,
name|BadParam
throws|,
name|IOException
throws|,
name|InterruptedException
block|{
name|verifyUser
argument_list|()
expr_stmt|;
name|verifyParam
argument_list|(
name|jobid
argument_list|,
literal|":jobid"
argument_list|)
expr_stmt|;
name|StatusDelegator
name|d
init|=
operator|new
name|StatusDelegator
argument_list|(
name|appConf
argument_list|)
decl_stmt|;
return|return
name|d
operator|.
name|run
argument_list|(
name|getDoAsUser
argument_list|()
argument_list|,
name|jobid
argument_list|)
return|;
block|}
comment|/**    * Kill a job in the queue.    */
annotation|@
name|DELETE
annotation|@
name|Path
argument_list|(
literal|"jobs/{jobid}"
argument_list|)
annotation|@
name|Produces
argument_list|(
block|{
name|MediaType
operator|.
name|APPLICATION_JSON
block|}
argument_list|)
specifier|public
name|QueueStatusBean
name|deleteJobId
parameter_list|(
annotation|@
name|PathParam
argument_list|(
literal|"jobid"
argument_list|)
name|String
name|jobid
parameter_list|)
throws|throws
name|NotAuthorizedException
throws|,
name|BadParam
throws|,
name|IOException
throws|,
name|InterruptedException
block|{
name|verifyUser
argument_list|()
expr_stmt|;
name|verifyParam
argument_list|(
name|jobid
argument_list|,
literal|":jobid"
argument_list|)
expr_stmt|;
name|DeleteDelegator
name|d
init|=
operator|new
name|DeleteDelegator
argument_list|(
name|appConf
argument_list|)
decl_stmt|;
return|return
name|d
operator|.
name|run
argument_list|(
name|getDoAsUser
argument_list|()
argument_list|,
name|jobid
argument_list|)
return|;
block|}
comment|/**    * Return all the known job ids for this user based on the optional filter conditions.    *<p>    * Example usages:    * 1. curl -s 'http://localhost:50111/templeton/v1/jobs?user.name=hsubramaniyan'    * Return all the Job IDs submitted by hsubramaniyan    * 2. curl -s    * 'http://localhost:50111/templeton/v1/jobs?user.name=hsubramaniyan&showall=true'    * Return all the Job IDs that are visible to hsubramaniyan    * 3. curl -s    * 'http://localhost:50111/templeton/v1/jobs?user.name=hsubramaniyan&jobid=job_201312091733_0003'    * Return all the Job IDs for hsubramaniyan after job_201312091733_0003.    * 4. curl -s 'http://localhost:50111/templeton/v1/jobs?    * user.name=hsubramaniyan&jobid=job_201312091733_0003&numrecords=5'    * Return the first 5(atmost) Job IDs submitted by hsubramaniyan after job_201312091733_0003.    * 5.  curl -s    * 'http://localhost:50111/templeton/v1/jobs?user.name=hsubramaniyan&numrecords=5'    * Return the first 5(atmost) Job IDs submitted by hsubramaniyan after sorting the Job ID list    * lexicographically.    *</p>    *<p>    * Supporting pagination using "jobid" and "numrecords" parameters:    * Step 1: Get the start "jobid" = job_xxx_000, "numrecords" = n    * Step 2: Issue a curl command by specifying the user-defined "numrecords" and "jobid"    * Step 3: If list obtained from Step 2 has size equal to "numrecords", retrieve the list's    * last record and get the Job Id of the last record as job_yyy_k, else quit.    * Step 4: set "jobid"=job_yyy_k and go to step 2.    *</p>    * @param fields If "fields" set to "*", the request will return full details of the job.    * If "fields" is missing, will only return the job ID. Currently the value can only    * be "*", other values are not allowed and will throw exception.    * @param showall If "showall" is set to "true", the request will return all jobs the user    * has permission to view, not only the jobs belonging to the user.    * @param jobid If "jobid" is present, the records whose Job Id is lexicographically greater    * than "jobid" are only returned. For example, if "jobid" = "job_201312091733_0001",    * the jobs whose Job ID is greater than "job_201312091733_0001" are returned. The number of    * records returned depends on the value of "numrecords".    * @param numrecords If the "jobid" and "numrecords" parameters are present, the top #numrecords    * records appearing after "jobid" will be returned after sorting the Job Id list    * lexicographically.    * If "jobid" parameter is missing and "numrecords" is present, the top #numrecords will    * be returned after lexicographically sorting the Job Id list. If "jobid" parameter is present    * and "numrecords" is missing, all the records whose Job Id is greater than "jobid" are returned.    * @return list of job items based on the filter conditions specified by the user.    */
annotation|@
name|GET
annotation|@
name|Path
argument_list|(
literal|"jobs"
argument_list|)
annotation|@
name|Produces
argument_list|(
block|{
name|MediaType
operator|.
name|APPLICATION_JSON
block|}
argument_list|)
specifier|public
name|List
argument_list|<
name|JobItemBean
argument_list|>
name|showJobList
parameter_list|(
annotation|@
name|QueryParam
argument_list|(
literal|"fields"
argument_list|)
name|String
name|fields
parameter_list|,
annotation|@
name|QueryParam
argument_list|(
literal|"showall"
argument_list|)
name|boolean
name|showall
parameter_list|,
annotation|@
name|QueryParam
argument_list|(
literal|"jobid"
argument_list|)
name|String
name|jobid
parameter_list|,
annotation|@
name|QueryParam
argument_list|(
literal|"numrecords"
argument_list|)
name|String
name|numrecords
parameter_list|)
throws|throws
name|NotAuthorizedException
throws|,
name|BadParam
throws|,
name|IOException
throws|,
name|InterruptedException
block|{
name|verifyUser
argument_list|()
expr_stmt|;
name|boolean
name|showDetails
init|=
literal|false
decl_stmt|;
if|if
condition|(
name|fields
operator|!=
literal|null
operator|&&
operator|!
name|fields
operator|.
name|equals
argument_list|(
literal|"*"
argument_list|)
condition|)
block|{
throw|throw
operator|new
name|BadParam
argument_list|(
literal|"fields value other than * is not supported"
argument_list|)
throw|;
block|}
if|if
condition|(
name|fields
operator|!=
literal|null
operator|&&
name|fields
operator|.
name|equals
argument_list|(
literal|"*"
argument_list|)
condition|)
block|{
name|showDetails
operator|=
literal|true
expr_stmt|;
block|}
name|ListDelegator
name|ld
init|=
operator|new
name|ListDelegator
argument_list|(
name|appConf
argument_list|)
decl_stmt|;
name|List
argument_list|<
name|String
argument_list|>
name|list
init|=
name|ld
operator|.
name|run
argument_list|(
name|getDoAsUser
argument_list|()
argument_list|,
name|showall
argument_list|)
decl_stmt|;
name|List
argument_list|<
name|JobItemBean
argument_list|>
name|detailList
init|=
operator|new
name|ArrayList
argument_list|<
name|JobItemBean
argument_list|>
argument_list|()
decl_stmt|;
name|int
name|currRecord
init|=
literal|0
decl_stmt|;
name|int
name|numRecords
decl_stmt|;
comment|// Parse numrecords to an integer
try|try
block|{
if|if
condition|(
name|numrecords
operator|!=
literal|null
condition|)
block|{
name|numRecords
operator|=
name|Integer
operator|.
name|parseInt
argument_list|(
name|numrecords
argument_list|)
expr_stmt|;
if|if
condition|(
name|numRecords
operator|<=
literal|0
condition|)
block|{
throw|throw
operator|new
name|BadParam
argument_list|(
literal|"numrecords should be an integer> 0"
argument_list|)
throw|;
block|}
block|}
else|else
block|{
name|numRecords
operator|=
operator|-
literal|1
expr_stmt|;
block|}
block|}
catch|catch
parameter_list|(
name|Exception
name|e
parameter_list|)
block|{
throw|throw
operator|new
name|BadParam
argument_list|(
literal|"Invalid numrecords format: numrecords should be an integer> 0"
argument_list|)
throw|;
block|}
comment|// Sort the list lexicographically
name|Collections
operator|.
name|sort
argument_list|(
name|list
argument_list|)
expr_stmt|;
for|for
control|(
name|String
name|job
range|:
name|list
control|)
block|{
comment|// If numRecords = -1, fetch all records.
comment|// Hence skip all the below checks when numRecords = -1.
if|if
condition|(
name|numRecords
operator|!=
operator|-
literal|1
condition|)
block|{
comment|// If currRecord>= numRecords, we have already fetched the top #numRecords
if|if
condition|(
name|currRecord
operator|>=
name|numRecords
condition|)
block|{
break|break;
block|}
comment|// If the current record needs to be returned based on the
comment|// filter conditions specified by the user, increment the counter
elseif|else
if|if
condition|(
operator|(
name|jobid
operator|!=
literal|null
operator|&&
name|job
operator|.
name|compareTo
argument_list|(
name|jobid
argument_list|)
operator|>
literal|0
operator|)
operator|||
name|jobid
operator|==
literal|null
condition|)
block|{
name|currRecord
operator|++
expr_stmt|;
block|}
comment|// The current record should not be included in the output detailList.
else|else
block|{
continue|continue;
block|}
block|}
name|JobItemBean
name|jobItem
init|=
operator|new
name|JobItemBean
argument_list|()
decl_stmt|;
name|jobItem
operator|.
name|id
operator|=
name|job
expr_stmt|;
if|if
condition|(
name|showDetails
condition|)
block|{
name|StatusDelegator
name|sd
init|=
operator|new
name|StatusDelegator
argument_list|(
name|appConf
argument_list|)
decl_stmt|;
try|try
block|{
name|jobItem
operator|.
name|detail
operator|=
name|sd
operator|.
name|run
argument_list|(
name|getDoAsUser
argument_list|()
argument_list|,
name|job
argument_list|)
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|Exception
name|ex
parameter_list|)
block|{
comment|/*if we could not get status for some reason, log it, and send empty status back with           * just the ID so that caller knows to even look in the log file*/
name|LOG
operator|.
name|info
argument_list|(
literal|"Failed to get status detail for jobId='"
operator|+
name|job
operator|+
literal|"'"
argument_list|,
name|ex
argument_list|)
expr_stmt|;
name|jobItem
operator|.
name|detail
operator|=
operator|new
name|QueueStatusBean
argument_list|(
name|job
argument_list|,
literal|"Failed to retrieve status; see WebHCat logs"
argument_list|)
expr_stmt|;
block|}
block|}
name|detailList
operator|.
name|add
argument_list|(
name|jobItem
argument_list|)
expr_stmt|;
block|}
return|return
name|detailList
return|;
block|}
comment|/**    * Notify on a completed job.  Called by JobTracker.    */
annotation|@
name|GET
annotation|@
name|Path
argument_list|(
literal|"internal/complete/{jobid}"
argument_list|)
annotation|@
name|Produces
argument_list|(
block|{
name|MediaType
operator|.
name|APPLICATION_JSON
block|}
argument_list|)
specifier|public
name|CompleteBean
name|completeJob
parameter_list|(
annotation|@
name|PathParam
argument_list|(
literal|"jobid"
argument_list|)
name|String
name|jobid
parameter_list|,
annotation|@
name|QueryParam
argument_list|(
literal|"status"
argument_list|)
name|String
name|jobStatus
parameter_list|)
throws|throws
name|CallbackFailedException
throws|,
name|IOException
block|{
name|LOG
operator|.
name|debug
argument_list|(
literal|"Received callback "
operator|+
name|theUriInfo
operator|.
name|getRequestUri
argument_list|()
argument_list|)
expr_stmt|;
name|CompleteDelegator
name|d
init|=
operator|new
name|CompleteDelegator
argument_list|(
name|appConf
argument_list|)
decl_stmt|;
return|return
name|d
operator|.
name|run
argument_list|(
name|jobid
argument_list|,
name|jobStatus
argument_list|)
return|;
block|}
comment|/**    * Verify that we have a valid user.  Throw an exception if invalid.    */
specifier|public
name|void
name|verifyUser
parameter_list|()
throws|throws
name|NotAuthorizedException
block|{
name|String
name|requestingUser
init|=
name|getRequestingUser
argument_list|()
decl_stmt|;
if|if
condition|(
name|requestingUser
operator|==
literal|null
condition|)
block|{
name|String
name|msg
init|=
literal|"No user found."
decl_stmt|;
if|if
condition|(
operator|!
name|UserGroupInformation
operator|.
name|isSecurityEnabled
argument_list|()
condition|)
block|{
name|msg
operator|+=
literal|"  Missing "
operator|+
name|PseudoAuthenticator
operator|.
name|USER_NAME
operator|+
literal|" parameter."
expr_stmt|;
block|}
throw|throw
operator|new
name|NotAuthorizedException
argument_list|(
name|msg
argument_list|)
throw|;
block|}
if|if
condition|(
name|doAs
operator|!=
literal|null
operator|&&
operator|!
name|doAs
operator|.
name|equals
argument_list|(
name|requestingUser
argument_list|)
condition|)
block|{
comment|/*if doAs user is different than logged in user, need to check that       that logged in user is authorized to run as 'doAs'*/
name|ProxyUserSupport
operator|.
name|validate
argument_list|(
name|requestingUser
argument_list|,
name|getRequestingHost
argument_list|(
name|requestingUser
argument_list|,
name|request
argument_list|)
argument_list|,
name|doAs
argument_list|)
expr_stmt|;
block|}
block|}
comment|/**    * All 'tasks' spawned by WebHCat should be run as this user.  W/o doAs query parameter    * this is just the user making the request (or    * {@link org.apache.hadoop.security.authentication.client.PseudoAuthenticator#USER_NAME}    * query param).    * @return value of doAs query parameter or {@link #getRequestingUser()}    */
specifier|private
name|String
name|getDoAsUser
parameter_list|()
block|{
return|return
name|doAs
operator|!=
literal|null
operator|&&
operator|!
name|doAs
operator|.
name|equals
argument_list|(
name|getRequestingUser
argument_list|()
argument_list|)
condition|?
name|doAs
else|:
name|getRequestingUser
argument_list|()
return|;
block|}
comment|/**    * Verify that the parameter exists.  Throw an exception if invalid.    */
specifier|public
name|void
name|verifyParam
parameter_list|(
name|String
name|param
parameter_list|,
name|String
name|name
parameter_list|)
throws|throws
name|BadParam
block|{
if|if
condition|(
name|param
operator|==
literal|null
condition|)
block|{
throw|throw
operator|new
name|BadParam
argument_list|(
literal|"Missing "
operator|+
name|name
operator|+
literal|" parameter"
argument_list|)
throw|;
block|}
block|}
comment|/**    * Verify that the parameter exists.  Throw an exception if invalid.    */
specifier|public
name|void
name|verifyParam
parameter_list|(
name|List
argument_list|<
name|String
argument_list|>
name|param
parameter_list|,
name|String
name|name
parameter_list|)
throws|throws
name|BadParam
block|{
if|if
condition|(
name|param
operator|==
literal|null
operator|||
name|param
operator|.
name|isEmpty
argument_list|()
condition|)
block|{
throw|throw
operator|new
name|BadParam
argument_list|(
literal|"Missing "
operator|+
name|name
operator|+
literal|" parameter"
argument_list|)
throw|;
block|}
block|}
specifier|public
specifier|static
specifier|final
name|Pattern
name|DDL_ID
init|=
name|Pattern
operator|.
name|compile
argument_list|(
literal|"[a-zA-Z]\\w*"
argument_list|)
decl_stmt|;
comment|/**    * Verify that the parameter exists and is a simple DDL identifier    * name.  Throw an exception if invalid.    *    * Bug: This needs to allow for quoted ddl identifiers.    */
specifier|public
name|void
name|verifyDdlParam
parameter_list|(
name|String
name|param
parameter_list|,
name|String
name|name
parameter_list|)
throws|throws
name|BadParam
block|{
name|verifyParam
argument_list|(
name|param
argument_list|,
name|name
argument_list|)
expr_stmt|;
name|Matcher
name|m
init|=
name|DDL_ID
operator|.
name|matcher
argument_list|(
name|param
argument_list|)
decl_stmt|;
if|if
condition|(
operator|!
name|m
operator|.
name|matches
argument_list|()
condition|)
block|{
throw|throw
operator|new
name|BadParam
argument_list|(
literal|"Invalid DDL identifier "
operator|+
name|name
argument_list|)
throw|;
block|}
block|}
comment|/**    * Get the user name from the security context, i.e. the user making the HTTP request.    * With simple/pseudo security mode this should return the    * value of user.name query param, in kerberos mode it's the kinit'ed user.    */
specifier|private
name|String
name|getRequestingUser
parameter_list|()
block|{
if|if
condition|(
name|theSecurityContext
operator|==
literal|null
condition|)
block|{
return|return
literal|null
return|;
block|}
name|String
name|userName
init|=
literal|null
decl_stmt|;
if|if
condition|(
name|theSecurityContext
operator|.
name|getUserPrincipal
argument_list|()
operator|==
literal|null
condition|)
block|{
name|userName
operator|=
name|Main
operator|.
name|UserNameHandler
operator|.
name|getUserName
argument_list|(
name|request
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|userName
operator|=
name|theSecurityContext
operator|.
name|getUserPrincipal
argument_list|()
operator|.
name|getName
argument_list|()
expr_stmt|;
block|}
if|if
condition|(
name|userName
operator|==
literal|null
condition|)
block|{
return|return
literal|null
return|;
block|}
comment|//map hue/foo.bar@something.com->hue since user group checks
comment|// and config files are in terms of short name
return|return
name|UserGroupInformation
operator|.
name|createRemoteUser
argument_list|(
name|userName
argument_list|)
operator|.
name|getShortUserName
argument_list|()
return|;
block|}
comment|/**    * The callback url on this server when a task is completed.    */
specifier|public
name|String
name|getCompletedUrl
parameter_list|()
block|{
if|if
condition|(
name|theUriInfo
operator|==
literal|null
condition|)
block|{
return|return
literal|null
return|;
block|}
if|if
condition|(
name|theUriInfo
operator|.
name|getBaseUri
argument_list|()
operator|==
literal|null
condition|)
block|{
return|return
literal|null
return|;
block|}
return|return
name|theUriInfo
operator|.
name|getBaseUri
argument_list|()
operator|+
name|VERSION
operator|+
literal|"/internal/complete/$jobId?status=$jobStatus"
return|;
block|}
comment|/**    * Returns canonical host name from which the request is made; used for doAs validation    */
specifier|private
specifier|static
name|String
name|getRequestingHost
parameter_list|(
name|String
name|requestingUser
parameter_list|,
name|HttpServletRequest
name|request
parameter_list|)
block|{
specifier|final
name|String
name|unkHost
init|=
literal|"???"
decl_stmt|;
if|if
condition|(
name|request
operator|==
literal|null
condition|)
block|{
name|LOG
operator|.
name|warn
argument_list|(
literal|"request is null; cannot determine hostname"
argument_list|)
expr_stmt|;
return|return
name|unkHost
return|;
block|}
try|try
block|{
name|String
name|address
init|=
name|request
operator|.
name|getRemoteAddr
argument_list|()
decl_stmt|;
comment|//returns IP addr
if|if
condition|(
name|address
operator|==
literal|null
condition|)
block|{
name|LOG
operator|.
name|warn
argument_list|(
name|MessageFormat
operator|.
name|format
argument_list|(
literal|"Request remote address is NULL for user [{0}]"
argument_list|,
name|requestingUser
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|unkHost
return|;
block|}
comment|//Inet4Address/Inet6Address
name|String
name|hostName
init|=
name|InetAddress
operator|.
name|getByName
argument_list|(
name|address
argument_list|)
operator|.
name|getCanonicalHostName
argument_list|()
decl_stmt|;
if|if
condition|(
name|LOG
operator|.
name|isDebugEnabled
argument_list|()
condition|)
block|{
name|LOG
operator|.
name|debug
argument_list|(
name|MessageFormat
operator|.
name|format
argument_list|(
literal|"Resolved remote hostname: [{0}]"
argument_list|,
name|hostName
argument_list|)
argument_list|)
expr_stmt|;
block|}
return|return
name|hostName
return|;
block|}
catch|catch
parameter_list|(
name|UnknownHostException
name|ex
parameter_list|)
block|{
name|LOG
operator|.
name|warn
argument_list|(
name|MessageFormat
operator|.
name|format
argument_list|(
literal|"Request remote address could not be resolved, {0}"
argument_list|,
name|ex
operator|.
name|toString
argument_list|()
argument_list|,
name|ex
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|unkHost
return|;
block|}
block|}
specifier|private
name|void
name|checkEnableLogPrerequisite
parameter_list|(
name|boolean
name|enablelog
parameter_list|,
name|String
name|statusdir
parameter_list|)
throws|throws
name|BadParam
block|{
if|if
condition|(
name|enablelog
operator|&&
operator|!
name|TempletonUtils
operator|.
name|isset
argument_list|(
name|statusdir
argument_list|)
condition|)
throw|throw
operator|new
name|BadParam
argument_list|(
literal|"enablelog is only applicable when statusdir is set"
argument_list|)
throw|;
if|if
condition|(
name|enablelog
operator|&&
literal|"0.23"
operator|.
name|equalsIgnoreCase
argument_list|(
name|ShimLoader
operator|.
name|getMajorVersion
argument_list|()
argument_list|)
condition|)
block|{
throw|throw
operator|new
name|BadParam
argument_list|(
literal|"enablelog=true is only supported with Hadoop 1.x"
argument_list|)
throw|;
block|}
block|}
block|}
end_class

end_unit

