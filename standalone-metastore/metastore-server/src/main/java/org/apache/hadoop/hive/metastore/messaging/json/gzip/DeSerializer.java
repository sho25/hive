begin_unit|revision:0.9.5;language:Java;cregit-version:0.0.1
begin_package
package|package
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hive
operator|.
name|metastore
operator|.
name|messaging
operator|.
name|json
operator|.
name|gzip
package|;
end_package

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|commons
operator|.
name|io
operator|.
name|FileUtils
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|commons
operator|.
name|io
operator|.
name|IOUtils
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hive
operator|.
name|metastore
operator|.
name|messaging
operator|.
name|AbortTxnMessage
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hive
operator|.
name|metastore
operator|.
name|messaging
operator|.
name|AcidWriteMessage
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hive
operator|.
name|metastore
operator|.
name|messaging
operator|.
name|AddForeignKeyMessage
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hive
operator|.
name|metastore
operator|.
name|messaging
operator|.
name|AddNotNullConstraintMessage
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hive
operator|.
name|metastore
operator|.
name|messaging
operator|.
name|AddPartitionMessage
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hive
operator|.
name|metastore
operator|.
name|messaging
operator|.
name|AddPrimaryKeyMessage
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hive
operator|.
name|metastore
operator|.
name|messaging
operator|.
name|AddUniqueConstraintMessage
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hive
operator|.
name|metastore
operator|.
name|messaging
operator|.
name|AllocWriteIdMessage
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hive
operator|.
name|metastore
operator|.
name|messaging
operator|.
name|AlterDatabaseMessage
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hive
operator|.
name|metastore
operator|.
name|messaging
operator|.
name|AlterPartitionMessage
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hive
operator|.
name|metastore
operator|.
name|messaging
operator|.
name|AlterTableMessage
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hive
operator|.
name|metastore
operator|.
name|messaging
operator|.
name|CommitTxnMessage
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hive
operator|.
name|metastore
operator|.
name|messaging
operator|.
name|CreateDatabaseMessage
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hive
operator|.
name|metastore
operator|.
name|messaging
operator|.
name|CreateFunctionMessage
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hive
operator|.
name|metastore
operator|.
name|messaging
operator|.
name|CreateTableMessage
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hive
operator|.
name|metastore
operator|.
name|messaging
operator|.
name|DropConstraintMessage
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hive
operator|.
name|metastore
operator|.
name|messaging
operator|.
name|DropDatabaseMessage
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hive
operator|.
name|metastore
operator|.
name|messaging
operator|.
name|DropFunctionMessage
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hive
operator|.
name|metastore
operator|.
name|messaging
operator|.
name|DropPartitionMessage
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hive
operator|.
name|metastore
operator|.
name|messaging
operator|.
name|DropTableMessage
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hive
operator|.
name|metastore
operator|.
name|messaging
operator|.
name|InsertMessage
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hive
operator|.
name|metastore
operator|.
name|messaging
operator|.
name|OpenTxnMessage
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hive
operator|.
name|metastore
operator|.
name|messaging
operator|.
name|json
operator|.
name|JSONMessageDeserializer
import|;
end_import

begin_import
import|import
name|org
operator|.
name|slf4j
operator|.
name|Logger
import|;
end_import

begin_import
import|import
name|org
operator|.
name|slf4j
operator|.
name|LoggerFactory
import|;
end_import

begin_import
import|import
name|java
operator|.
name|io
operator|.
name|ByteArrayInputStream
import|;
end_import

begin_import
import|import
name|java
operator|.
name|io
operator|.
name|File
import|;
end_import

begin_import
import|import
name|java
operator|.
name|io
operator|.
name|IOException
import|;
end_import

begin_import
import|import
name|java
operator|.
name|nio
operator|.
name|charset
operator|.
name|StandardCharsets
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|Base64
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|zip
operator|.
name|GZIPInputStream
import|;
end_import

begin_class
specifier|public
class|class
name|DeSerializer
extends|extends
name|JSONMessageDeserializer
block|{
specifier|private
specifier|static
specifier|final
name|Logger
name|LOG
init|=
name|LoggerFactory
operator|.
name|getLogger
argument_list|(
name|Serializer
operator|.
name|class
operator|.
name|getName
argument_list|()
argument_list|)
decl_stmt|;
specifier|private
specifier|static
name|String
name|deCompress
parameter_list|(
name|String
name|messageBody
parameter_list|)
block|{
name|byte
index|[]
name|decodedBytes
init|=
name|Base64
operator|.
name|getDecoder
argument_list|()
operator|.
name|decode
argument_list|(
name|messageBody
operator|.
name|getBytes
argument_list|(
name|StandardCharsets
operator|.
name|UTF_8
argument_list|)
argument_list|)
decl_stmt|;
try|try
init|(
name|ByteArrayInputStream
name|in
init|=
operator|new
name|ByteArrayInputStream
argument_list|(
name|decodedBytes
argument_list|)
init|;
name|GZIPInputStream
name|is
operator|=
operator|new
name|GZIPInputStream
argument_list|(
name|in
argument_list|)
init|)
block|{
name|byte
index|[]
name|bytes
init|=
name|IOUtils
operator|.
name|toByteArray
argument_list|(
name|is
argument_list|)
decl_stmt|;
return|return
operator|new
name|String
argument_list|(
name|bytes
argument_list|,
name|StandardCharsets
operator|.
name|UTF_8
argument_list|)
return|;
block|}
catch|catch
parameter_list|(
name|IOException
name|e
parameter_list|)
block|{
name|LOG
operator|.
name|error
argument_list|(
literal|"cannot decode the stream"
argument_list|,
name|e
argument_list|)
expr_stmt|;
name|LOG
operator|.
name|debug
argument_list|(
literal|"base64 encoded String"
argument_list|,
name|messageBody
argument_list|)
expr_stmt|;
throw|throw
operator|new
name|RuntimeException
argument_list|(
literal|"cannot decode the stream "
argument_list|,
name|e
argument_list|)
throw|;
block|}
block|}
comment|/**    * this is mainly as a utility to allow debugging of messages for developers by providing the    * message in a file and getting an actual message out.    * This class on a deployed hive instance will also be bundled in hive-exec jar.    *    */
specifier|public
specifier|static
name|void
name|main
parameter_list|(
name|String
index|[]
name|args
parameter_list|)
throws|throws
name|IOException
block|{
if|if
condition|(
name|args
operator|.
name|length
operator|!=
literal|1
condition|)
block|{
name|System
operator|.
name|out
operator|.
name|println
argument_list|(
literal|"Usage:"
argument_list|)
expr_stmt|;
name|System
operator|.
name|out
operator|.
name|println
argument_list|(
literal|"java -cp [classpath] "
operator|+
name|DeSerializer
operator|.
name|class
operator|.
name|getCanonicalName
argument_list|()
operator|+
literal|" [file_location]"
argument_list|)
expr_stmt|;
block|}
name|System
operator|.
name|out
operator|.
name|print
argument_list|(
name|deCompress
argument_list|(
name|FileUtils
operator|.
name|readFileToString
argument_list|(
operator|new
name|File
argument_list|(
name|args
index|[
literal|0
index|]
argument_list|)
argument_list|,
name|StandardCharsets
operator|.
name|UTF_8
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
specifier|public
name|CreateDatabaseMessage
name|getCreateDatabaseMessage
parameter_list|(
name|String
name|messageBody
parameter_list|)
block|{
return|return
name|super
operator|.
name|getCreateDatabaseMessage
argument_list|(
name|deCompress
argument_list|(
name|messageBody
argument_list|)
argument_list|)
return|;
block|}
annotation|@
name|Override
specifier|public
name|AlterDatabaseMessage
name|getAlterDatabaseMessage
parameter_list|(
name|String
name|messageBody
parameter_list|)
block|{
return|return
name|super
operator|.
name|getAlterDatabaseMessage
argument_list|(
name|deCompress
argument_list|(
name|messageBody
argument_list|)
argument_list|)
return|;
block|}
annotation|@
name|Override
specifier|public
name|DropDatabaseMessage
name|getDropDatabaseMessage
parameter_list|(
name|String
name|messageBody
parameter_list|)
block|{
return|return
name|super
operator|.
name|getDropDatabaseMessage
argument_list|(
name|deCompress
argument_list|(
name|messageBody
argument_list|)
argument_list|)
return|;
block|}
annotation|@
name|Override
specifier|public
name|CreateTableMessage
name|getCreateTableMessage
parameter_list|(
name|String
name|messageBody
parameter_list|)
block|{
return|return
name|super
operator|.
name|getCreateTableMessage
argument_list|(
name|deCompress
argument_list|(
name|messageBody
argument_list|)
argument_list|)
return|;
block|}
annotation|@
name|Override
specifier|public
name|AlterTableMessage
name|getAlterTableMessage
parameter_list|(
name|String
name|messageBody
parameter_list|)
block|{
return|return
name|super
operator|.
name|getAlterTableMessage
argument_list|(
name|deCompress
argument_list|(
name|messageBody
argument_list|)
argument_list|)
return|;
block|}
annotation|@
name|Override
specifier|public
name|DropTableMessage
name|getDropTableMessage
parameter_list|(
name|String
name|messageBody
parameter_list|)
block|{
return|return
name|super
operator|.
name|getDropTableMessage
argument_list|(
name|deCompress
argument_list|(
name|messageBody
argument_list|)
argument_list|)
return|;
block|}
annotation|@
name|Override
specifier|public
name|AddPartitionMessage
name|getAddPartitionMessage
parameter_list|(
name|String
name|messageBody
parameter_list|)
block|{
return|return
name|super
operator|.
name|getAddPartitionMessage
argument_list|(
name|deCompress
argument_list|(
name|messageBody
argument_list|)
argument_list|)
return|;
block|}
annotation|@
name|Override
specifier|public
name|AlterPartitionMessage
name|getAlterPartitionMessage
parameter_list|(
name|String
name|messageBody
parameter_list|)
block|{
return|return
name|super
operator|.
name|getAlterPartitionMessage
argument_list|(
name|deCompress
argument_list|(
name|messageBody
argument_list|)
argument_list|)
return|;
block|}
annotation|@
name|Override
specifier|public
name|DropPartitionMessage
name|getDropPartitionMessage
parameter_list|(
name|String
name|messageBody
parameter_list|)
block|{
return|return
name|super
operator|.
name|getDropPartitionMessage
argument_list|(
name|deCompress
argument_list|(
name|messageBody
argument_list|)
argument_list|)
return|;
block|}
annotation|@
name|Override
specifier|public
name|CreateFunctionMessage
name|getCreateFunctionMessage
parameter_list|(
name|String
name|messageBody
parameter_list|)
block|{
return|return
name|super
operator|.
name|getCreateFunctionMessage
argument_list|(
name|deCompress
argument_list|(
name|messageBody
argument_list|)
argument_list|)
return|;
block|}
annotation|@
name|Override
specifier|public
name|DropFunctionMessage
name|getDropFunctionMessage
parameter_list|(
name|String
name|messageBody
parameter_list|)
block|{
return|return
name|super
operator|.
name|getDropFunctionMessage
argument_list|(
name|deCompress
argument_list|(
name|messageBody
argument_list|)
argument_list|)
return|;
block|}
annotation|@
name|Override
specifier|public
name|InsertMessage
name|getInsertMessage
parameter_list|(
name|String
name|messageBody
parameter_list|)
block|{
return|return
name|super
operator|.
name|getInsertMessage
argument_list|(
name|deCompress
argument_list|(
name|messageBody
argument_list|)
argument_list|)
return|;
block|}
annotation|@
name|Override
specifier|public
name|AddPrimaryKeyMessage
name|getAddPrimaryKeyMessage
parameter_list|(
name|String
name|messageBody
parameter_list|)
block|{
return|return
name|super
operator|.
name|getAddPrimaryKeyMessage
argument_list|(
name|deCompress
argument_list|(
name|messageBody
argument_list|)
argument_list|)
return|;
block|}
annotation|@
name|Override
specifier|public
name|AddForeignKeyMessage
name|getAddForeignKeyMessage
parameter_list|(
name|String
name|messageBody
parameter_list|)
block|{
return|return
name|super
operator|.
name|getAddForeignKeyMessage
argument_list|(
name|deCompress
argument_list|(
name|messageBody
argument_list|)
argument_list|)
return|;
block|}
annotation|@
name|Override
specifier|public
name|AddUniqueConstraintMessage
name|getAddUniqueConstraintMessage
parameter_list|(
name|String
name|messageBody
parameter_list|)
block|{
return|return
name|super
operator|.
name|getAddUniqueConstraintMessage
argument_list|(
name|deCompress
argument_list|(
name|messageBody
argument_list|)
argument_list|)
return|;
block|}
annotation|@
name|Override
specifier|public
name|AddNotNullConstraintMessage
name|getAddNotNullConstraintMessage
parameter_list|(
name|String
name|messageBody
parameter_list|)
block|{
return|return
name|super
operator|.
name|getAddNotNullConstraintMessage
argument_list|(
name|deCompress
argument_list|(
name|messageBody
argument_list|)
argument_list|)
return|;
block|}
annotation|@
name|Override
specifier|public
name|DropConstraintMessage
name|getDropConstraintMessage
parameter_list|(
name|String
name|messageBody
parameter_list|)
block|{
return|return
name|super
operator|.
name|getDropConstraintMessage
argument_list|(
name|deCompress
argument_list|(
name|messageBody
argument_list|)
argument_list|)
return|;
block|}
annotation|@
name|Override
specifier|public
name|OpenTxnMessage
name|getOpenTxnMessage
parameter_list|(
name|String
name|messageBody
parameter_list|)
block|{
return|return
name|super
operator|.
name|getOpenTxnMessage
argument_list|(
name|deCompress
argument_list|(
name|messageBody
argument_list|)
argument_list|)
return|;
block|}
annotation|@
name|Override
specifier|public
name|CommitTxnMessage
name|getCommitTxnMessage
parameter_list|(
name|String
name|messageBody
parameter_list|)
block|{
return|return
name|super
operator|.
name|getCommitTxnMessage
argument_list|(
name|deCompress
argument_list|(
name|messageBody
argument_list|)
argument_list|)
return|;
block|}
annotation|@
name|Override
specifier|public
name|AbortTxnMessage
name|getAbortTxnMessage
parameter_list|(
name|String
name|messageBody
parameter_list|)
block|{
return|return
name|super
operator|.
name|getAbortTxnMessage
argument_list|(
name|deCompress
argument_list|(
name|messageBody
argument_list|)
argument_list|)
return|;
block|}
annotation|@
name|Override
specifier|public
name|AllocWriteIdMessage
name|getAllocWriteIdMessage
parameter_list|(
name|String
name|messageBody
parameter_list|)
block|{
return|return
name|super
operator|.
name|getAllocWriteIdMessage
argument_list|(
name|deCompress
argument_list|(
name|messageBody
argument_list|)
argument_list|)
return|;
block|}
annotation|@
name|Override
specifier|public
name|AcidWriteMessage
name|getAcidWriteMessage
parameter_list|(
name|String
name|messageBody
parameter_list|)
block|{
return|return
name|super
operator|.
name|getAcidWriteMessage
argument_list|(
name|deCompress
argument_list|(
name|messageBody
argument_list|)
argument_list|)
return|;
block|}
block|}
end_class

end_unit

