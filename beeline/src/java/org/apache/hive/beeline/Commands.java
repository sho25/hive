begin_unit|revision:0.9.5;language:Java;cregit-version:0.0.1
begin_comment
comment|/**  * Licensed to the Apache Software Foundation (ASF) under one  * or more contributor license agreements.  See the NOTICE file  * distributed with this work for additional information  * regarding copyright ownership.  The ASF licenses this file  * to you under the Apache License, Version 2.0 (the  * "License"); you may not use this file except in compliance  * with the License.  You may obtain a copy of the License at  *  *     http://www.apache.org/licenses/LICENSE-2.0  *  * Unless required by applicable law or agreed to in writing, software  * distributed under the License is distributed on an "AS IS" BASIS,  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  * See the License for the specific language governing permissions and  * limitations under the License.  */
end_comment

begin_comment
comment|/*  * This source file is based on code taken from SQLLine 1.0.2  * See SQLLine notice in LICENSE  */
end_comment

begin_package
package|package
name|org
operator|.
name|apache
operator|.
name|hive
operator|.
name|beeline
package|;
end_package

begin_import
import|import
name|java
operator|.
name|io
operator|.
name|BufferedReader
import|;
end_import

begin_import
import|import
name|java
operator|.
name|io
operator|.
name|FileInputStream
import|;
end_import

begin_import
import|import
name|java
operator|.
name|io
operator|.
name|FileReader
import|;
end_import

begin_import
import|import
name|java
operator|.
name|io
operator|.
name|IOException
import|;
end_import

begin_import
import|import
name|java
operator|.
name|io
operator|.
name|InputStream
import|;
end_import

begin_import
import|import
name|java
operator|.
name|io
operator|.
name|InputStreamReader
import|;
end_import

begin_import
import|import
name|java
operator|.
name|lang
operator|.
name|reflect
operator|.
name|Method
import|;
end_import

begin_import
import|import
name|java
operator|.
name|sql
operator|.
name|CallableStatement
import|;
end_import

begin_import
import|import
name|java
operator|.
name|sql
operator|.
name|Connection
import|;
end_import

begin_import
import|import
name|java
operator|.
name|sql
operator|.
name|DatabaseMetaData
import|;
end_import

begin_import
import|import
name|java
operator|.
name|sql
operator|.
name|Driver
import|;
end_import

begin_import
import|import
name|java
operator|.
name|sql
operator|.
name|ResultSet
import|;
end_import

begin_import
import|import
name|java
operator|.
name|sql
operator|.
name|SQLException
import|;
end_import

begin_import
import|import
name|java
operator|.
name|sql
operator|.
name|Statement
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|Arrays
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|Iterator
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|LinkedList
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|List
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|Properties
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|Set
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|TreeSet
import|;
end_import

begin_class
specifier|public
class|class
name|Commands
block|{
specifier|private
specifier|final
name|BeeLine
name|beeLine
decl_stmt|;
comment|/**    * @param beeLine    */
name|Commands
parameter_list|(
name|BeeLine
name|beeLine
parameter_list|)
block|{
name|this
operator|.
name|beeLine
operator|=
name|beeLine
expr_stmt|;
block|}
specifier|public
name|boolean
name|metadata
parameter_list|(
name|String
name|line
parameter_list|)
block|{
name|beeLine
operator|.
name|debug
argument_list|(
name|line
argument_list|)
expr_stmt|;
name|String
index|[]
name|parts
init|=
name|beeLine
operator|.
name|split
argument_list|(
name|line
argument_list|)
decl_stmt|;
name|List
argument_list|<
name|String
argument_list|>
name|params
init|=
operator|new
name|LinkedList
argument_list|<
name|String
argument_list|>
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
name|parts
argument_list|)
argument_list|)
decl_stmt|;
if|if
condition|(
name|parts
operator|==
literal|null
operator|||
name|parts
operator|.
name|length
operator|==
literal|0
condition|)
block|{
return|return
name|dbinfo
argument_list|(
literal|""
argument_list|)
return|;
block|}
name|params
operator|.
name|remove
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|params
operator|.
name|remove
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|beeLine
operator|.
name|debug
argument_list|(
name|params
operator|.
name|toString
argument_list|()
argument_list|)
expr_stmt|;
return|return
name|metadata
argument_list|(
name|parts
index|[
literal|1
index|]
argument_list|,
name|params
operator|.
name|toArray
argument_list|(
operator|new
name|String
index|[
literal|0
index|]
argument_list|)
argument_list|)
return|;
block|}
specifier|public
name|boolean
name|metadata
parameter_list|(
name|String
name|cmd
parameter_list|,
name|String
index|[]
name|args
parameter_list|)
block|{
if|if
condition|(
operator|!
operator|(
name|beeLine
operator|.
name|assertConnection
argument_list|()
operator|)
condition|)
block|{
return|return
literal|false
return|;
block|}
try|try
block|{
name|Method
index|[]
name|m
init|=
name|beeLine
operator|.
name|getDatabaseMetaData
argument_list|()
operator|.
name|getClass
argument_list|()
operator|.
name|getMethods
argument_list|()
decl_stmt|;
name|Set
argument_list|<
name|String
argument_list|>
name|methodNames
init|=
operator|new
name|TreeSet
argument_list|<
name|String
argument_list|>
argument_list|()
decl_stmt|;
name|Set
argument_list|<
name|String
argument_list|>
name|methodNamesUpper
init|=
operator|new
name|TreeSet
argument_list|<
name|String
argument_list|>
argument_list|()
decl_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|m
operator|.
name|length
condition|;
name|i
operator|++
control|)
block|{
name|methodNames
operator|.
name|add
argument_list|(
name|m
index|[
name|i
index|]
operator|.
name|getName
argument_list|()
argument_list|)
expr_stmt|;
name|methodNamesUpper
operator|.
name|add
argument_list|(
name|m
index|[
name|i
index|]
operator|.
name|getName
argument_list|()
operator|.
name|toUpperCase
argument_list|()
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|methodNamesUpper
operator|.
name|contains
argument_list|(
name|cmd
operator|.
name|toUpperCase
argument_list|()
argument_list|)
condition|)
block|{
name|beeLine
operator|.
name|error
argument_list|(
name|beeLine
operator|.
name|loc
argument_list|(
literal|"no-such-method"
argument_list|,
name|cmd
argument_list|)
argument_list|)
expr_stmt|;
name|beeLine
operator|.
name|error
argument_list|(
name|beeLine
operator|.
name|loc
argument_list|(
literal|"possible-methods"
argument_list|)
argument_list|)
expr_stmt|;
for|for
control|(
name|Iterator
argument_list|<
name|String
argument_list|>
name|i
init|=
name|methodNames
operator|.
name|iterator
argument_list|()
init|;
name|i
operator|.
name|hasNext
argument_list|()
condition|;
control|)
block|{
name|beeLine
operator|.
name|error
argument_list|(
literal|"   "
operator|+
name|i
operator|.
name|next
argument_list|()
argument_list|)
expr_stmt|;
block|}
return|return
literal|false
return|;
block|}
name|Object
name|res
init|=
name|beeLine
operator|.
name|getReflector
argument_list|()
operator|.
name|invoke
argument_list|(
name|beeLine
operator|.
name|getDatabaseMetaData
argument_list|()
argument_list|,
name|DatabaseMetaData
operator|.
name|class
argument_list|,
name|cmd
argument_list|,
name|Arrays
operator|.
name|asList
argument_list|(
name|args
argument_list|)
argument_list|)
decl_stmt|;
if|if
condition|(
name|res
operator|instanceof
name|ResultSet
condition|)
block|{
name|ResultSet
name|rs
init|=
operator|(
name|ResultSet
operator|)
name|res
decl_stmt|;
if|if
condition|(
name|rs
operator|!=
literal|null
condition|)
block|{
try|try
block|{
name|beeLine
operator|.
name|print
argument_list|(
name|rs
argument_list|)
expr_stmt|;
block|}
finally|finally
block|{
name|rs
operator|.
name|close
argument_list|()
expr_stmt|;
block|}
block|}
block|}
elseif|else
if|if
condition|(
name|res
operator|!=
literal|null
condition|)
block|{
name|beeLine
operator|.
name|output
argument_list|(
name|res
operator|.
name|toString
argument_list|()
argument_list|)
expr_stmt|;
block|}
block|}
catch|catch
parameter_list|(
name|Exception
name|e
parameter_list|)
block|{
return|return
name|beeLine
operator|.
name|error
argument_list|(
name|e
argument_list|)
return|;
block|}
return|return
literal|true
return|;
block|}
specifier|public
name|boolean
name|history
parameter_list|(
name|String
name|line
parameter_list|)
block|{
name|List
name|hist
init|=
name|beeLine
operator|.
name|getConsoleReader
argument_list|()
operator|.
name|getHistory
argument_list|()
operator|.
name|getHistoryList
argument_list|()
decl_stmt|;
name|int
name|index
init|=
literal|1
decl_stmt|;
for|for
control|(
name|Iterator
name|i
init|=
name|hist
operator|.
name|iterator
argument_list|()
init|;
name|i
operator|.
name|hasNext
argument_list|()
condition|;
name|index
operator|++
control|)
block|{
name|beeLine
operator|.
name|output
argument_list|(
name|beeLine
operator|.
name|getColorBuffer
argument_list|()
operator|.
name|pad
argument_list|(
name|index
operator|+
literal|"."
argument_list|,
literal|6
argument_list|)
operator|.
name|append
argument_list|(
name|i
operator|.
name|next
argument_list|()
operator|.
name|toString
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
block|}
return|return
literal|true
return|;
block|}
name|String
name|arg1
parameter_list|(
name|String
name|line
parameter_list|,
name|String
name|paramname
parameter_list|)
block|{
return|return
name|arg1
argument_list|(
name|line
argument_list|,
name|paramname
argument_list|,
literal|null
argument_list|)
return|;
block|}
name|String
name|arg1
parameter_list|(
name|String
name|line
parameter_list|,
name|String
name|paramname
parameter_list|,
name|String
name|def
parameter_list|)
block|{
name|String
index|[]
name|ret
init|=
name|beeLine
operator|.
name|split
argument_list|(
name|line
argument_list|)
decl_stmt|;
if|if
condition|(
name|ret
operator|==
literal|null
operator|||
name|ret
operator|.
name|length
operator|!=
literal|2
condition|)
block|{
if|if
condition|(
name|def
operator|!=
literal|null
condition|)
block|{
return|return
name|def
return|;
block|}
throw|throw
operator|new
name|IllegalArgumentException
argument_list|(
name|beeLine
operator|.
name|loc
argument_list|(
literal|"arg-usage"
argument_list|,
operator|new
name|Object
index|[]
block|{
name|ret
operator|.
name|length
operator|==
literal|0
condition|?
literal|""
else|:
name|ret
index|[
literal|0
index|]
block|,
name|paramname
block|}
argument_list|)
argument_list|)
throw|;
block|}
return|return
name|ret
index|[
literal|1
index|]
return|;
block|}
specifier|public
name|boolean
name|indexes
parameter_list|(
name|String
name|line
parameter_list|)
throws|throws
name|Exception
block|{
return|return
name|metadata
argument_list|(
literal|"getIndexInfo"
argument_list|,
operator|new
name|String
index|[]
block|{
name|beeLine
operator|.
name|getConnection
argument_list|()
operator|.
name|getCatalog
argument_list|()
block|,
literal|null
block|,
name|arg1
argument_list|(
name|line
argument_list|,
literal|"table name"
argument_list|)
block|,
literal|false
operator|+
literal|""
block|,
literal|true
operator|+
literal|""
block|}
argument_list|)
return|;
block|}
specifier|public
name|boolean
name|primarykeys
parameter_list|(
name|String
name|line
parameter_list|)
throws|throws
name|Exception
block|{
return|return
name|metadata
argument_list|(
literal|"getPrimaryKeys"
argument_list|,
operator|new
name|String
index|[]
block|{
name|beeLine
operator|.
name|getConnection
argument_list|()
operator|.
name|getCatalog
argument_list|()
block|,
literal|null
block|,
name|arg1
argument_list|(
name|line
argument_list|,
literal|"table name"
argument_list|)
block|,}
argument_list|)
return|;
block|}
specifier|public
name|boolean
name|exportedkeys
parameter_list|(
name|String
name|line
parameter_list|)
throws|throws
name|Exception
block|{
return|return
name|metadata
argument_list|(
literal|"getExportedKeys"
argument_list|,
operator|new
name|String
index|[]
block|{
name|beeLine
operator|.
name|getConnection
argument_list|()
operator|.
name|getCatalog
argument_list|()
block|,
literal|null
block|,
name|arg1
argument_list|(
name|line
argument_list|,
literal|"table name"
argument_list|)
block|,}
argument_list|)
return|;
block|}
specifier|public
name|boolean
name|importedkeys
parameter_list|(
name|String
name|line
parameter_list|)
throws|throws
name|Exception
block|{
return|return
name|metadata
argument_list|(
literal|"getImportedKeys"
argument_list|,
operator|new
name|String
index|[]
block|{
name|beeLine
operator|.
name|getConnection
argument_list|()
operator|.
name|getCatalog
argument_list|()
block|,
literal|null
block|,
name|arg1
argument_list|(
name|line
argument_list|,
literal|"table name"
argument_list|)
block|,}
argument_list|)
return|;
block|}
specifier|public
name|boolean
name|procedures
parameter_list|(
name|String
name|line
parameter_list|)
throws|throws
name|Exception
block|{
return|return
name|metadata
argument_list|(
literal|"getProcedures"
argument_list|,
operator|new
name|String
index|[]
block|{
name|beeLine
operator|.
name|getConnection
argument_list|()
operator|.
name|getCatalog
argument_list|()
block|,
literal|null
block|,
name|arg1
argument_list|(
name|line
argument_list|,
literal|"procedure name pattern"
argument_list|,
literal|"%"
argument_list|)
block|,}
argument_list|)
return|;
block|}
specifier|public
name|boolean
name|tables
parameter_list|(
name|String
name|line
parameter_list|)
throws|throws
name|Exception
block|{
return|return
name|metadata
argument_list|(
literal|"getTables"
argument_list|,
operator|new
name|String
index|[]
block|{
name|beeLine
operator|.
name|getConnection
argument_list|()
operator|.
name|getCatalog
argument_list|()
block|,
literal|null
block|,
name|arg1
argument_list|(
name|line
argument_list|,
literal|"table name"
argument_list|,
literal|"%"
argument_list|)
block|,
literal|null
block|}
argument_list|)
return|;
block|}
specifier|public
name|boolean
name|typeinfo
parameter_list|(
name|String
name|line
parameter_list|)
throws|throws
name|Exception
block|{
return|return
name|metadata
argument_list|(
literal|"getTypeInfo"
argument_list|,
operator|new
name|String
index|[
literal|0
index|]
argument_list|)
return|;
block|}
specifier|public
name|boolean
name|nativesql
parameter_list|(
name|String
name|sql
parameter_list|)
throws|throws
name|Exception
block|{
if|if
condition|(
name|sql
operator|.
name|startsWith
argument_list|(
name|BeeLine
operator|.
name|COMMAND_PREFIX
argument_list|)
condition|)
block|{
name|sql
operator|=
name|sql
operator|.
name|substring
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|sql
operator|.
name|startsWith
argument_list|(
literal|"native"
argument_list|)
condition|)
block|{
name|sql
operator|=
name|sql
operator|.
name|substring
argument_list|(
literal|"native"
operator|.
name|length
argument_list|()
operator|+
literal|1
argument_list|)
expr_stmt|;
block|}
name|String
name|nat
init|=
name|beeLine
operator|.
name|getConnection
argument_list|()
operator|.
name|nativeSQL
argument_list|(
name|sql
argument_list|)
decl_stmt|;
name|beeLine
operator|.
name|output
argument_list|(
name|nat
argument_list|)
expr_stmt|;
return|return
literal|true
return|;
block|}
specifier|public
name|boolean
name|columns
parameter_list|(
name|String
name|line
parameter_list|)
throws|throws
name|Exception
block|{
return|return
name|metadata
argument_list|(
literal|"getColumns"
argument_list|,
operator|new
name|String
index|[]
block|{
name|beeLine
operator|.
name|getConnection
argument_list|()
operator|.
name|getCatalog
argument_list|()
block|,
literal|null
block|,
name|arg1
argument_list|(
name|line
argument_list|,
literal|"table name"
argument_list|)
block|,
literal|"%"
block|}
argument_list|)
return|;
block|}
specifier|public
name|boolean
name|dropall
parameter_list|(
name|String
name|line
parameter_list|)
block|{
if|if
condition|(
name|beeLine
operator|.
name|getDatabaseConnection
argument_list|()
operator|==
literal|null
operator|||
name|beeLine
operator|.
name|getDatabaseConnection
argument_list|()
operator|.
name|getUrl
argument_list|()
operator|==
literal|null
condition|)
block|{
return|return
name|beeLine
operator|.
name|error
argument_list|(
name|beeLine
operator|.
name|loc
argument_list|(
literal|"no-current-connection"
argument_list|)
argument_list|)
return|;
block|}
try|try
block|{
if|if
condition|(
operator|!
operator|(
name|beeLine
operator|.
name|getConsoleReader
argument_list|()
operator|.
name|readLine
argument_list|(
name|beeLine
operator|.
name|loc
argument_list|(
literal|"really-drop-all"
argument_list|)
argument_list|)
operator|.
name|equals
argument_list|(
literal|"y"
argument_list|)
operator|)
condition|)
block|{
return|return
name|beeLine
operator|.
name|error
argument_list|(
literal|"abort-drop-all"
argument_list|)
return|;
block|}
name|List
argument_list|<
name|String
argument_list|>
name|cmds
init|=
operator|new
name|LinkedList
argument_list|<
name|String
argument_list|>
argument_list|()
decl_stmt|;
name|ResultSet
name|rs
init|=
name|beeLine
operator|.
name|getTables
argument_list|()
decl_stmt|;
try|try
block|{
while|while
condition|(
name|rs
operator|.
name|next
argument_list|()
condition|)
block|{
name|cmds
operator|.
name|add
argument_list|(
literal|"DROP TABLE "
operator|+
name|rs
operator|.
name|getString
argument_list|(
literal|"TABLE_NAME"
argument_list|)
operator|+
literal|";"
argument_list|)
expr_stmt|;
block|}
block|}
finally|finally
block|{
try|try
block|{
name|rs
operator|.
name|close
argument_list|()
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|Exception
name|e
parameter_list|)
block|{         }
block|}
comment|// run as a batch
return|return
name|beeLine
operator|.
name|runCommands
argument_list|(
name|cmds
argument_list|)
operator|==
name|cmds
operator|.
name|size
argument_list|()
return|;
block|}
catch|catch
parameter_list|(
name|Exception
name|e
parameter_list|)
block|{
return|return
name|beeLine
operator|.
name|error
argument_list|(
name|e
argument_list|)
return|;
block|}
block|}
specifier|public
name|boolean
name|reconnect
parameter_list|(
name|String
name|line
parameter_list|)
block|{
if|if
condition|(
name|beeLine
operator|.
name|getDatabaseConnection
argument_list|()
operator|==
literal|null
operator|||
name|beeLine
operator|.
name|getDatabaseConnection
argument_list|()
operator|.
name|getUrl
argument_list|()
operator|==
literal|null
condition|)
block|{
return|return
name|beeLine
operator|.
name|error
argument_list|(
name|beeLine
operator|.
name|loc
argument_list|(
literal|"no-current-connection"
argument_list|)
argument_list|)
return|;
block|}
name|beeLine
operator|.
name|info
argument_list|(
name|beeLine
operator|.
name|loc
argument_list|(
literal|"reconnecting"
argument_list|,
name|beeLine
operator|.
name|getDatabaseConnection
argument_list|()
operator|.
name|getUrl
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
try|try
block|{
name|beeLine
operator|.
name|getDatabaseConnection
argument_list|()
operator|.
name|reconnect
argument_list|()
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|Exception
name|e
parameter_list|)
block|{
return|return
name|beeLine
operator|.
name|error
argument_list|(
name|e
argument_list|)
return|;
block|}
return|return
literal|true
return|;
block|}
specifier|public
name|boolean
name|scan
parameter_list|(
name|String
name|line
parameter_list|)
throws|throws
name|IOException
block|{
name|TreeSet
argument_list|<
name|String
argument_list|>
name|names
init|=
operator|new
name|TreeSet
argument_list|<
name|String
argument_list|>
argument_list|()
decl_stmt|;
if|if
condition|(
name|beeLine
operator|.
name|getDrivers
argument_list|()
operator|==
literal|null
condition|)
block|{
name|beeLine
operator|.
name|setDrivers
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
name|beeLine
operator|.
name|scanDrivers
argument_list|(
name|line
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|beeLine
operator|.
name|info
argument_list|(
name|beeLine
operator|.
name|loc
argument_list|(
literal|"drivers-found-count"
argument_list|,
name|beeLine
operator|.
name|getDrivers
argument_list|()
operator|.
name|size
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
comment|// unique the list
for|for
control|(
name|Iterator
argument_list|<
name|Driver
argument_list|>
name|i
init|=
name|beeLine
operator|.
name|getDrivers
argument_list|()
operator|.
name|iterator
argument_list|()
init|;
name|i
operator|.
name|hasNext
argument_list|()
condition|;
control|)
block|{
name|names
operator|.
name|add
argument_list|(
name|i
operator|.
name|next
argument_list|()
operator|.
name|getClass
argument_list|()
operator|.
name|getName
argument_list|()
argument_list|)
expr_stmt|;
block|}
name|beeLine
operator|.
name|output
argument_list|(
name|beeLine
operator|.
name|getColorBuffer
argument_list|()
operator|.
name|bold
argument_list|(
name|beeLine
operator|.
name|getColorBuffer
argument_list|()
operator|.
name|pad
argument_list|(
name|beeLine
operator|.
name|loc
argument_list|(
literal|"compliant"
argument_list|)
argument_list|,
literal|10
argument_list|)
operator|.
name|getMono
argument_list|()
argument_list|)
operator|.
name|bold
argument_list|(
name|beeLine
operator|.
name|getColorBuffer
argument_list|()
operator|.
name|pad
argument_list|(
name|beeLine
operator|.
name|loc
argument_list|(
literal|"jdbc-version"
argument_list|)
argument_list|,
literal|8
argument_list|)
operator|.
name|getMono
argument_list|()
argument_list|)
operator|.
name|bold
argument_list|(
name|beeLine
operator|.
name|getColorBuffer
argument_list|(
name|beeLine
operator|.
name|loc
argument_list|(
literal|"driver-class"
argument_list|)
argument_list|)
operator|.
name|getMono
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
for|for
control|(
name|Iterator
argument_list|<
name|String
argument_list|>
name|i
init|=
name|names
operator|.
name|iterator
argument_list|()
init|;
name|i
operator|.
name|hasNext
argument_list|()
condition|;
control|)
block|{
name|String
name|name
init|=
name|i
operator|.
name|next
argument_list|()
operator|.
name|toString
argument_list|()
decl_stmt|;
try|try
block|{
name|Driver
name|driver
init|=
operator|(
name|Driver
operator|)
name|Class
operator|.
name|forName
argument_list|(
name|name
argument_list|)
operator|.
name|newInstance
argument_list|()
decl_stmt|;
name|ColorBuffer
name|msg
init|=
name|beeLine
operator|.
name|getColorBuffer
argument_list|()
operator|.
name|pad
argument_list|(
name|driver
operator|.
name|jdbcCompliant
argument_list|()
condition|?
literal|"yes"
else|:
literal|"no"
argument_list|,
literal|10
argument_list|)
operator|.
name|pad
argument_list|(
name|driver
operator|.
name|getMajorVersion
argument_list|()
operator|+
literal|"."
operator|+
name|driver
operator|.
name|getMinorVersion
argument_list|()
argument_list|,
literal|8
argument_list|)
operator|.
name|append
argument_list|(
name|name
argument_list|)
decl_stmt|;
if|if
condition|(
name|driver
operator|.
name|jdbcCompliant
argument_list|()
condition|)
block|{
name|beeLine
operator|.
name|output
argument_list|(
name|msg
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|beeLine
operator|.
name|output
argument_list|(
name|beeLine
operator|.
name|getColorBuffer
argument_list|()
operator|.
name|red
argument_list|(
name|msg
operator|.
name|getMono
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
catch|catch
parameter_list|(
name|Throwable
name|t
parameter_list|)
block|{
name|beeLine
operator|.
name|output
argument_list|(
name|beeLine
operator|.
name|getColorBuffer
argument_list|()
operator|.
name|red
argument_list|(
name|name
argument_list|)
argument_list|)
expr_stmt|;
comment|// error with driver
block|}
block|}
return|return
literal|true
return|;
block|}
specifier|public
name|boolean
name|save
parameter_list|(
name|String
name|line
parameter_list|)
throws|throws
name|IOException
block|{
name|beeLine
operator|.
name|info
argument_list|(
name|beeLine
operator|.
name|loc
argument_list|(
literal|"saving-options"
argument_list|,
name|beeLine
operator|.
name|getOpts
argument_list|()
operator|.
name|getPropertiesFile
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|beeLine
operator|.
name|getOpts
argument_list|()
operator|.
name|save
argument_list|()
expr_stmt|;
return|return
literal|true
return|;
block|}
specifier|public
name|boolean
name|load
parameter_list|(
name|String
name|line
parameter_list|)
throws|throws
name|IOException
block|{
name|beeLine
operator|.
name|getOpts
argument_list|()
operator|.
name|load
argument_list|()
expr_stmt|;
name|beeLine
operator|.
name|info
argument_list|(
name|beeLine
operator|.
name|loc
argument_list|(
literal|"loaded-options"
argument_list|,
name|beeLine
operator|.
name|getOpts
argument_list|()
operator|.
name|getPropertiesFile
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
return|return
literal|true
return|;
block|}
specifier|public
name|boolean
name|config
parameter_list|(
name|String
name|line
parameter_list|)
block|{
try|try
block|{
name|Properties
name|props
init|=
name|beeLine
operator|.
name|getOpts
argument_list|()
operator|.
name|toProperties
argument_list|()
decl_stmt|;
name|Set
name|keys
init|=
operator|new
name|TreeSet
argument_list|(
name|props
operator|.
name|keySet
argument_list|()
argument_list|)
decl_stmt|;
for|for
control|(
name|Iterator
name|i
init|=
name|keys
operator|.
name|iterator
argument_list|()
init|;
name|i
operator|.
name|hasNext
argument_list|()
condition|;
control|)
block|{
name|String
name|key
init|=
operator|(
name|String
operator|)
name|i
operator|.
name|next
argument_list|()
decl_stmt|;
name|beeLine
operator|.
name|output
argument_list|(
name|beeLine
operator|.
name|getColorBuffer
argument_list|()
operator|.
name|green
argument_list|(
name|beeLine
operator|.
name|getColorBuffer
argument_list|()
operator|.
name|pad
argument_list|(
name|key
operator|.
name|substring
argument_list|(
name|beeLine
operator|.
name|getOpts
argument_list|()
operator|.
name|PROPERTY_PREFIX
operator|.
name|length
argument_list|()
argument_list|)
argument_list|,
literal|20
argument_list|)
operator|.
name|getMono
argument_list|()
argument_list|)
operator|.
name|append
argument_list|(
name|props
operator|.
name|getProperty
argument_list|(
name|key
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
catch|catch
parameter_list|(
name|Exception
name|e
parameter_list|)
block|{
return|return
name|beeLine
operator|.
name|error
argument_list|(
name|e
argument_list|)
return|;
block|}
return|return
literal|true
return|;
block|}
specifier|public
name|boolean
name|set
parameter_list|(
name|String
name|line
parameter_list|)
block|{
if|if
condition|(
name|line
operator|==
literal|null
operator|||
name|line
operator|.
name|trim
argument_list|()
operator|.
name|equals
argument_list|(
literal|"set"
argument_list|)
operator|||
name|line
operator|.
name|length
argument_list|()
operator|==
literal|0
condition|)
block|{
return|return
name|config
argument_list|(
literal|null
argument_list|)
return|;
block|}
name|String
index|[]
name|parts
init|=
name|beeLine
operator|.
name|split
argument_list|(
name|line
argument_list|,
literal|3
argument_list|,
literal|"Usage: set<key><value>"
argument_list|)
decl_stmt|;
if|if
condition|(
name|parts
operator|==
literal|null
condition|)
block|{
return|return
literal|false
return|;
block|}
name|String
name|key
init|=
name|parts
index|[
literal|1
index|]
decl_stmt|;
name|String
name|value
init|=
name|parts
index|[
literal|2
index|]
decl_stmt|;
name|boolean
name|success
init|=
name|beeLine
operator|.
name|getOpts
argument_list|()
operator|.
name|set
argument_list|(
name|key
argument_list|,
name|value
argument_list|,
literal|false
argument_list|)
decl_stmt|;
comment|// if we autosave, then save
if|if
condition|(
name|success
operator|&&
name|beeLine
operator|.
name|getOpts
argument_list|()
operator|.
name|getAutosave
argument_list|()
condition|)
block|{
try|try
block|{
name|beeLine
operator|.
name|getOpts
argument_list|()
operator|.
name|save
argument_list|()
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|Exception
name|saveException
parameter_list|)
block|{       }
block|}
return|return
name|success
return|;
block|}
specifier|public
name|boolean
name|commit
parameter_list|(
name|String
name|line
parameter_list|)
throws|throws
name|SQLException
block|{
if|if
condition|(
operator|!
operator|(
name|beeLine
operator|.
name|assertConnection
argument_list|()
operator|)
condition|)
block|{
return|return
literal|false
return|;
block|}
if|if
condition|(
operator|!
operator|(
name|beeLine
operator|.
name|assertAutoCommit
argument_list|()
operator|)
condition|)
block|{
return|return
literal|false
return|;
block|}
try|try
block|{
name|long
name|start
init|=
name|System
operator|.
name|currentTimeMillis
argument_list|()
decl_stmt|;
name|beeLine
operator|.
name|getDatabaseConnection
argument_list|()
operator|.
name|getConnection
argument_list|()
operator|.
name|commit
argument_list|()
expr_stmt|;
name|long
name|end
init|=
name|System
operator|.
name|currentTimeMillis
argument_list|()
decl_stmt|;
name|beeLine
operator|.
name|showWarnings
argument_list|()
expr_stmt|;
name|beeLine
operator|.
name|info
argument_list|(
name|beeLine
operator|.
name|loc
argument_list|(
literal|"commit-complete"
argument_list|)
operator|+
literal|" "
operator|+
name|beeLine
operator|.
name|locElapsedTime
argument_list|(
name|end
operator|-
name|start
argument_list|)
argument_list|)
expr_stmt|;
return|return
literal|true
return|;
block|}
catch|catch
parameter_list|(
name|Exception
name|e
parameter_list|)
block|{
return|return
name|beeLine
operator|.
name|error
argument_list|(
name|e
argument_list|)
return|;
block|}
block|}
specifier|public
name|boolean
name|rollback
parameter_list|(
name|String
name|line
parameter_list|)
throws|throws
name|SQLException
block|{
if|if
condition|(
operator|!
operator|(
name|beeLine
operator|.
name|assertConnection
argument_list|()
operator|)
condition|)
block|{
return|return
literal|false
return|;
block|}
if|if
condition|(
operator|!
operator|(
name|beeLine
operator|.
name|assertAutoCommit
argument_list|()
operator|)
condition|)
block|{
return|return
literal|false
return|;
block|}
try|try
block|{
name|long
name|start
init|=
name|System
operator|.
name|currentTimeMillis
argument_list|()
decl_stmt|;
name|beeLine
operator|.
name|getDatabaseConnection
argument_list|()
operator|.
name|getConnection
argument_list|()
operator|.
name|rollback
argument_list|()
expr_stmt|;
name|long
name|end
init|=
name|System
operator|.
name|currentTimeMillis
argument_list|()
decl_stmt|;
name|beeLine
operator|.
name|showWarnings
argument_list|()
expr_stmt|;
name|beeLine
operator|.
name|info
argument_list|(
name|beeLine
operator|.
name|loc
argument_list|(
literal|"rollback-complete"
argument_list|)
operator|+
literal|" "
operator|+
name|beeLine
operator|.
name|locElapsedTime
argument_list|(
name|end
operator|-
name|start
argument_list|)
argument_list|)
expr_stmt|;
return|return
literal|true
return|;
block|}
catch|catch
parameter_list|(
name|Exception
name|e
parameter_list|)
block|{
return|return
name|beeLine
operator|.
name|error
argument_list|(
name|e
argument_list|)
return|;
block|}
block|}
specifier|public
name|boolean
name|autocommit
parameter_list|(
name|String
name|line
parameter_list|)
throws|throws
name|SQLException
block|{
if|if
condition|(
operator|!
operator|(
name|beeLine
operator|.
name|assertConnection
argument_list|()
operator|)
condition|)
block|{
return|return
literal|false
return|;
block|}
if|if
condition|(
name|line
operator|.
name|endsWith
argument_list|(
literal|"on"
argument_list|)
condition|)
block|{
name|beeLine
operator|.
name|getDatabaseConnection
argument_list|()
operator|.
name|getConnection
argument_list|()
operator|.
name|setAutoCommit
argument_list|(
literal|true
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|line
operator|.
name|endsWith
argument_list|(
literal|"off"
argument_list|)
condition|)
block|{
name|beeLine
operator|.
name|getDatabaseConnection
argument_list|()
operator|.
name|getConnection
argument_list|()
operator|.
name|setAutoCommit
argument_list|(
literal|false
argument_list|)
expr_stmt|;
block|}
name|beeLine
operator|.
name|showWarnings
argument_list|()
expr_stmt|;
name|beeLine
operator|.
name|autocommitStatus
argument_list|(
name|beeLine
operator|.
name|getDatabaseConnection
argument_list|()
operator|.
name|getConnection
argument_list|()
argument_list|)
expr_stmt|;
return|return
literal|true
return|;
block|}
specifier|public
name|boolean
name|dbinfo
parameter_list|(
name|String
name|line
parameter_list|)
block|{
if|if
condition|(
operator|!
operator|(
name|beeLine
operator|.
name|assertConnection
argument_list|()
operator|)
condition|)
block|{
return|return
literal|false
return|;
block|}
name|beeLine
operator|.
name|showWarnings
argument_list|()
expr_stmt|;
name|int
name|padlen
init|=
literal|50
decl_stmt|;
name|String
index|[]
name|m
init|=
operator|new
name|String
index|[]
block|{
literal|"allProceduresAreCallable"
block|,
literal|"allTablesAreSelectable"
block|,
literal|"dataDefinitionCausesTransactionCommit"
block|,
literal|"dataDefinitionIgnoredInTransactions"
block|,
literal|"doesMaxRowSizeIncludeBlobs"
block|,
literal|"getCatalogSeparator"
block|,
literal|"getCatalogTerm"
block|,
literal|"getDatabaseProductName"
block|,
literal|"getDatabaseProductVersion"
block|,
literal|"getDefaultTransactionIsolation"
block|,
literal|"getDriverMajorVersion"
block|,
literal|"getDriverMinorVersion"
block|,
literal|"getDriverName"
block|,
literal|"getDriverVersion"
block|,
literal|"getExtraNameCharacters"
block|,
literal|"getIdentifierQuoteString"
block|,
literal|"getMaxBinaryLiteralLength"
block|,
literal|"getMaxCatalogNameLength"
block|,
literal|"getMaxCharLiteralLength"
block|,
literal|"getMaxColumnNameLength"
block|,
literal|"getMaxColumnsInGroupBy"
block|,
literal|"getMaxColumnsInIndex"
block|,
literal|"getMaxColumnsInOrderBy"
block|,
literal|"getMaxColumnsInSelect"
block|,
literal|"getMaxColumnsInTable"
block|,
literal|"getMaxConnections"
block|,
literal|"getMaxCursorNameLength"
block|,
literal|"getMaxIndexLength"
block|,
literal|"getMaxProcedureNameLength"
block|,
literal|"getMaxRowSize"
block|,
literal|"getMaxSchemaNameLength"
block|,
literal|"getMaxStatementLength"
block|,
literal|"getMaxStatements"
block|,
literal|"getMaxTableNameLength"
block|,
literal|"getMaxTablesInSelect"
block|,
literal|"getMaxUserNameLength"
block|,
literal|"getNumericFunctions"
block|,
literal|"getProcedureTerm"
block|,
literal|"getSchemaTerm"
block|,
literal|"getSearchStringEscape"
block|,
literal|"getSQLKeywords"
block|,
literal|"getStringFunctions"
block|,
literal|"getSystemFunctions"
block|,
literal|"getTimeDateFunctions"
block|,
literal|"getURL"
block|,
literal|"getUserName"
block|,
literal|"isCatalogAtStart"
block|,
literal|"isReadOnly"
block|,
literal|"nullPlusNonNullIsNull"
block|,
literal|"nullsAreSortedAtEnd"
block|,
literal|"nullsAreSortedAtStart"
block|,
literal|"nullsAreSortedHigh"
block|,
literal|"nullsAreSortedLow"
block|,
literal|"storesLowerCaseIdentifiers"
block|,
literal|"storesLowerCaseQuotedIdentifiers"
block|,
literal|"storesMixedCaseIdentifiers"
block|,
literal|"storesMixedCaseQuotedIdentifiers"
block|,
literal|"storesUpperCaseIdentifiers"
block|,
literal|"storesUpperCaseQuotedIdentifiers"
block|,
literal|"supportsAlterTableWithAddColumn"
block|,
literal|"supportsAlterTableWithDropColumn"
block|,
literal|"supportsANSI92EntryLevelSQL"
block|,
literal|"supportsANSI92FullSQL"
block|,
literal|"supportsANSI92IntermediateSQL"
block|,
literal|"supportsBatchUpdates"
block|,
literal|"supportsCatalogsInDataManipulation"
block|,
literal|"supportsCatalogsInIndexDefinitions"
block|,
literal|"supportsCatalogsInPrivilegeDefinitions"
block|,
literal|"supportsCatalogsInProcedureCalls"
block|,
literal|"supportsCatalogsInTableDefinitions"
block|,
literal|"supportsColumnAliasing"
block|,
literal|"supportsConvert"
block|,
literal|"supportsCoreSQLGrammar"
block|,
literal|"supportsCorrelatedSubqueries"
block|,
literal|"supportsDataDefinitionAndDataManipulationTransactions"
block|,
literal|"supportsDataManipulationTransactionsOnly"
block|,
literal|"supportsDifferentTableCorrelationNames"
block|,
literal|"supportsExpressionsInOrderBy"
block|,
literal|"supportsExtendedSQLGrammar"
block|,
literal|"supportsFullOuterJoins"
block|,
literal|"supportsGroupBy"
block|,
literal|"supportsGroupByBeyondSelect"
block|,
literal|"supportsGroupByUnrelated"
block|,
literal|"supportsIntegrityEnhancementFacility"
block|,
literal|"supportsLikeEscapeClause"
block|,
literal|"supportsLimitedOuterJoins"
block|,
literal|"supportsMinimumSQLGrammar"
block|,
literal|"supportsMixedCaseIdentifiers"
block|,
literal|"supportsMixedCaseQuotedIdentifiers"
block|,
literal|"supportsMultipleResultSets"
block|,
literal|"supportsMultipleTransactions"
block|,
literal|"supportsNonNullableColumns"
block|,
literal|"supportsOpenCursorsAcrossCommit"
block|,
literal|"supportsOpenCursorsAcrossRollback"
block|,
literal|"supportsOpenStatementsAcrossCommit"
block|,
literal|"supportsOpenStatementsAcrossRollback"
block|,
literal|"supportsOrderByUnrelated"
block|,
literal|"supportsOuterJoins"
block|,
literal|"supportsPositionedDelete"
block|,
literal|"supportsPositionedUpdate"
block|,
literal|"supportsSchemasInDataManipulation"
block|,
literal|"supportsSchemasInIndexDefinitions"
block|,
literal|"supportsSchemasInPrivilegeDefinitions"
block|,
literal|"supportsSchemasInProcedureCalls"
block|,
literal|"supportsSchemasInTableDefinitions"
block|,
literal|"supportsSelectForUpdate"
block|,
literal|"supportsStoredProcedures"
block|,
literal|"supportsSubqueriesInComparisons"
block|,
literal|"supportsSubqueriesInExists"
block|,
literal|"supportsSubqueriesInIns"
block|,
literal|"supportsSubqueriesInQuantifieds"
block|,
literal|"supportsTableCorrelationNames"
block|,
literal|"supportsTransactions"
block|,
literal|"supportsUnion"
block|,
literal|"supportsUnionAll"
block|,
literal|"usesLocalFilePerTable"
block|,
literal|"usesLocalFiles"
block|,     }
decl_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|m
operator|.
name|length
condition|;
name|i
operator|++
control|)
block|{
try|try
block|{
name|beeLine
operator|.
name|output
argument_list|(
name|beeLine
operator|.
name|getColorBuffer
argument_list|()
operator|.
name|pad
argument_list|(
name|m
index|[
name|i
index|]
argument_list|,
name|padlen
argument_list|)
operator|.
name|append
argument_list|(
literal|""
operator|+
name|beeLine
operator|.
name|getReflector
argument_list|()
operator|.
name|invoke
argument_list|(
name|beeLine
operator|.
name|getDatabaseMetaData
argument_list|()
argument_list|,
name|m
index|[
name|i
index|]
argument_list|,
operator|new
name|Object
index|[
literal|0
index|]
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|Exception
name|e
parameter_list|)
block|{
name|beeLine
operator|.
name|handleException
argument_list|(
name|e
argument_list|)
expr_stmt|;
block|}
block|}
return|return
literal|true
return|;
block|}
specifier|public
name|boolean
name|verbose
parameter_list|(
name|String
name|line
parameter_list|)
block|{
name|beeLine
operator|.
name|info
argument_list|(
literal|"verbose: on"
argument_list|)
expr_stmt|;
return|return
name|set
argument_list|(
literal|"set verbose true"
argument_list|)
return|;
block|}
specifier|public
name|boolean
name|outputformat
parameter_list|(
name|String
name|line
parameter_list|)
block|{
return|return
name|set
argument_list|(
literal|"set "
operator|+
name|line
argument_list|)
return|;
block|}
specifier|public
name|boolean
name|brief
parameter_list|(
name|String
name|line
parameter_list|)
block|{
name|beeLine
operator|.
name|info
argument_list|(
literal|"verbose: off"
argument_list|)
expr_stmt|;
return|return
name|set
argument_list|(
literal|"set verbose false"
argument_list|)
return|;
block|}
specifier|public
name|boolean
name|isolation
parameter_list|(
name|String
name|line
parameter_list|)
throws|throws
name|SQLException
block|{
if|if
condition|(
operator|!
operator|(
name|beeLine
operator|.
name|assertConnection
argument_list|()
operator|)
condition|)
block|{
return|return
literal|false
return|;
block|}
name|int
name|i
decl_stmt|;
if|if
condition|(
name|line
operator|.
name|endsWith
argument_list|(
literal|"TRANSACTION_NONE"
argument_list|)
condition|)
block|{
name|i
operator|=
name|Connection
operator|.
name|TRANSACTION_NONE
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|line
operator|.
name|endsWith
argument_list|(
literal|"TRANSACTION_READ_COMMITTED"
argument_list|)
condition|)
block|{
name|i
operator|=
name|Connection
operator|.
name|TRANSACTION_READ_COMMITTED
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|line
operator|.
name|endsWith
argument_list|(
literal|"TRANSACTION_READ_UNCOMMITTED"
argument_list|)
condition|)
block|{
name|i
operator|=
name|Connection
operator|.
name|TRANSACTION_READ_UNCOMMITTED
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|line
operator|.
name|endsWith
argument_list|(
literal|"TRANSACTION_REPEATABLE_READ"
argument_list|)
condition|)
block|{
name|i
operator|=
name|Connection
operator|.
name|TRANSACTION_REPEATABLE_READ
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|line
operator|.
name|endsWith
argument_list|(
literal|"TRANSACTION_SERIALIZABLE"
argument_list|)
condition|)
block|{
name|i
operator|=
name|Connection
operator|.
name|TRANSACTION_SERIALIZABLE
expr_stmt|;
block|}
else|else
block|{
return|return
name|beeLine
operator|.
name|error
argument_list|(
literal|"Usage: isolation<TRANSACTION_NONE "
operator|+
literal|"| TRANSACTION_READ_COMMITTED "
operator|+
literal|"| TRANSACTION_READ_UNCOMMITTED "
operator|+
literal|"| TRANSACTION_REPEATABLE_READ "
operator|+
literal|"| TRANSACTION_SERIALIZABLE>"
argument_list|)
return|;
block|}
name|beeLine
operator|.
name|getDatabaseConnection
argument_list|()
operator|.
name|getConnection
argument_list|()
operator|.
name|setTransactionIsolation
argument_list|(
name|i
argument_list|)
expr_stmt|;
name|int
name|isol
init|=
name|beeLine
operator|.
name|getDatabaseConnection
argument_list|()
operator|.
name|getConnection
argument_list|()
operator|.
name|getTransactionIsolation
argument_list|()
decl_stmt|;
specifier|final
name|String
name|isoldesc
decl_stmt|;
switch|switch
condition|(
name|i
condition|)
block|{
case|case
name|Connection
operator|.
name|TRANSACTION_NONE
case|:
name|isoldesc
operator|=
literal|"TRANSACTION_NONE"
expr_stmt|;
break|break;
case|case
name|Connection
operator|.
name|TRANSACTION_READ_COMMITTED
case|:
name|isoldesc
operator|=
literal|"TRANSACTION_READ_COMMITTED"
expr_stmt|;
break|break;
case|case
name|Connection
operator|.
name|TRANSACTION_READ_UNCOMMITTED
case|:
name|isoldesc
operator|=
literal|"TRANSACTION_READ_UNCOMMITTED"
expr_stmt|;
break|break;
case|case
name|Connection
operator|.
name|TRANSACTION_REPEATABLE_READ
case|:
name|isoldesc
operator|=
literal|"TRANSACTION_REPEATABLE_READ"
expr_stmt|;
break|break;
case|case
name|Connection
operator|.
name|TRANSACTION_SERIALIZABLE
case|:
name|isoldesc
operator|=
literal|"TRANSACTION_SERIALIZABLE"
expr_stmt|;
break|break;
default|default:
name|isoldesc
operator|=
literal|"UNKNOWN"
expr_stmt|;
block|}
name|beeLine
operator|.
name|info
argument_list|(
name|beeLine
operator|.
name|loc
argument_list|(
literal|"isolation-status"
argument_list|,
name|isoldesc
argument_list|)
argument_list|)
expr_stmt|;
return|return
literal|true
return|;
block|}
specifier|public
name|boolean
name|batch
parameter_list|(
name|String
name|line
parameter_list|)
block|{
if|if
condition|(
operator|!
operator|(
name|beeLine
operator|.
name|assertConnection
argument_list|()
operator|)
condition|)
block|{
return|return
literal|false
return|;
block|}
if|if
condition|(
name|beeLine
operator|.
name|getBatch
argument_list|()
operator|==
literal|null
condition|)
block|{
name|beeLine
operator|.
name|setBatch
argument_list|(
operator|new
name|LinkedList
argument_list|<
name|String
argument_list|>
argument_list|()
argument_list|)
expr_stmt|;
name|beeLine
operator|.
name|info
argument_list|(
name|beeLine
operator|.
name|loc
argument_list|(
literal|"batch-start"
argument_list|)
argument_list|)
expr_stmt|;
return|return
literal|true
return|;
block|}
else|else
block|{
name|beeLine
operator|.
name|info
argument_list|(
name|beeLine
operator|.
name|loc
argument_list|(
literal|"running-batch"
argument_list|)
argument_list|)
expr_stmt|;
try|try
block|{
name|beeLine
operator|.
name|runBatch
argument_list|(
name|beeLine
operator|.
name|getBatch
argument_list|()
argument_list|)
expr_stmt|;
return|return
literal|true
return|;
block|}
catch|catch
parameter_list|(
name|Exception
name|e
parameter_list|)
block|{
return|return
name|beeLine
operator|.
name|error
argument_list|(
name|e
argument_list|)
return|;
block|}
finally|finally
block|{
name|beeLine
operator|.
name|setBatch
argument_list|(
literal|null
argument_list|)
expr_stmt|;
block|}
block|}
block|}
specifier|public
name|boolean
name|sql
parameter_list|(
name|String
name|line
parameter_list|)
block|{
return|return
name|execute
argument_list|(
name|line
argument_list|,
literal|false
argument_list|)
return|;
block|}
specifier|public
name|boolean
name|call
parameter_list|(
name|String
name|line
parameter_list|)
block|{
return|return
name|execute
argument_list|(
name|line
argument_list|,
literal|true
argument_list|)
return|;
block|}
specifier|private
name|boolean
name|execute
parameter_list|(
name|String
name|line
parameter_list|,
name|boolean
name|call
parameter_list|)
block|{
if|if
condition|(
name|line
operator|==
literal|null
operator|||
name|line
operator|.
name|length
argument_list|()
operator|==
literal|0
condition|)
block|{
return|return
literal|false
return|;
comment|// ???
block|}
comment|// ### FIXME: doing the multi-line handling down here means
comment|// higher-level logic never sees the extra lines. So,
comment|// for example, if a script is being saved, it won't include
comment|// the continuation lines! This is logged as sf.net
comment|// bug 879518.
comment|// use multiple lines for statements not terminated by ";"
try|try
block|{
while|while
condition|(
operator|!
operator|(
name|line
operator|.
name|trim
argument_list|()
operator|.
name|endsWith
argument_list|(
literal|";"
argument_list|)
operator|)
operator|&&
name|beeLine
operator|.
name|getOpts
argument_list|()
operator|.
name|isAllowMultiLineCommand
argument_list|()
condition|)
block|{
name|StringBuilder
name|prompt
init|=
operator|new
name|StringBuilder
argument_list|(
name|beeLine
operator|.
name|getPrompt
argument_list|()
argument_list|)
decl_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|prompt
operator|.
name|length
argument_list|()
operator|-
literal|1
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|prompt
operator|.
name|charAt
argument_list|(
name|i
argument_list|)
operator|!=
literal|'>'
condition|)
block|{
name|prompt
operator|.
name|setCharAt
argument_list|(
name|i
argument_list|,
name|i
operator|%
literal|2
operator|==
literal|0
condition|?
literal|'.'
else|:
literal|' '
argument_list|)
expr_stmt|;
block|}
block|}
name|String
name|extra
init|=
name|beeLine
operator|.
name|getConsoleReader
argument_list|()
operator|.
name|readLine
argument_list|(
name|prompt
operator|.
name|toString
argument_list|()
argument_list|)
decl_stmt|;
if|if
condition|(
operator|!
name|beeLine
operator|.
name|isComment
argument_list|(
name|extra
argument_list|)
condition|)
block|{
name|line
operator|+=
literal|" "
operator|+
name|extra
expr_stmt|;
block|}
block|}
block|}
catch|catch
parameter_list|(
name|Exception
name|e
parameter_list|)
block|{
name|beeLine
operator|.
name|handleException
argument_list|(
name|e
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|line
operator|.
name|endsWith
argument_list|(
literal|";"
argument_list|)
condition|)
block|{
name|line
operator|=
name|line
operator|.
name|substring
argument_list|(
literal|0
argument_list|,
name|line
operator|.
name|length
argument_list|()
operator|-
literal|1
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|!
operator|(
name|beeLine
operator|.
name|assertConnection
argument_list|()
operator|)
condition|)
block|{
return|return
literal|false
return|;
block|}
name|String
name|sql
init|=
name|line
decl_stmt|;
if|if
condition|(
name|sql
operator|.
name|startsWith
argument_list|(
name|BeeLine
operator|.
name|COMMAND_PREFIX
argument_list|)
condition|)
block|{
name|sql
operator|=
name|sql
operator|.
name|substring
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
name|String
name|prefix
init|=
name|call
condition|?
literal|"call"
else|:
literal|"sql"
decl_stmt|;
if|if
condition|(
name|sql
operator|.
name|startsWith
argument_list|(
name|prefix
argument_list|)
condition|)
block|{
name|sql
operator|=
name|sql
operator|.
name|substring
argument_list|(
name|prefix
operator|.
name|length
argument_list|()
argument_list|)
expr_stmt|;
block|}
comment|// batch statements?
if|if
condition|(
name|beeLine
operator|.
name|getBatch
argument_list|()
operator|!=
literal|null
condition|)
block|{
name|beeLine
operator|.
name|getBatch
argument_list|()
operator|.
name|add
argument_list|(
name|sql
argument_list|)
expr_stmt|;
return|return
literal|true
return|;
block|}
try|try
block|{
name|Statement
name|stmnt
init|=
literal|null
decl_stmt|;
name|boolean
name|hasResults
decl_stmt|;
try|try
block|{
name|long
name|start
init|=
name|System
operator|.
name|currentTimeMillis
argument_list|()
decl_stmt|;
if|if
condition|(
name|call
condition|)
block|{
name|stmnt
operator|=
name|beeLine
operator|.
name|getDatabaseConnection
argument_list|()
operator|.
name|getConnection
argument_list|()
operator|.
name|prepareCall
argument_list|(
name|sql
argument_list|)
expr_stmt|;
name|hasResults
operator|=
operator|(
operator|(
name|CallableStatement
operator|)
name|stmnt
operator|)
operator|.
name|execute
argument_list|()
expr_stmt|;
block|}
else|else
block|{
name|stmnt
operator|=
name|beeLine
operator|.
name|createStatement
argument_list|()
expr_stmt|;
name|hasResults
operator|=
name|stmnt
operator|.
name|execute
argument_list|(
name|sql
argument_list|)
expr_stmt|;
block|}
name|beeLine
operator|.
name|showWarnings
argument_list|()
expr_stmt|;
if|if
condition|(
name|hasResults
condition|)
block|{
do|do
block|{
name|ResultSet
name|rs
init|=
name|stmnt
operator|.
name|getResultSet
argument_list|()
decl_stmt|;
try|try
block|{
name|int
name|count
init|=
name|beeLine
operator|.
name|print
argument_list|(
name|rs
argument_list|)
decl_stmt|;
name|long
name|end
init|=
name|System
operator|.
name|currentTimeMillis
argument_list|()
decl_stmt|;
name|beeLine
operator|.
name|info
argument_list|(
name|beeLine
operator|.
name|loc
argument_list|(
literal|"rows-selected"
argument_list|,
name|count
argument_list|)
operator|+
literal|" "
operator|+
name|beeLine
operator|.
name|locElapsedTime
argument_list|(
name|end
operator|-
name|start
argument_list|)
argument_list|)
expr_stmt|;
block|}
finally|finally
block|{
name|rs
operator|.
name|close
argument_list|()
expr_stmt|;
block|}
block|}
do|while
condition|(
name|BeeLine
operator|.
name|getMoreResults
argument_list|(
name|stmnt
argument_list|)
condition|)
do|;
block|}
else|else
block|{
name|int
name|count
init|=
name|stmnt
operator|.
name|getUpdateCount
argument_list|()
decl_stmt|;
name|long
name|end
init|=
name|System
operator|.
name|currentTimeMillis
argument_list|()
decl_stmt|;
name|beeLine
operator|.
name|info
argument_list|(
name|beeLine
operator|.
name|loc
argument_list|(
literal|"rows-affected"
argument_list|,
name|count
argument_list|)
operator|+
literal|" "
operator|+
name|beeLine
operator|.
name|locElapsedTime
argument_list|(
name|end
operator|-
name|start
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
finally|finally
block|{
if|if
condition|(
name|stmnt
operator|!=
literal|null
condition|)
block|{
name|stmnt
operator|.
name|close
argument_list|()
expr_stmt|;
block|}
block|}
block|}
catch|catch
parameter_list|(
name|Exception
name|e
parameter_list|)
block|{
return|return
name|beeLine
operator|.
name|error
argument_list|(
name|e
argument_list|)
return|;
block|}
name|beeLine
operator|.
name|showWarnings
argument_list|()
expr_stmt|;
return|return
literal|true
return|;
block|}
specifier|public
name|boolean
name|quit
parameter_list|(
name|String
name|line
parameter_list|)
block|{
name|beeLine
operator|.
name|setExit
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|close
argument_list|(
literal|null
argument_list|)
expr_stmt|;
return|return
literal|true
return|;
block|}
comment|/**    * Close all connections.    */
specifier|public
name|boolean
name|closeall
parameter_list|(
name|String
name|line
parameter_list|)
block|{
if|if
condition|(
name|close
argument_list|(
literal|null
argument_list|)
condition|)
block|{
while|while
condition|(
name|close
argument_list|(
literal|null
argument_list|)
condition|)
block|{
empty_stmt|;
block|}
return|return
literal|true
return|;
block|}
return|return
literal|false
return|;
block|}
comment|/**    * Close the current connection.    */
specifier|public
name|boolean
name|close
parameter_list|(
name|String
name|line
parameter_list|)
block|{
if|if
condition|(
name|beeLine
operator|.
name|getDatabaseConnection
argument_list|()
operator|==
literal|null
condition|)
block|{
return|return
literal|false
return|;
block|}
try|try
block|{
if|if
condition|(
name|beeLine
operator|.
name|getDatabaseConnection
argument_list|()
operator|.
name|getConnection
argument_list|()
operator|!=
literal|null
operator|&&
operator|!
operator|(
name|beeLine
operator|.
name|getDatabaseConnection
argument_list|()
operator|.
name|getConnection
argument_list|()
operator|.
name|isClosed
argument_list|()
operator|)
condition|)
block|{
name|beeLine
operator|.
name|info
argument_list|(
name|beeLine
operator|.
name|loc
argument_list|(
literal|"closing"
argument_list|,
name|beeLine
operator|.
name|getDatabaseConnection
argument_list|()
operator|.
name|getConnection
argument_list|()
operator|.
name|getClass
argument_list|()
operator|.
name|getName
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|beeLine
operator|.
name|getDatabaseConnection
argument_list|()
operator|.
name|getConnection
argument_list|()
operator|.
name|close
argument_list|()
expr_stmt|;
block|}
else|else
block|{
name|beeLine
operator|.
name|info
argument_list|(
name|beeLine
operator|.
name|loc
argument_list|(
literal|"already-closed"
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
catch|catch
parameter_list|(
name|Exception
name|e
parameter_list|)
block|{
return|return
name|beeLine
operator|.
name|error
argument_list|(
name|e
argument_list|)
return|;
block|}
name|beeLine
operator|.
name|getDatabaseConnections
argument_list|()
operator|.
name|remove
argument_list|()
expr_stmt|;
return|return
literal|true
return|;
block|}
comment|/**    * Connect to the database defined in the specified properties file.    */
specifier|public
name|boolean
name|properties
parameter_list|(
name|String
name|line
parameter_list|)
throws|throws
name|Exception
block|{
name|String
name|example
init|=
literal|""
decl_stmt|;
name|example
operator|+=
literal|"Usage: properties<properties file>"
operator|+
name|BeeLine
operator|.
name|getSeparator
argument_list|()
expr_stmt|;
name|String
index|[]
name|parts
init|=
name|beeLine
operator|.
name|split
argument_list|(
name|line
argument_list|)
decl_stmt|;
if|if
condition|(
name|parts
operator|.
name|length
operator|<
literal|2
condition|)
block|{
return|return
name|beeLine
operator|.
name|error
argument_list|(
name|example
argument_list|)
return|;
block|}
name|int
name|successes
init|=
literal|0
decl_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|1
init|;
name|i
operator|<
name|parts
operator|.
name|length
condition|;
name|i
operator|++
control|)
block|{
name|Properties
name|props
init|=
operator|new
name|Properties
argument_list|()
decl_stmt|;
name|props
operator|.
name|load
argument_list|(
operator|new
name|FileInputStream
argument_list|(
name|parts
index|[
name|i
index|]
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|connect
argument_list|(
name|props
argument_list|)
condition|)
block|{
name|successes
operator|++
expr_stmt|;
block|}
block|}
if|if
condition|(
name|successes
operator|!=
operator|(
name|parts
operator|.
name|length
operator|-
literal|1
operator|)
condition|)
block|{
return|return
literal|false
return|;
block|}
else|else
block|{
return|return
literal|true
return|;
block|}
block|}
specifier|public
name|boolean
name|connect
parameter_list|(
name|String
name|line
parameter_list|)
throws|throws
name|Exception
block|{
name|String
name|example
init|=
literal|"Usage: connect<url><username><password> [driver]"
operator|+
name|BeeLine
operator|.
name|getSeparator
argument_list|()
decl_stmt|;
name|String
index|[]
name|parts
init|=
name|beeLine
operator|.
name|split
argument_list|(
name|line
argument_list|)
decl_stmt|;
if|if
condition|(
name|parts
operator|==
literal|null
condition|)
block|{
return|return
literal|false
return|;
block|}
if|if
condition|(
name|parts
operator|.
name|length
operator|<
literal|2
condition|)
block|{
return|return
name|beeLine
operator|.
name|error
argument_list|(
name|example
argument_list|)
return|;
block|}
name|String
name|url
init|=
name|parts
operator|.
name|length
operator|<
literal|2
condition|?
literal|null
else|:
name|parts
index|[
literal|1
index|]
decl_stmt|;
name|String
name|user
init|=
name|parts
operator|.
name|length
operator|<
literal|3
condition|?
literal|null
else|:
name|parts
index|[
literal|2
index|]
decl_stmt|;
name|String
name|pass
init|=
name|parts
operator|.
name|length
operator|<
literal|4
condition|?
literal|null
else|:
name|parts
index|[
literal|3
index|]
decl_stmt|;
name|String
name|driver
init|=
name|parts
operator|.
name|length
operator|<
literal|5
condition|?
literal|null
else|:
name|parts
index|[
literal|4
index|]
decl_stmt|;
name|Properties
name|props
init|=
operator|new
name|Properties
argument_list|()
decl_stmt|;
if|if
condition|(
name|url
operator|!=
literal|null
condition|)
block|{
name|props
operator|.
name|setProperty
argument_list|(
literal|"url"
argument_list|,
name|url
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|driver
operator|!=
literal|null
condition|)
block|{
name|props
operator|.
name|setProperty
argument_list|(
literal|"driver"
argument_list|,
name|driver
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|user
operator|!=
literal|null
condition|)
block|{
name|props
operator|.
name|setProperty
argument_list|(
literal|"user"
argument_list|,
name|user
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|pass
operator|!=
literal|null
condition|)
block|{
name|props
operator|.
name|setProperty
argument_list|(
literal|"password"
argument_list|,
name|pass
argument_list|)
expr_stmt|;
block|}
return|return
name|connect
argument_list|(
name|props
argument_list|)
return|;
block|}
specifier|private
name|String
name|getProperty
parameter_list|(
name|Properties
name|props
parameter_list|,
name|String
index|[]
name|keys
parameter_list|)
block|{
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|keys
operator|.
name|length
condition|;
name|i
operator|++
control|)
block|{
name|String
name|val
init|=
name|props
operator|.
name|getProperty
argument_list|(
name|keys
index|[
name|i
index|]
argument_list|)
decl_stmt|;
if|if
condition|(
name|val
operator|!=
literal|null
condition|)
block|{
return|return
name|val
return|;
block|}
block|}
for|for
control|(
name|Iterator
name|i
init|=
name|props
operator|.
name|keySet
argument_list|()
operator|.
name|iterator
argument_list|()
init|;
name|i
operator|.
name|hasNext
argument_list|()
condition|;
control|)
block|{
name|String
name|key
init|=
operator|(
name|String
operator|)
name|i
operator|.
name|next
argument_list|()
decl_stmt|;
for|for
control|(
name|int
name|j
init|=
literal|0
init|;
name|j
operator|<
name|keys
operator|.
name|length
condition|;
name|j
operator|++
control|)
block|{
if|if
condition|(
name|key
operator|.
name|endsWith
argument_list|(
name|keys
index|[
name|j
index|]
argument_list|)
condition|)
block|{
return|return
name|props
operator|.
name|getProperty
argument_list|(
name|key
argument_list|)
return|;
block|}
block|}
block|}
return|return
literal|null
return|;
block|}
specifier|public
name|boolean
name|connect
parameter_list|(
name|Properties
name|props
parameter_list|)
throws|throws
name|IOException
block|{
name|String
name|url
init|=
name|getProperty
argument_list|(
name|props
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"url"
block|,
literal|"javax.jdo.option.ConnectionURL"
block|,
literal|"ConnectionURL"
block|,     }
argument_list|)
decl_stmt|;
name|String
name|driver
init|=
name|getProperty
argument_list|(
name|props
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"driver"
block|,
literal|"javax.jdo.option.ConnectionDriverName"
block|,
literal|"ConnectionDriverName"
block|,     }
argument_list|)
decl_stmt|;
name|String
name|username
init|=
name|getProperty
argument_list|(
name|props
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"user"
block|,
literal|"javax.jdo.option.ConnectionUserName"
block|,
literal|"ConnectionUserName"
block|,     }
argument_list|)
decl_stmt|;
name|String
name|password
init|=
name|getProperty
argument_list|(
name|props
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"password"
block|,
literal|"javax.jdo.option.ConnectionPassword"
block|,
literal|"ConnectionPassword"
block|,     }
argument_list|)
decl_stmt|;
if|if
condition|(
name|url
operator|==
literal|null
operator|||
name|url
operator|.
name|length
argument_list|()
operator|==
literal|0
condition|)
block|{
return|return
name|beeLine
operator|.
name|error
argument_list|(
literal|"Property \"url\" is required"
argument_list|)
return|;
block|}
if|if
condition|(
name|driver
operator|==
literal|null
operator|||
name|driver
operator|.
name|length
argument_list|()
operator|==
literal|0
condition|)
block|{
if|if
condition|(
operator|!
name|beeLine
operator|.
name|scanForDriver
argument_list|(
name|url
argument_list|)
condition|)
block|{
return|return
name|beeLine
operator|.
name|error
argument_list|(
name|beeLine
operator|.
name|loc
argument_list|(
literal|"no-driver"
argument_list|,
name|url
argument_list|)
argument_list|)
return|;
block|}
block|}
name|beeLine
operator|.
name|info
argument_list|(
literal|"Connecting to "
operator|+
name|url
argument_list|)
expr_stmt|;
if|if
condition|(
name|username
operator|==
literal|null
condition|)
block|{
name|username
operator|=
name|beeLine
operator|.
name|getConsoleReader
argument_list|()
operator|.
name|readLine
argument_list|(
literal|"Enter username for "
operator|+
name|url
operator|+
literal|": "
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|password
operator|==
literal|null
condition|)
block|{
name|password
operator|=
name|beeLine
operator|.
name|getConsoleReader
argument_list|()
operator|.
name|readLine
argument_list|(
literal|"Enter password for "
operator|+
name|url
operator|+
literal|": "
argument_list|,
operator|new
name|Character
argument_list|(
literal|'*'
argument_list|)
argument_list|)
expr_stmt|;
block|}
try|try
block|{
name|beeLine
operator|.
name|getDatabaseConnections
argument_list|()
operator|.
name|setConnection
argument_list|(
operator|new
name|DatabaseConnection
argument_list|(
name|beeLine
argument_list|,
name|driver
argument_list|,
name|url
argument_list|,
name|username
argument_list|,
name|password
argument_list|)
argument_list|)
expr_stmt|;
name|beeLine
operator|.
name|getDatabaseConnection
argument_list|()
operator|.
name|getConnection
argument_list|()
expr_stmt|;
name|beeLine
operator|.
name|setCompletions
argument_list|()
expr_stmt|;
return|return
literal|true
return|;
block|}
catch|catch
parameter_list|(
name|SQLException
name|sqle
parameter_list|)
block|{
return|return
name|beeLine
operator|.
name|error
argument_list|(
name|sqle
argument_list|)
return|;
block|}
catch|catch
parameter_list|(
name|IOException
name|ioe
parameter_list|)
block|{
return|return
name|beeLine
operator|.
name|error
argument_list|(
name|ioe
argument_list|)
return|;
block|}
block|}
specifier|public
name|boolean
name|rehash
parameter_list|(
name|String
name|line
parameter_list|)
block|{
try|try
block|{
if|if
condition|(
operator|!
operator|(
name|beeLine
operator|.
name|assertConnection
argument_list|()
operator|)
condition|)
block|{
return|return
literal|false
return|;
block|}
if|if
condition|(
name|beeLine
operator|.
name|getDatabaseConnection
argument_list|()
operator|!=
literal|null
condition|)
block|{
name|beeLine
operator|.
name|getDatabaseConnection
argument_list|()
operator|.
name|setCompletions
argument_list|(
literal|false
argument_list|)
expr_stmt|;
block|}
return|return
literal|true
return|;
block|}
catch|catch
parameter_list|(
name|Exception
name|e
parameter_list|)
block|{
return|return
name|beeLine
operator|.
name|error
argument_list|(
name|e
argument_list|)
return|;
block|}
block|}
comment|/**    * List the current connections    */
specifier|public
name|boolean
name|list
parameter_list|(
name|String
name|line
parameter_list|)
block|{
name|int
name|index
init|=
literal|0
decl_stmt|;
name|beeLine
operator|.
name|info
argument_list|(
name|beeLine
operator|.
name|loc
argument_list|(
literal|"active-connections"
argument_list|,
name|beeLine
operator|.
name|getDatabaseConnections
argument_list|()
operator|.
name|size
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
for|for
control|(
name|Iterator
argument_list|<
name|DatabaseConnection
argument_list|>
name|i
init|=
name|beeLine
operator|.
name|getDatabaseConnections
argument_list|()
operator|.
name|iterator
argument_list|()
init|;
name|i
operator|.
name|hasNext
argument_list|()
condition|;
name|index
operator|++
control|)
block|{
name|DatabaseConnection
name|c
init|=
name|i
operator|.
name|next
argument_list|()
decl_stmt|;
name|boolean
name|closed
init|=
literal|false
decl_stmt|;
try|try
block|{
name|closed
operator|=
name|c
operator|.
name|getConnection
argument_list|()
operator|.
name|isClosed
argument_list|()
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|Exception
name|e
parameter_list|)
block|{
name|closed
operator|=
literal|true
expr_stmt|;
block|}
name|beeLine
operator|.
name|output
argument_list|(
name|beeLine
operator|.
name|getColorBuffer
argument_list|()
operator|.
name|pad
argument_list|(
literal|" #"
operator|+
name|index
operator|+
literal|""
argument_list|,
literal|5
argument_list|)
operator|.
name|pad
argument_list|(
name|closed
condition|?
name|beeLine
operator|.
name|loc
argument_list|(
literal|"closed"
argument_list|)
else|:
name|beeLine
operator|.
name|loc
argument_list|(
literal|"open"
argument_list|)
argument_list|,
literal|9
argument_list|)
operator|.
name|append
argument_list|(
name|c
operator|.
name|getUrl
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
block|}
return|return
literal|true
return|;
block|}
specifier|public
name|boolean
name|all
parameter_list|(
name|String
name|line
parameter_list|)
block|{
name|int
name|index
init|=
name|beeLine
operator|.
name|getDatabaseConnections
argument_list|()
operator|.
name|getIndex
argument_list|()
decl_stmt|;
name|boolean
name|success
init|=
literal|true
decl_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|beeLine
operator|.
name|getDatabaseConnections
argument_list|()
operator|.
name|size
argument_list|()
condition|;
name|i
operator|++
control|)
block|{
name|beeLine
operator|.
name|getDatabaseConnections
argument_list|()
operator|.
name|setIndex
argument_list|(
name|i
argument_list|)
expr_stmt|;
name|beeLine
operator|.
name|output
argument_list|(
name|beeLine
operator|.
name|loc
argument_list|(
literal|"executing-con"
argument_list|,
name|beeLine
operator|.
name|getDatabaseConnection
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
comment|// ### FIXME: this is broken for multi-line SQL
name|success
operator|=
name|sql
argument_list|(
name|line
operator|.
name|substring
argument_list|(
literal|"all "
operator|.
name|length
argument_list|()
argument_list|)
argument_list|)
operator|&&
name|success
expr_stmt|;
block|}
comment|// restore index
name|beeLine
operator|.
name|getDatabaseConnections
argument_list|()
operator|.
name|setIndex
argument_list|(
name|index
argument_list|)
expr_stmt|;
return|return
name|success
return|;
block|}
specifier|public
name|boolean
name|go
parameter_list|(
name|String
name|line
parameter_list|)
block|{
name|String
index|[]
name|parts
init|=
name|beeLine
operator|.
name|split
argument_list|(
name|line
argument_list|,
literal|2
argument_list|,
literal|"Usage: go<connection index>"
argument_list|)
decl_stmt|;
if|if
condition|(
name|parts
operator|==
literal|null
condition|)
block|{
return|return
literal|false
return|;
block|}
name|int
name|index
init|=
name|Integer
operator|.
name|parseInt
argument_list|(
name|parts
index|[
literal|1
index|]
argument_list|)
decl_stmt|;
if|if
condition|(
operator|!
operator|(
name|beeLine
operator|.
name|getDatabaseConnections
argument_list|()
operator|.
name|setIndex
argument_list|(
name|index
argument_list|)
operator|)
condition|)
block|{
name|beeLine
operator|.
name|error
argument_list|(
name|beeLine
operator|.
name|loc
argument_list|(
literal|"invalid-connection"
argument_list|,
literal|""
operator|+
name|index
argument_list|)
argument_list|)
expr_stmt|;
name|list
argument_list|(
literal|""
argument_list|)
expr_stmt|;
comment|// list the current connections
return|return
literal|false
return|;
block|}
return|return
literal|true
return|;
block|}
comment|/**    * Save or stop saving a script to a file    */
specifier|public
name|boolean
name|script
parameter_list|(
name|String
name|line
parameter_list|)
block|{
if|if
condition|(
name|beeLine
operator|.
name|getScriptOutputFile
argument_list|()
operator|==
literal|null
condition|)
block|{
return|return
name|startScript
argument_list|(
name|line
argument_list|)
return|;
block|}
else|else
block|{
return|return
name|stopScript
argument_list|(
name|line
argument_list|)
return|;
block|}
block|}
comment|/**    * Stop writing to the script file and close the script.    */
specifier|private
name|boolean
name|stopScript
parameter_list|(
name|String
name|line
parameter_list|)
block|{
try|try
block|{
name|beeLine
operator|.
name|getScriptOutputFile
argument_list|()
operator|.
name|close
argument_list|()
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|Exception
name|e
parameter_list|)
block|{
name|beeLine
operator|.
name|handleException
argument_list|(
name|e
argument_list|)
expr_stmt|;
block|}
name|beeLine
operator|.
name|output
argument_list|(
name|beeLine
operator|.
name|loc
argument_list|(
literal|"script-closed"
argument_list|,
name|beeLine
operator|.
name|getScriptOutputFile
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|beeLine
operator|.
name|setScriptOutputFile
argument_list|(
literal|null
argument_list|)
expr_stmt|;
return|return
literal|true
return|;
block|}
comment|/**    * Start writing to the specified script file.    */
specifier|private
name|boolean
name|startScript
parameter_list|(
name|String
name|line
parameter_list|)
block|{
if|if
condition|(
name|beeLine
operator|.
name|getScriptOutputFile
argument_list|()
operator|!=
literal|null
condition|)
block|{
return|return
name|beeLine
operator|.
name|error
argument_list|(
name|beeLine
operator|.
name|loc
argument_list|(
literal|"script-already-running"
argument_list|,
name|beeLine
operator|.
name|getScriptOutputFile
argument_list|()
argument_list|)
argument_list|)
return|;
block|}
name|String
index|[]
name|parts
init|=
name|beeLine
operator|.
name|split
argument_list|(
name|line
argument_list|,
literal|2
argument_list|,
literal|"Usage: script<filename>"
argument_list|)
decl_stmt|;
if|if
condition|(
name|parts
operator|==
literal|null
condition|)
block|{
return|return
literal|false
return|;
block|}
try|try
block|{
name|beeLine
operator|.
name|setScriptOutputFile
argument_list|(
operator|new
name|OutputFile
argument_list|(
name|parts
index|[
literal|1
index|]
argument_list|)
argument_list|)
expr_stmt|;
name|beeLine
operator|.
name|output
argument_list|(
name|beeLine
operator|.
name|loc
argument_list|(
literal|"script-started"
argument_list|,
name|beeLine
operator|.
name|getScriptOutputFile
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
return|return
literal|true
return|;
block|}
catch|catch
parameter_list|(
name|Exception
name|e
parameter_list|)
block|{
return|return
name|beeLine
operator|.
name|error
argument_list|(
name|e
argument_list|)
return|;
block|}
block|}
comment|/**    * Run a script from the specified file.    */
specifier|public
name|boolean
name|run
parameter_list|(
name|String
name|line
parameter_list|)
block|{
name|String
index|[]
name|parts
init|=
name|beeLine
operator|.
name|split
argument_list|(
name|line
argument_list|,
literal|2
argument_list|,
literal|"Usage: run<scriptfile>"
argument_list|)
decl_stmt|;
if|if
condition|(
name|parts
operator|==
literal|null
condition|)
block|{
return|return
literal|false
return|;
block|}
name|List
argument_list|<
name|String
argument_list|>
name|cmds
init|=
operator|new
name|LinkedList
argument_list|<
name|String
argument_list|>
argument_list|()
decl_stmt|;
try|try
block|{
name|BufferedReader
name|reader
init|=
operator|new
name|BufferedReader
argument_list|(
operator|new
name|FileReader
argument_list|(
name|parts
index|[
literal|1
index|]
argument_list|)
argument_list|)
decl_stmt|;
try|try
block|{
comment|// ### NOTE: fix for sf.net bug 879427
name|StringBuilder
name|cmd
init|=
literal|null
decl_stmt|;
for|for
control|(
init|;
condition|;
control|)
block|{
name|String
name|scriptLine
init|=
name|reader
operator|.
name|readLine
argument_list|()
decl_stmt|;
if|if
condition|(
name|scriptLine
operator|==
literal|null
condition|)
block|{
break|break;
block|}
name|String
name|trimmedLine
init|=
name|scriptLine
operator|.
name|trim
argument_list|()
decl_stmt|;
if|if
condition|(
name|beeLine
operator|.
name|getOpts
argument_list|()
operator|.
name|getTrimScripts
argument_list|()
condition|)
block|{
name|scriptLine
operator|=
name|trimmedLine
expr_stmt|;
block|}
if|if
condition|(
name|cmd
operator|!=
literal|null
condition|)
block|{
comment|// we're continuing an existing command
name|cmd
operator|.
name|append
argument_list|(
literal|" \n"
argument_list|)
expr_stmt|;
name|cmd
operator|.
name|append
argument_list|(
name|scriptLine
argument_list|)
expr_stmt|;
if|if
condition|(
name|trimmedLine
operator|.
name|endsWith
argument_list|(
literal|";"
argument_list|)
condition|)
block|{
comment|// this command has terminated
name|cmds
operator|.
name|add
argument_list|(
name|cmd
operator|.
name|toString
argument_list|()
argument_list|)
expr_stmt|;
name|cmd
operator|=
literal|null
expr_stmt|;
block|}
block|}
else|else
block|{
comment|// we're starting a new command
if|if
condition|(
name|beeLine
operator|.
name|needsContinuation
argument_list|(
name|scriptLine
argument_list|)
condition|)
block|{
comment|// multi-line
name|cmd
operator|=
operator|new
name|StringBuilder
argument_list|(
name|scriptLine
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|// single-line
name|cmds
operator|.
name|add
argument_list|(
name|scriptLine
argument_list|)
expr_stmt|;
block|}
block|}
block|}
if|if
condition|(
name|cmd
operator|!=
literal|null
condition|)
block|{
comment|// ### REVIEW: oops, somebody left the last command
comment|// unterminated; should we fix it for them or complain?
comment|// For now be nice and fix it.
name|cmd
operator|.
name|append
argument_list|(
literal|";"
argument_list|)
expr_stmt|;
name|cmds
operator|.
name|add
argument_list|(
name|cmd
operator|.
name|toString
argument_list|()
argument_list|)
expr_stmt|;
block|}
block|}
finally|finally
block|{
name|reader
operator|.
name|close
argument_list|()
expr_stmt|;
block|}
comment|// success only if all the commands were successful
return|return
name|beeLine
operator|.
name|runCommands
argument_list|(
name|cmds
argument_list|)
operator|==
name|cmds
operator|.
name|size
argument_list|()
return|;
block|}
catch|catch
parameter_list|(
name|Exception
name|e
parameter_list|)
block|{
return|return
name|beeLine
operator|.
name|error
argument_list|(
name|e
argument_list|)
return|;
block|}
block|}
comment|/**    * Save or stop saving all output to a file.    */
specifier|public
name|boolean
name|record
parameter_list|(
name|String
name|line
parameter_list|)
block|{
if|if
condition|(
name|beeLine
operator|.
name|getRecordOutputFile
argument_list|()
operator|==
literal|null
condition|)
block|{
return|return
name|startRecording
argument_list|(
name|line
argument_list|)
return|;
block|}
else|else
block|{
return|return
name|stopRecording
argument_list|(
name|line
argument_list|)
return|;
block|}
block|}
comment|/**    * Stop writing output to the record file.    */
specifier|private
name|boolean
name|stopRecording
parameter_list|(
name|String
name|line
parameter_list|)
block|{
try|try
block|{
name|beeLine
operator|.
name|getRecordOutputFile
argument_list|()
operator|.
name|close
argument_list|()
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|Exception
name|e
parameter_list|)
block|{
name|beeLine
operator|.
name|handleException
argument_list|(
name|e
argument_list|)
expr_stmt|;
block|}
name|beeLine
operator|.
name|output
argument_list|(
name|beeLine
operator|.
name|loc
argument_list|(
literal|"record-closed"
argument_list|,
name|beeLine
operator|.
name|getRecordOutputFile
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|beeLine
operator|.
name|setRecordOutputFile
argument_list|(
literal|null
argument_list|)
expr_stmt|;
return|return
literal|true
return|;
block|}
comment|/**    * Start writing to the specified record file.    */
specifier|private
name|boolean
name|startRecording
parameter_list|(
name|String
name|line
parameter_list|)
block|{
if|if
condition|(
name|beeLine
operator|.
name|getRecordOutputFile
argument_list|()
operator|!=
literal|null
condition|)
block|{
return|return
name|beeLine
operator|.
name|error
argument_list|(
name|beeLine
operator|.
name|loc
argument_list|(
literal|"record-already-running"
argument_list|,
name|beeLine
operator|.
name|getRecordOutputFile
argument_list|()
argument_list|)
argument_list|)
return|;
block|}
name|String
index|[]
name|parts
init|=
name|beeLine
operator|.
name|split
argument_list|(
name|line
argument_list|,
literal|2
argument_list|,
literal|"Usage: record<filename>"
argument_list|)
decl_stmt|;
if|if
condition|(
name|parts
operator|==
literal|null
condition|)
block|{
return|return
literal|false
return|;
block|}
try|try
block|{
name|beeLine
operator|.
name|setRecordOutputFile
argument_list|(
operator|new
name|OutputFile
argument_list|(
name|parts
index|[
literal|1
index|]
argument_list|)
argument_list|)
expr_stmt|;
name|beeLine
operator|.
name|output
argument_list|(
name|beeLine
operator|.
name|loc
argument_list|(
literal|"record-started"
argument_list|,
name|beeLine
operator|.
name|getRecordOutputFile
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
return|return
literal|true
return|;
block|}
catch|catch
parameter_list|(
name|Exception
name|e
parameter_list|)
block|{
return|return
name|beeLine
operator|.
name|error
argument_list|(
name|e
argument_list|)
return|;
block|}
block|}
specifier|public
name|boolean
name|describe
parameter_list|(
name|String
name|line
parameter_list|)
throws|throws
name|SQLException
block|{
name|String
index|[]
name|table
init|=
name|beeLine
operator|.
name|split
argument_list|(
name|line
argument_list|,
literal|2
argument_list|,
literal|"Usage: describe<table name>"
argument_list|)
decl_stmt|;
if|if
condition|(
name|table
operator|==
literal|null
condition|)
block|{
return|return
literal|false
return|;
block|}
name|ResultSet
name|rs
decl_stmt|;
if|if
condition|(
name|table
index|[
literal|1
index|]
operator|.
name|equals
argument_list|(
literal|"tables"
argument_list|)
condition|)
block|{
name|rs
operator|=
name|beeLine
operator|.
name|getTables
argument_list|()
expr_stmt|;
block|}
else|else
block|{
name|rs
operator|=
name|beeLine
operator|.
name|getColumns
argument_list|(
name|table
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|rs
operator|==
literal|null
condition|)
block|{
return|return
literal|false
return|;
block|}
name|beeLine
operator|.
name|print
argument_list|(
name|rs
argument_list|)
expr_stmt|;
name|rs
operator|.
name|close
argument_list|()
expr_stmt|;
return|return
literal|true
return|;
block|}
specifier|public
name|boolean
name|help
parameter_list|(
name|String
name|line
parameter_list|)
block|{
name|String
index|[]
name|parts
init|=
name|beeLine
operator|.
name|split
argument_list|(
name|line
argument_list|)
decl_stmt|;
name|String
name|cmd
init|=
name|parts
operator|.
name|length
operator|>
literal|1
condition|?
name|parts
index|[
literal|1
index|]
else|:
literal|""
decl_stmt|;
name|int
name|count
init|=
literal|0
decl_stmt|;
name|TreeSet
argument_list|<
name|ColorBuffer
argument_list|>
name|clist
init|=
operator|new
name|TreeSet
argument_list|<
name|ColorBuffer
argument_list|>
argument_list|()
decl_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|beeLine
operator|.
name|commandHandlers
operator|.
name|length
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|cmd
operator|.
name|length
argument_list|()
operator|==
literal|0
operator|||
name|Arrays
operator|.
name|asList
argument_list|(
name|beeLine
operator|.
name|commandHandlers
index|[
name|i
index|]
operator|.
name|getNames
argument_list|()
argument_list|)
operator|.
name|contains
argument_list|(
name|cmd
argument_list|)
condition|)
block|{
name|clist
operator|.
name|add
argument_list|(
name|beeLine
operator|.
name|getColorBuffer
argument_list|()
operator|.
name|pad
argument_list|(
literal|"!"
operator|+
name|beeLine
operator|.
name|commandHandlers
index|[
name|i
index|]
operator|.
name|getName
argument_list|()
argument_list|,
literal|20
argument_list|)
operator|.
name|append
argument_list|(
name|beeLine
operator|.
name|wrap
argument_list|(
name|beeLine
operator|.
name|commandHandlers
index|[
name|i
index|]
operator|.
name|getHelpText
argument_list|()
argument_list|,
literal|60
argument_list|,
literal|20
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
for|for
control|(
name|Iterator
argument_list|<
name|ColorBuffer
argument_list|>
name|i
init|=
name|clist
operator|.
name|iterator
argument_list|()
init|;
name|i
operator|.
name|hasNext
argument_list|()
condition|;
control|)
block|{
name|beeLine
operator|.
name|output
argument_list|(
name|i
operator|.
name|next
argument_list|()
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|cmd
operator|.
name|length
argument_list|()
operator|==
literal|0
condition|)
block|{
name|beeLine
operator|.
name|output
argument_list|(
literal|""
argument_list|)
expr_stmt|;
name|beeLine
operator|.
name|output
argument_list|(
name|beeLine
operator|.
name|loc
argument_list|(
literal|"comments"
argument_list|,
name|beeLine
operator|.
name|getApplicationContactInformation
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
block|}
return|return
literal|true
return|;
block|}
specifier|public
name|boolean
name|manual
parameter_list|(
name|String
name|line
parameter_list|)
throws|throws
name|IOException
block|{
name|InputStream
name|in
init|=
name|BeeLine
operator|.
name|class
operator|.
name|getResourceAsStream
argument_list|(
literal|"manual.txt"
argument_list|)
decl_stmt|;
if|if
condition|(
name|in
operator|==
literal|null
condition|)
block|{
return|return
name|beeLine
operator|.
name|error
argument_list|(
name|beeLine
operator|.
name|loc
argument_list|(
literal|"no-manual"
argument_list|)
argument_list|)
return|;
block|}
name|BufferedReader
name|breader
init|=
operator|new
name|BufferedReader
argument_list|(
operator|new
name|InputStreamReader
argument_list|(
name|in
argument_list|)
argument_list|)
decl_stmt|;
name|String
name|man
decl_stmt|;
name|int
name|index
init|=
literal|0
decl_stmt|;
while|while
condition|(
operator|(
name|man
operator|=
name|breader
operator|.
name|readLine
argument_list|()
operator|)
operator|!=
literal|null
condition|)
block|{
name|index
operator|++
expr_stmt|;
name|beeLine
operator|.
name|output
argument_list|(
name|man
argument_list|)
expr_stmt|;
comment|// silly little pager
if|if
condition|(
name|index
operator|%
operator|(
name|beeLine
operator|.
name|getOpts
argument_list|()
operator|.
name|getMaxHeight
argument_list|()
operator|-
literal|1
operator|)
operator|==
literal|0
condition|)
block|{
name|String
name|ret
init|=
name|beeLine
operator|.
name|getConsoleReader
argument_list|()
operator|.
name|readLine
argument_list|(
name|beeLine
operator|.
name|loc
argument_list|(
literal|"enter-for-more"
argument_list|)
argument_list|)
decl_stmt|;
if|if
condition|(
name|ret
operator|!=
literal|null
operator|&&
name|ret
operator|.
name|startsWith
argument_list|(
literal|"q"
argument_list|)
condition|)
block|{
break|break;
block|}
block|}
block|}
name|breader
operator|.
name|close
argument_list|()
expr_stmt|;
return|return
literal|true
return|;
block|}
block|}
end_class

end_unit

